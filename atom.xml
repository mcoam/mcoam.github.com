<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Bitácora]]></title>
  <link href="http://mcoam.github.io/atom.xml" rel="self"/>
  <link href="http://mcoam.github.io/"/>
  <updated>2014-08-26T11:52:27-04:00</updated>
  <id>http://mcoam.github.io/</id>
  <author>
    <name><![CDATA[Miguel Angel Coa Morales]]></name>
    
  </author>

  
  <entry>
    <title type="html"><![CDATA[Eliminar y purgar nodo de PuppetDB (storeconfig)]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/26/eliminar-y-purgar-nodo-de-puppetdb-storeconfig/"/>
    <updated>2014-08-26T11:43:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/26/eliminar-y-purgar-nodo-de-puppetdb-storeconfig</id>
    <content type="html"><![CDATA[<p>Error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Error</span><span class="p">:</span> <span class="no">Could</span> <span class="ow">not</span> <span class="n">retrieve</span> <span class="n">catalog</span> <span class="n">from</span> <span class="n">remote</span> <span class="ss">server</span><span class="p">:</span> <span class="no">Error</span> <span class="mi">400</span> <span class="n">on</span> <span class="ss">SERVER</span><span class="p">:</span> <span class="n">A</span> <span class="n">duplicate</span> <span class="n">resource</span> <span class="n">was</span> <span class="n">found</span> <span class="k">while</span> <span class="n">collecting</span> <span class="n">exported</span> <span class="n">resources</span><span class="p">,</span> <span class="n">with</span> <span class="n">the</span> <span class="n">type</span> <span class="ow">and</span> <span class="n">title</span> <span class="no">Nagios_host</span><span class="o">[</span><span class="k">next</span><span class="o">-</span><span class="n">haproxy</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">org</span><span class="o">]</span> <span class="n">on</span> <span class="n">node</span> <span class="n">nagios</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">org</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Not</span> <span class="n">using</span> <span class="n">cache</span> <span class="n">on</span> <span class="n">failed</span> <span class="n">catalog</span>
</span><span class='line'><span class="ss">Error</span><span class="p">:</span> <span class="no">Could</span> <span class="ow">not</span> <span class="n">retrieve</span> <span class="n">catalog</span><span class="p">;</span> <span class="n">skipping</span> <span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior era por que el node estaba registrado dos veces en PuppetDB una con el fqdn completo <i>next-haproxy-1.domain.org</i> y otra sin el dominio <i>next-haproxy-1</i> lo que generaba error al exportar los recursos. La solución fue eliminar uno y luego purgar el contenido de la base de datos:</p>

<p><li>Remover el nodo de PuppetDB</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@nagios</span> <span class="n">servers</span><span class="o">]</span><span class="err">$</span> <span class="n">puppet</span> <span class="n">node</span> <span class="n">deactivate</span> <span class="k">next</span><span class="o">-</span><span class="n">haproxy</span><span class="o">-</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remover el nodo de la DB</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@puppet</span> <span class="o">~]</span><span class="c1"># psql -h 127.0.0.1 puppetdb puppetdb</span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">user</span> <span class="ss">puppetdb</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">colocar</span> <span class="n">password</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">#EJECUTAR</span>
</span><span class='line'><span class="n">puppetdb</span><span class="o">=&gt;</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">catalogs</span> <span class="n">where</span> <span class="n">certname</span> <span class="k">in</span> <span class="p">(</span><span class="nb">select</span> <span class="nb">name</span> <span class="n">from</span> <span class="n">certnames</span> <span class="n">where</span> <span class="n">deactivated</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">null</span><span class="p">);</span>
</span><span class='line'><span class="no">DELETE</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Error Kerberos y Bind con Samba4]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/20/error-samba4-y-bind/"/>
    <updated>2014-08-20T18:17:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/20/error-samba4-y-bind</id>
    <content type="html"><![CDATA[<p>Al momento de validar la configuración de kerberos del usuario admin arrojaba lo siguiente:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">kinit</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span>
</span><span class='line'><span class="ss">kinit</span><span class="p">:</span> <span class="no">Cannot</span> <span class="n">resolve</span> <span class="n">servers</span> <span class="k">for</span> <span class="no">KDC</span> <span class="k">in</span> <span class="n">realm</span> <span class="s2">&quot;EXAMPLE.LOCAL&quot;</span> <span class="k">while</span> <span class="n">getting</span> <span class="n">initial</span> <span class="n">credentials</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al chequear las configuraciones DNS de de Samba arrojaba</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">samba_dnsupdate</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">all</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="ss">IPs</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;10.0.2.15&#39;</span><span class="p">,</span> <span class="s1">&#39;10.10.0.200&#39;</span><span class="o">]</span>
</span><span class='line'><span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span class='line'>  <span class="no">File</span> <span class="s2">&quot;/usr/local/samba/sbin/samba_dnsupdate&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">511</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="n">get_credentials</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>
</span><span class='line'>  <span class="no">File</span> <span class="s2">&quot;/usr/local/samba/sbin/samba_dnsupdate&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">124</span><span class="p">,</span> <span class="k">in</span> <span class="n">get_credentials</span>
</span><span class='line'>    <span class="k">raise</span> <span class="n">e</span>
</span><span class='line'><span class="ss">RuntimeError</span><span class="p">:</span> <span class="n">kinit</span> <span class="k">for</span> <span class="no">SAMBA</span><span class="vg">$@</span><span class="no">EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span> <span class="n">failed</span> <span class="p">(</span><span class="no">Cannot</span> <span class="n">contact</span> <span class="n">any</span> <span class="no">KDC</span> <span class="k">for</span> <span class="n">requested</span> <span class="n">realm</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Solución ELIMINAR Bind</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">yum</span> <span class="n">remove</span> <span class="n">bind</span> <span class="o">-</span><span class="n">y</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Comprobamos</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># kinit administrator@EXAMPLE.LOCAL</span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">:</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Your</span> <span class="n">password</span> <span class="n">will</span> <span class="n">expire</span> <span class="k">in</span> <span class="mi">41</span> <span class="n">days</span> <span class="n">on</span> <span class="no">Wed</span> <span class="no">Oct</span>  <span class="mi">1</span> <span class="mi">17</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mo">00</span> <span class="mi">2014</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y chequeamos la configuracion de DNS de Samba</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># samba_dnsupdate --verbose --all-names</span>
</span><span class='line'><span class="ss">IPs</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;10.0.2.15&#39;</span><span class="p">,</span> <span class="s1">&#39;10.10.0.200&#39;</span><span class="o">]</span>
</span><span class='line'><span class="no">Calling</span> <span class="n">nsupdate</span> <span class="k">for</span> <span class="n">A</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'><span class="no">Outgoing</span> <span class="n">update</span> <span class="ss">query</span><span class="p">:</span>
</span><span class='line'><span class="p">;;</span> <span class="o">-&gt;&gt;</span><span class="no">HEADER</span><span class="o">&lt;&lt;-</span> <span class="ss">opcode</span><span class="p">:</span> <span class="no">UPDATE</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="no">NOERROR</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span>      <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="ss">flags</span><span class="p">:;</span> <span class="ss">ZONE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">PREREQ</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">UPDATE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">ADDITIONAL</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="no">UPDATE</span> <span class="ss">SECTION</span><span class="p">:</span>
</span><span class='line'><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>        <span class="mi">900</span> <span class="no">IN</span>  <span class="n">A</span>    <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="no">TSIG</span> <span class="n">error</span> <span class="n">with</span> <span class="ss">server</span><span class="p">:</span> <span class="n">tsig</span> <span class="n">verify</span> <span class="n">failure</span>
</span><span class='line'><span class="no">Failed</span> <span class="ss">nsupdate</span><span class="p">:</span> <span class="mi">2</span>
</span><span class='line'><span class="no">Calling</span> <span class="n">nsupdate</span> <span class="k">for</span> <span class="n">A</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'><span class="no">Outgoing</span> <span class="n">update</span> <span class="ss">query</span><span class="p">:</span>
</span><span class='line'><span class="p">;;</span> <span class="o">-&gt;&gt;</span><span class="no">HEADER</span><span class="o">&lt;&lt;-</span> <span class="ss">opcode</span><span class="p">:</span> <span class="no">UPDATE</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="no">NOERROR</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span>      <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="ss">flags</span><span class="p">:;</span> <span class="ss">ZONE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">PREREQ</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">UPDATE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">ADDITIONAL</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="no">UPDATE</span> <span class="ss">SECTION</span><span class="p">:</span>
</span><span class='line'><span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>    <span class="mi">900</span> <span class="no">IN</span>  <span class="n">A</span>    <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SAMBA4.localo controlador de dominio A/D]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/20/samba4-como-controlador-de-dominio-a-slash-d/"/>
    <updated>2014-08-20T10:57:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/20/samba4-como-controlador-de-dominio-a-slash-d</id>
    <content type="html"><![CDATA[<p>Para Centos 6 tenemos que complilar las fuentes para instalar Samba4:</p>

<p>Instalar paqueteria necesaria</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">gcc</span> <span class="n">make</span> <span class="n">wget</span> <span class="n">python</span><span class="o">-</span><span class="n">devel</span> <span class="n">gnutls</span><span class="o">-</span><span class="n">devel</span> <span class="n">openssl</span><span class="o">-</span><span class="n">devel</span> <span class="n">libacl</span><span class="o">-</span><span class="n">devel</span> <span class="n">krb5</span><span class="o">-</span><span class="n">server</span> <span class="n">krb5</span><span class="o">-</span><span class="n">libs</span> <span class="n">krb5</span><span class="o">-</span><span class="n">workstation</span> <span class="n">bind</span> <span class="n">bind</span><span class="o">-</span><span class="n">libs</span> <span class="n">bind</span><span class="o">-</span><span class="n">utils</span>
</span></code></pre></td></tr></table></div></figure>


<p>Descargamos y lo compilamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">git</span> <span class="nb">clone</span> <span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">git</span><span class="o">.</span><span class="n">samba</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">samba</span><span class="o">.</span><span class="n">git</span> <span class="n">samba4</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cd</span> <span class="n">samba4</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="o">.</span><span class="n">/configure</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">selftest</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span> <span class="c1">#Esto demora bastante</span>
</span></code></pre></td></tr></table></div></figure>


<p>Terminado lo anterior y si no arroja ningún error, tendremos instalado Samba4. Ahora necesitamos configurar el controlador de dominio, lo primiero que tenemos que hacer es el <i>Provisioning</i> para el nuevo dominio.</p>

<p>Unas cosas antes a considerar:
Configuramos el hostname en la tabla hosts <code>/etc/hosts</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/</span><span class="n">hosts</span>
</span><span class='line'><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>   <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost4</span> <span class="n">localhost4</span><span class="o">.</span><span class="n">localdomain4</span>
</span><span class='line'><span class="o">::</span><span class="mi">1</span>         <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost6</span> <span class="n">localhost6</span><span class="o">.</span><span class="n">localdomain6</span>
</span><span class='line'>
</span><span class='line'><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">200</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="n">samba</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y el servidor de nombres en el <code>/etc/resolv.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'><span class="n">search</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="n">domain</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="n">nameserver</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esto es necesario para los servicios Samba y Kerberos, además, tenemos que configurar el parámetro <code>dns forwarder</code> dentro del archivo de configuración del servicio (esto si no lo hacemos dentro del proceso del provisionamiento).</p>

<p>NOTA: El servidor tiene que tener correctamente sincronizada la hora (utilizar NTP)</p>

<h4>Provisionando el nuevo dominio</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">samba</span><span class="o">-</span><span class="n">tool</span> <span class="n">domain</span> <span class="n">provision</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y completamos con los datos solicitados</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Realm</span> <span class="o">[</span><span class="no">EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">Domain</span> <span class="o">[</span><span class="no">EXAMPLE</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span> <span class="c1">#CON MAYUSCULAS</span>
</span><span class='line'><span class="no">Server</span> <span class="no">Role</span> <span class="p">(</span><span class="n">dc</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">standalone</span><span class="p">)</span> <span class="o">[</span><span class="n">dc</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">DNS</span> <span class="n">backend</span> <span class="p">(</span><span class="no">SAMBA_INTERNAL</span><span class="p">,</span> <span class="no">BIND9_FLATFILE</span><span class="p">,</span> <span class="no">BIND9_DLZ</span><span class="p">,</span> <span class="no">NONE</span><span class="p">)</span> <span class="o">[</span><span class="no">SAMBA_INTERNAL</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">DNS</span> <span class="n">forwarder</span> <span class="no">IP</span> <span class="n">address</span> <span class="p">(</span><span class="n">write</span> <span class="s1">&#39;none&#39;</span> <span class="n">to</span> <span class="n">disable</span> <span class="n">forwarding</span><span class="p">)</span> <span class="o">[</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'><span class="no">Administrator</span> <span class="ss">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">set_password</span><span class="o">&gt;</span>
</span><span class='line'><span class="no">Retype</span> <span class="ss">password</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con todo el proceso anterior realizado, al final de todo veremos algo como lo siguiente</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Fixing</span> <span class="n">provision</span> <span class="no">GUIDs</span>
</span><span class='line'><span class="n">A</span> <span class="no">Kerberos</span> <span class="n">configuration</span> <span class="n">suitable</span> <span class="k">for</span> <span class="no">Samba</span> <span class="mi">4</span> <span class="n">has</span> <span class="n">been</span> <span class="n">generated</span> <span class="n">at</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'><span class="no">Once</span> <span class="n">the</span> <span class="n">above</span> <span class="n">files</span> <span class="n">are</span> <span class="n">installed</span><span class="p">,</span> <span class="n">your</span> <span class="no">Samba4</span> <span class="n">server</span> <span class="n">will</span> <span class="n">be</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">use</span>
</span><span class='line'><span class="no">Server</span> <span class="ss">Role</span><span class="p">:</span>           <span class="n">active</span> <span class="n">directory</span> <span class="n">domain</span> <span class="n">controller</span>
</span><span class='line'><span class="ss">Hostname</span><span class="p">:</span>              <span class="n">samba</span>
</span><span class='line'><span class="no">NetBIOS</span> <span class="ss">Domain</span><span class="p">:</span>        <span class="no">EXAMPLE</span>
</span><span class='line'><span class="no">DNS</span> <span class="ss">Domain</span><span class="p">:</span>            <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="no">DOMAIN</span> <span class="ss">SID</span><span class="p">:</span>            <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">3438009546</span><span class="o">-</span><span class="mi">7273</span><span class="no">XXXX</span><span class="o">-</span><span class="no">XXXXXXXXX</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y luego reiniciamos el servidor</p>

<p>El path de instalación de Samaba4 queda bajo <code>/usr/local/samba/</code> los mismo sucede con los binarios <code>/usr/local/samba/bin/</code> y <code>/usr/local/samba/sbin/</code> para lo cual vamos a configurar la variable <code>$PATH</code> en nuestro bash.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># vim ~/.bashrc</span>
</span><span class='line'><span class="c1">#Dentro colocamos</span>
</span><span class='line'><span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/samba/sbin:/usr/local/samba/bin:$PATH&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Para ver que quedó todo en orden ejecutamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># samba -V</span>
</span><span class='line'><span class="no">Version</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># smbclient -V</span>
</span><span class='line'><span class="no">Version</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span>
</span></code></pre></td></tr></table></div></figure>


<p>Chequeamos la configuración local al Samba y los procesos corriendo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1">#  ps -ef | grep samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23010</span>     <span class="mi">1</span>  <span class="mi">1</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23011</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23012</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23013</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23014</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23015</span> <span class="mi">23011</span>  <span class="mi">1</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">smbd</span> <span class="o">-</span><span class="n">D</span> <span class="o">--</span><span class="n">option</span><span class="o">=</span><span class="n">server</span> <span class="n">role</span> <span class="ss">check</span><span class="p">:</span><span class="n">inhibit</span><span class="o">=</span><span class="n">yes</span> <span class="o">--</span><span class="n">foreground</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23016</span> <span class="mi">23010</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23017</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># /usr/local/samba/bin/smbclient -L localhost -U%</span>
</span><span class='line'><span class="no">Domain</span><span class="o">=[</span><span class="no">EXAMPLE</span><span class="o">]</span> <span class="no">OS</span><span class="o">=[</span><span class="no">Unix</span><span class="o">]</span> <span class="no">Server</span><span class="o">=[</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Sharename</span>       <span class="no">Type</span>      <span class="no">Comment</span>
</span><span class='line'>        <span class="o">---------</span>       <span class="o">----</span>      <span class="o">-------</span>
</span><span class='line'>        <span class="n">netlogon</span>        <span class="no">Disk</span>
</span><span class='line'>        <span class="n">sysvol</span>          <span class="no">Disk</span>
</span><span class='line'>        <span class="no">IPC</span><span class="err">$</span>            <span class="no">IPC</span>       <span class="no">IPC</span> <span class="no">Service</span> <span class="p">(</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="p">)</span>
</span><span class='line'><span class="no">Domain</span><span class="o">=[</span><span class="no">EXAMPLE</span><span class="o">]</span> <span class="no">OS</span><span class="o">=[</span><span class="no">Unix</span><span class="o">]</span> <span class="no">Server</span><span class="o">=[</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Server</span>               <span class="no">Comment</span>
</span><span class='line'>        <span class="o">---------</span>            <span class="o">-------</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Workgroup</span>            <span class="no">Master</span>
</span><span class='line'>        <span class="o">---------</span>            <span class="o">-------</span>
</span></code></pre></td></tr></table></div></figure>


<p>El proceso de configuración del Samba va a crear un archivo kerberos de la configuración relaizada, tenemos que enlazarlo al directorio <code>/etc</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">mv</span> <span class="sr">/etc/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">ORG</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span>  <span class="sr">/etc/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Comprobamos el funcionamiento en kerberos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># host -t SRV _ldap._tcp.example.local.</span>
</span><span class='line'><span class="n">_ldap</span><span class="o">.</span><span class="n">_tcp</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="n">has</span> <span class="no">SRV</span> <span class="n">record</span> <span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Comprobamos la autentificación contra kerberos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># kinit administrator@EXAMPLE.LOCAL </span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">:</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Your</span> <span class="n">password</span> <span class="n">will</span> <span class="n">expire</span> <span class="k">in</span> <span class="mi">41</span> <span class="n">days</span> <span class="n">on</span> <span class="no">Wed</span> <span class="no">Oct</span>  <span class="mi">1</span> <span class="mi">16</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">11</span> <span class="mi">2014</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si por el contrario nos arroja algún error, tenemos que ver las configuraciones realizadas o reconfigurar el servicio samba</p>

<h4>Script de arranque</h4>

<p>Para el control del servicio creamos el siguiente script</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">samba4</span>
</span><span class='line'><span class="c1">#! /bin/bash</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># samba4 Bring up/down samba4 service</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># chkconfig: - 90 10</span>
</span><span class='line'><span class="c1"># description: Activates/Deactivates all samba4 interfaces configured to#</span>
</span><span class='line'><span class="c1"># chkconfig: - 90 10</span>
</span><span class='line'><span class="c1"># description: Activates/Deactivates all samba4 interfaces configured to</span>
</span><span class='line'><span class="c1"># start at boot time.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c1"># Provides:</span>
</span><span class='line'><span class="c1"># Should-Start:</span>
</span><span class='line'><span class="c1"># Short-Description: Bring up/down samba4</span>
</span><span class='line'><span class="c1"># Description: Bring up/down samba4</span>
</span><span class='line'><span class="c1">### END INIT INFO</span>
</span><span class='line'><span class="c1"># Source function library.</span>
</span><span class='line'><span class="o">.</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">functions</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/etc/s</span><span class="n">ysconfig</span><span class="o">/</span><span class="n">samba4</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'><span class="o">.</span> <span class="sr">/etc/s</span><span class="n">ysconfig</span><span class="o">/</span><span class="n">samba4</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="no">CWD</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
</span><span class='line'><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;samba4&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">start</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="c1"># Attach irda device</span>
</span><span class='line'><span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="vg">$&quot;</span><span class="no">Starting</span> <span class="vg">$prog</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">/usr/local/samba/sbin/samba</span>
</span><span class='line'><span class="s2">sleep 2</span>
</span><span class='line'><span class="s2">if ps ax | grep -v &quot;</span><span class="n">grep</span><span class="s2">&quot; | grep -q /samba/sbin/samba ; then success $&quot;</span><span class="n">samba4</span> <span class="n">startup</span><span class="s2">&quot;; else failure $&quot;</span><span class="n">samba4</span> <span class="n">startup</span><span class="s2">&quot;; fi</span>
</span><span class='line'><span class="s2">echo</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">stop() {</span>
</span><span class='line'><span class="s2"># Stop service.</span>
</span><span class='line'><span class="s2">echo -n $&quot;</span><span class="no">Shutting</span> <span class="n">down</span> <span class="vg">$prog</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">killall samba</span>
</span><span class='line'><span class="s2">sleep 2</span>
</span><span class='line'><span class="s2">if ps ax | grep -v &quot;</span><span class="n">grep</span><span class="s2">&quot; | grep -q /samba/sbin/samba ; then failure $&quot;</span><span class="n">samba4</span> <span class="n">shutdown</span><span class="s2">&quot;; else success $&quot;</span><span class="n">samba4</span> <span class="n">shutdown</span><span class="s2">&quot;; fi</span>
</span><span class='line'><span class="s2">echo</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">status() {</span>
</span><span class='line'><span class="s2">/usr/local/samba/sbin/samba --show-build</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2"> </span>
</span><span class='line'><span class="s2"># See how we were called.</span>
</span><span class='line'><span class="s2">case &quot;</span><span class="vg">$1</span><span class="s2">&quot; in</span>
</span><span class='line'><span class="s2">start)</span>
</span><span class='line'><span class="s2">start</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">stop)</span>
</span><span class='line'><span class="s2">stop</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">status)</span>
</span><span class='line'><span class="s2">status irattach</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">restart|reload)</span>
</span><span class='line'><span class="s2">stop</span>
</span><span class='line'><span class="s2">start</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">*)</span>
</span><span class='line'><span class="s2">echo $&quot;</span><span class="ss">Usage</span><span class="p">:</span> <span class="vg">$0</span> <span class="p">{</span><span class="n">start</span><span class="o">|</span><span class="n">stop</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">status</span><span class="p">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">exit 1</span>
</span><span class='line'><span class="s2">esac</span>
</span><span class='line'><span class="s2"> </span>
</span><span class='line'><span class="s2">exit 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>Configuramos los permisos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">samba4</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente dejamos los servicios para correr por defecto</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">samba4</span> <span class="n">on</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">ntp</span> <span class="n">on</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">named</span> <span class="n">on</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora ya tenemos configurado el Samba, desde ahora podemos empezar a conectar a los usuarios.</p>

<h4>Uniendo una máquina al dominio</h4>

<h4>Getión remota del controlado de dominio (Remote Server Administration Tool)</h4>

<p>Para la gestión remota del controlador de dominio descargamos <i>Remote Server Administration Tool</i> desde <a href="http://www.microsoft.com/es-es/download/details.aspx?id=7887">acá</a>:
 Instalación</p>

<ol>
<li>Lo instalamos como cualquier exe</li>
<li>Panel de control </li>
<li>Programas y caracteristicas</li>
<li>Activar o desactivar caracteristicas</li>
<li>Seleccionamos las caracteristicas asociadas al A/D</li>
<li>Reinciamos la máquina Windows</li>
<li>Inicio -> Ejecutar -> &#8220;Usuarios y Equipos de Active Directory&#8221; y veremos el arbol de nuestro Samba4</li>
</ol>


<p>Para mas detalles del RSTA <a href="https://wiki.samba.org/index.php/Installing_RSAT_on_Windows_for_AD_Management">acá</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creando un Box para Vagrant]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/02/creando-un-box-para-vagrant/"/>
    <updated>2014-08-02T23:50:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/02/creando-un-box-para-vagrant</id>
    <content type="html"><![CDATA[<p>En mi caso la máquina virtual no fue creada desde cero, ya que bajé un Box de Vagrant y lo customicé por lo que me salté los pasos previos de la creación del box <a href="https://docs.vagrantup.com/v2/boxes/base.html.">https://docs.vagrantup.com/v2/boxes/base.html.</a> Lo realizado para la creación del box fue lo siguiente:</p>

<p><li> Optimización de tamaño de la VM </li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">sudo</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=</span><span class="sr">/dev/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="sr">/EMPTY bs=1M</span>
</span><span class='line'><span class="sr">$ sudo rm -f /</span><span class="no">EMPTY</span>
</span><span class='line'><span class="err">$</span> <span class="n">sudo</span> <span class="n">shutdown</span> <span class="o">-</span><span class="n">h</span> <span class="n">now</span>
</span></code></pre></td></tr></table></div></figure>


<p><li> Creación del Box </li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">cd</span> <span class="o">~</span><span class="sr">/VirtualBox\ VMs/</span> <span class="c1"># directorio donde quedan alojadas las vms</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VirtualBox</span> <span class="no">VMs</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">package</span> <span class="o">--</span><span class="n">base</span> <span class="n">puppetserver</span> <span class="c1">##puppetserver es el nombre de la vm en virtualbox</span>
</span></code></pre></td></tr></table></div></figure>


<p><li> Testing del Box</li>
Agreagamos nuestro Box a nuestro Vagrant</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">box</span> <span class="n">add</span> <span class="no">Centos6PuppetServer</span> <span class="o">~</span><span class="sr">/VirtualBox\ VMs/</span><span class="n">package</span><span class="o">.</span><span class="n">box</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">box</span><span class="p">:</span> <span class="no">Adding</span> <span class="n">box</span> <span class="s1">&#39;Centos6PuppetServer&#39;</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="k">for</span> <span class="ss">provider</span><span class="p">:</span>
</span><span class='line'>    <span class="ss">box</span><span class="p">:</span> <span class="ss">Downloading</span><span class="p">:</span> <span class="ss">file</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="no">Users</span><span class="o">/</span><span class="no">Miguel</span><span class="o">/</span><span class="no">VirtualBox</span><span class="o">%</span><span class="mi">20</span><span class="no">VMs</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">box</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">box</span><span class="p">:</span> <span class="no">Successfully</span> <span class="n">added</span> <span class="n">box</span> <span class="s1">&#39;Centos6PuppetServer&#39;</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="k">for</span> <span class="s1">&#39;virtualbox&#39;</span><span class="o">!</span>
</span></code></pre></td></tr></table></div></figure>


<p>Verificamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">box</span> <span class="n">list</span>
</span><span class='line'><span class="no">Centos6PuppetServer</span> <span class="p">(</span><span class="n">virtualbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># nuestro box</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nos dirigimos a nuestro directorio de trabajo de Vagrant y crearemos un nuevo proyecto <i>testing</i></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VagrantVM</span><span class="err">$</span> <span class="n">mkdir</span> <span class="n">testing</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VagrantVM</span><span class="err">$</span> <span class="n">cd</span> <span class="n">testing</span><span class="o">/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Iniciamos una nueva VM</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">init</span> <span class="no">Centos6PuppetServer</span> <span class="c1">##la iniciamos</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">up</span> <span class="c1">#la arrancamos</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span> <span class="c1">#nos conectamos</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Red pública para máquinas virtuales en Vagrant ]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/30/red-publica-para-maquinas-virtuales-en-vagrant/"/>
    <updated>2014-07-30T15:05:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/30/red-publica-para-maquinas-virtuales-en-vagrant</id>
    <content type="html"><![CDATA[<p>Por defecto las máquinas virtuales creadas en Vagrant quedan configuradas con una ip &ldquo;privada&rdquo; y el acceso a la VM es por medio de NAT. Si deseamos configurar una ip &ldquo;publica&rdquo; en nuestra máquina virtual tenemos que editar nuestro <code>Vagranfile</code> y adicionar el parámetro <code>vm.network</code> dentro de nuestro apartado <code>config.vm.define</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="ss">:puppet</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet_config</span><span class="o">|</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;Centos&quot;</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span>  <span class="o">=</span> <span class="s2">&quot;puppetmaster.example.com&quot;</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:public_network</span><span class="p">,</span>  <span class="ss">bridge</span><span class="p">:</span> <span class="s1">&#39;en1: Wi-Fi (AirPort)&#39;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.1.36&quot;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vboxpuppet</span><span class="o">|</span>
</span><span class='line'>        <span class="n">vboxpuppet</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;puppetmaster&quot;</span>
</span><span class='line'>    <span class="k">end</span> <span class="c1">##cierra config.vm.provider</span>
</span><span class='line'>  <span class="k">end</span> <span class="c1">##cierra config.vm.define</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span> <span class="c1">##cierra file</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y si nos conectamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span>
</span><span class='line'><span class="o">[</span><span class="n">vagrant</span><span class="vi">@puppetmaster</span> <span class="o">~]</span><span class="err">$</span> <span class="n">ifconfig</span>
</span><span class='line'><span class="n">eth0</span>      <span class="no">Link</span> <span class="ss">encap</span><span class="p">:</span><span class="no">Ethernet</span>  <span class="no">HWaddr</span> <span class="mi">08</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="mi">35</span><span class="ss">:D8</span>
</span><span class='line'>          <span class="n">inet</span> <span class="ss">addr</span><span class="p">:</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">36</span>  <span class="ss">Bcast</span><span class="p">:</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">255</span>  <span class="ss">Mask</span><span class="p">:</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'>          <span class="n">inet6</span> <span class="ss">addr</span><span class="p">:</span> <span class="ss">fe80</span><span class="p">:</span><span class="ss">:a00</span><span class="p">:</span><span class="mi">27</span><span class="ss">ff</span><span class="p">:</span><span class="ss">fe97</span><span class="p">:</span><span class="mi">35</span><span class="n">d8</span><span class="o">/</span><span class="mi">64</span> <span class="ss">Scope</span><span class="p">:</span><span class="no">Link</span>
</span><span class='line'>          <span class="no">UP</span> <span class="no">BROADCAST</span> <span class="no">RUNNING</span> <span class="no">MULTICAST</span>  <span class="ss">MTU</span><span class="p">:</span><span class="mi">1500</span>  <span class="ss">Metric</span><span class="p">:</span><span class="mi">1</span>
</span><span class='line'>          <span class="no">RX</span> <span class="ss">packets</span><span class="p">:</span><span class="mi">36</span> <span class="ss">errors</span><span class="p">:</span><span class="mi">0</span> <span class="ss">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="ss">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="ss">frame</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>          <span class="no">TX</span> <span class="ss">packets</span><span class="p">:</span><span class="mi">15</span> <span class="ss">errors</span><span class="p">:</span><span class="mi">0</span> <span class="ss">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="ss">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="ss">carrier</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>          <span class="ss">collisions</span><span class="p">:</span><span class="mi">0</span> <span class="ss">txqueuelen</span><span class="p">:</span><span class="mi">1000</span>
</span><span class='line'>          <span class="no">RX</span> <span class="ss">bytes</span><span class="p">:</span><span class="mi">5256</span> <span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">1</span> <span class="no">KiB</span><span class="p">)</span>  <span class="no">TX</span> <span class="ss">bytes</span><span class="p">:</span><span class="mi">998</span> <span class="p">(</span><span class="mi">998</span><span class="o">.</span><span class="mi">0</span> <span class="n">b</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ref: <a href="https://docs.vagrantup.com/v2/networking/public_network.html">https://docs.vagrantup.com/v2/networking/public_network.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Path Global para todos los Execs en Puppet]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/24/path-global-para-todos-los-execs-en-puppet/"/>
    <updated>2014-07-24T14:37:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/24/path-global-para-todos-los-execs-en-puppet</id>
    <content type="html"><![CDATA[<p>En Puppet si tenemos varios <code>Exec</code> para ejecutar comandos del sistema operativo podemos configurar el atributo <code>path</code> de forma global dentro del <code>site.pp</code> y con ello evitamos repetir código.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span> <span class="p">{</span> <span class="s2">&quot;restart-dns&quot;</span><span class="p">:</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;service named restart&quot;</span>
</span><span class='line'><span class="n">creates</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/named&quot;</span><span class="p">,</span>
</span><span class='line'><span class="n">refreshonly</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>site.pp</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Exec</span> <span class="p">{</span> <span class="n">path</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="s2">&quot;/bin/&quot;</span><span class="p">,</span> <span class="s2">&quot;/sbin/&quot;</span> <span class="p">,</span> <span class="s2">&quot;/usr/bin/&quot;</span><span class="p">,</span> <span class="s2">&quot;/usr/sbin/&quot;</span> <span class="o">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Controlando la ejecución de Exec en Puppet]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/23/controlando-la-ejecucion-de-exec-en-puppet/"/>
    <updated>2014-07-23T21:25:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/23/controlando-la-ejecucion-de-exec-en-puppet</id>
    <content type="html"><![CDATA[<p>En Puppet podemos ejecutar comando a nivel del sistema operativo por medio de <code>Exec</code>, en ocasiones sucede que tenemos declarada la sintaxis a ejecutar pero sucede que esta se aplica cada vez que corre el agente Puppet, Ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'>  <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>  <span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior instalará un rpm llamado <code>package.rpm</code> cada vez que corra el agente, lo que pisará las configuraciones ya realizadas en la instalación y post-instalación del rpm. Para evitar que esto suceda <code>Exec</code> maneja dos atributos <code>creates</code> y <code>onlyif</code> ambos como condicionantes para que se puede ejecutar el comando.
<li>creates</li>
Funciona del modo que para ejecutar el atributo <code>command</code> no tiene que existir &ldquo;algo&rdquo; que se define con el atributo <code>creates</code>, ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'><span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'><span class="n">creates</span> <span class="o">=&gt;</span> <span class="s1">&#39;/opt/rpm-directory/&#39;</span><span class="p">,</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior dice que; para que se ejecute el <code>exec</code> no tiene que estar creado el directorio <code>/opt/rpm-directory/</code>, si este ya esta creado, es por que ya tenemos instalado el rpm y no es necesario volver a instalarlo.</p>

<p><li>onlyif</li>
Funciona del modo que para ejecutar el atributo <code>command</code> el resultado del atributo <code>onlyif</code> debe retornar value 0 &ldquo;nada&rdquo; como respuesta a la condición, ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'><span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'><span class="n">onlyif</span> <span class="o">=&gt;</span> <span class="s2">&quot;ls /opt/ |grep rpm-directory&quot;</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior dice que; para que se ejecute el <code>exec</code> la salida del <code>onlyif</code> debe retornar 0. Si el rpm ya lo tenemos instalado, este va a crear el directorio por lo que para evitar que se siga instalando solo vemos si este ya fue creado. Si el rpm fue instalado, el <code>onlyif</code> retornará un <i>1</i> por lo que no se volverá a ejecutar nuevamente.</p>

<p>Link <a href="http://docs.puppetlabs.com/references/latest/type.html#exec-attribute">documentación</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Configurando Vagrant en OSX]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/07/configurando-vagrant-en-osx/"/>
    <updated>2014-07-07T15:30:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/07/configurando-vagrant-en-osx</id>
    <content type="html"><![CDATA[<p>En la búsqueda de correr máquinas virtuales de forma mas simple me he decidido instalar <code>Vagrant</code>, que es un entorno para la gestión de máquinas virtuales bajo mbiente VirtualBox. La mágia de Vagrant viene de la mano de VirtualBox ya que este tiene soporte para correr máquinas virtuales del tipo <i>headless</i> (algo así como máquinas que corren en un servidor pero no sabes donde).</p>

<h4>Instalación de Vagrant en OSX 10.9.3</h4>

<p>Lo primero es bajar la versión correspondiente de <a href="http://www.vagrantup.com/downloads">Vagrant</a> y lo mismo para <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>. Una vez descargado ambos paquetes (dmg) se instalan como cualquier otra programa para mac.
Es necesario tener instalado una librerias Ruby para el trabajo con Vagrant, proceso que se realiza con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">vagrant</span>
</span></code></pre></td></tr></table></div></figure>


<p>La gestión de las máquinas virtuales en Vagrant se realizan mediante el comando <code>vagrant</code> <i>(init, up, destroy, ssh, resume, suspend, halt y muchas más)</i>, todas las opciones que tiene este comando figuran en la <a href="http://docs.vagrantup.com/v2/cli/">documentación</a></p>

<h4>Instalando nuestro primer Box</h4>

<p>Lo primero que tenemos que hacer es bajar nuestro Box, que será la <i>imagen base</i> desde donde crearemos nuestras máquinas virtuales:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vagrant</span> <span class="n">box</span> <span class="n">add</span> <span class="no">CentOS</span>  <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2</span><span class="n">creatives</span><span class="o">/</span><span class="n">vagrant</span><span class="o">-</span><span class="n">centos</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v6</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">centos64</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mi">20140116</span><span class="o">.</span><span class="n">box</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bajamos y agregamos un nuevo Box de sistema que se llama &ldquo;Centos&rdquo; que se encuentra hosteado remotamente, puedes ver la infinidad de Box disponibles <a href="http://www.vagrantbox.es/">acá</a>
Podemos ver los Box instalados con el siguiente comando</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vagrant</span> <span class="n">box</span> <span class="n">list</span>
</span><span class='line'><span class="no">CentOS</span> <span class="p">(</span><span class="n">virtualbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Corriendo nuesta máquina virtual</h4>

<p>Teniendo nuestro Box, podemos instanciar nuesta primera máquina virtual para lo cual tenemos que ejecutar el comando <code>vagrant init</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">init</span>
</span><span class='line'><span class="n">A</span> <span class="sb">`Vagrantfile`</span> <span class="n">has</span> <span class="n">been</span> <span class="n">placed</span> <span class="k">in</span> <span class="n">this</span> <span class="n">directory</span><span class="o">.</span> <span class="no">You</span> <span class="n">are</span> <span class="n">now</span>
</span><span class='line'><span class="n">ready</span> <span class="n">to</span> <span class="sb">`vagrant up`</span> <span class="n">your</span> <span class="n">first</span> <span class="n">virtual</span> <span class="n">environment!</span> <span class="no">Please</span> <span class="n">read</span>
</span><span class='line'><span class="n">the</span> <span class="n">comments</span> <span class="k">in</span> <span class="n">the</span> <span class="no">Vagrantfile</span> <span class="n">as</span> <span class="n">well</span> <span class="n">as</span> <span class="n">documentation</span> <span class="n">on</span>
</span><span class='line'><span class="sb">`vagrantup.com`</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">using</span> <span class="no">Vagrant</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior creará un archivo de configuración base llamado Vagrantfile, donde se definieran una seríe de instrucción con las caracteristicas internas (ip, hostname, puertos, servicios) asociadas al SO, como las externas (memoria, cpu, etc) asociadas a VirtualBox, para el caso la dejaremos por defecto esta configurción.
Luego de tener creado nuestro <code>Vagrantfile</code> creado, podemos iniciar nuestra nueva instancia de máquina virtual:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">up</span>
</span><span class='line'><span class="no">Bringing</span> <span class="n">machine</span> <span class="s1">&#39;default&#39;</span> <span class="n">up</span> <span class="n">with</span> <span class="s1">&#39;virtualbox&#39;</span> <span class="n">provider</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Importing</span> <span class="n">base</span> <span class="n">box</span> <span class="s1">&#39;Centos&#39;</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Matching</span> <span class="no">MAC</span> <span class="n">address</span> <span class="k">for</span> <span class="no">NAT</span> <span class="n">networking</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Setting</span> <span class="n">the</span> <span class="nb">name</span> <span class="n">of</span> <span class="n">the</span> <span class="ss">VM</span><span class="p">:</span> <span class="no">Puppet_default_1404758552103_56627</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Clearing</span> <span class="n">any</span> <span class="n">previously</span> <span class="n">set</span> <span class="n">network</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Preparing</span> <span class="n">network</span> <span class="n">interfaces</span> <span class="n">based</span> <span class="n">on</span> <span class="n">configuration</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">Adapter</span> <span class="mi">1</span><span class="p">:</span> <span class="n">nat</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Forwarding</span> <span class="n">ports</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="mi">22</span> <span class="o">=&gt;</span> <span class="mi">2222</span> <span class="p">(</span><span class="n">adapter</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Booting</span> <span class="no">VM</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Waiting</span> <span class="k">for</span> <span class="n">machine</span> <span class="n">to</span> <span class="n">boot</span><span class="o">.</span> <span class="no">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="n">few</span> <span class="n">minutes</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="ss">address</span><span class="p">:</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">2222</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="ss">username</span><span class="p">:</span> <span class="n">vagrant</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="n">auth</span> <span class="nb">method</span><span class="p">:</span> <span class="kp">private</span> <span class="n">key</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="ss">Warning</span><span class="p">:</span> <span class="no">Remote</span> <span class="n">connection</span> <span class="n">disconnect</span><span class="o">.</span> <span class="no">Retrying</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Machine</span> <span class="n">booted</span> <span class="ow">and</span> <span class="n">ready!</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Checking</span> <span class="k">for</span> <span class="n">guest</span> <span class="n">additions</span> <span class="k">in</span> <span class="no">VM</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Mounting</span> <span class="n">shared</span> <span class="n">folders</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="sr">/vagrant =&gt; /</span><span class="no">Users</span><span class="o">/</span><span class="no">Miguel</span><span class="o">/</span><span class="no">VagrantVM</span><span class="o">/</span><span class="no">Puppet</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora, la VM se encuentra corriendo en nuestro equipo. Podemos conectarnos con el comando <code>vagrant ssh</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span>
</span><span class='line'><span class="o">[</span><span class="n">vagrant</span><span class="vi">@vagrant</span><span class="o">-</span><span class="n">centos64</span> <span class="o">~]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por defecto el nombre con que queda la VM y se puede ver mediante la GUI de VirtualBox no es para nada descriptivo, pero puede ser modificado editando el archivo <code>Vagranfile</code> adicionando la variable <code>name</code> de la sección <code>config.vm.provider</code> (líneas nº 9,10,11)  .</p>

<p><img class="center" src="http://mcoam.github.io/images/vagrantDefaultName.png"></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">cat</span> <span class="no">Vagrantfile</span>
</span><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;Centos&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppetmaster</span><span class="o">|</span>
</span><span class='line'>     <span class="n">puppetmaster</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;puppetmaster&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Podemos ver el nuevo nombre por línea de comando (Nombre que será también el de la GUI de VirtualBox)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="no">VBoxManage</span> <span class="n">list</span> <span class="n">runningvms</span>
</span><span class='line'><span class="s2">&quot;puppetmaster&quot;</span> <span class="p">{</span><span class="n">c980cd9e</span><span class="o">-</span><span class="mi">3329</span><span class="o">-</span><span class="mi">4</span><span class="n">aa8</span><span class="o">-</span><span class="mi">8</span><span class="n">d58</span><span class="o">-</span><span class="n">b84e389fff68</span><span class="p">}</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>No esta demás el link de la <a href="https://docs.vagrantup.com">documentación</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Módulo SSH Puppet y Hiera]]></title>
    <link href="http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/"/>
    <updated>2014-06-26T21:28:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera</id>
    <content type="html"><![CDATA[<p>El siguiente es un módulo de Puppet para la administración del servicio ssh en Linux (Rhel/Debian). La idea, de módulo es tomar los valores de las variables <code>port</code> <code>usedns</code> y <code>permit_root_login</code>.</p>

<p><li>Clase init.pp</li>
Esta clase lo que hace es heredar las definición de variables que nosotros tenemos en nuestra clase <code>params.pp</code> e instancia el orden de la ejecución de las clases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">init</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="n">sshmcoa</span> <span class="p">(</span>
</span><span class='line'>    <span class="vg">$port</span>               <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$usedns</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:ensure</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$port</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$service_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:service_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_file</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_file</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$package_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:package_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_template</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'><span class="p">)</span> <span class="n">inherits</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::install&#39;</span><span class="p">:</span> <span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::config&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::service&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Class</span> <span class="o">[</span><span class="s1">&#39;sshmcoa&#39;</span><span class="o">]</span>
</span><span class='line'> <span class="c1">#notify {&quot;EL PUERTO ES: $port&quot;:}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase params.pp</li>
En esta clase se definen todos los parámetros a configurar por la clase dependiendo del sistema operativo (familia RedHat o familia Debian)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">params</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span><span class="p">{</span>
</span><span class='line'>    <span class="vg">$port</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$usedns</span>       <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="s1">&#39;present&#39;</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$listen_address</span>     <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="s1">&#39;sshmcoa/sshd_config.conf.erb&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>          <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;sshd&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;openssh-server&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<p><li>Clase install.pp</li>
Esta es la clase encargada de la instalación del paquete para el servicio ssh, dependiendo del <code>osfamily</code> se instalará el pauete <code>ssh</code> o <code>openssh-server</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">install</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:install</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase service.pp</li>
Se configurar las opciones propias del servicio ssh</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">service</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:service</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">service</span> <span class="p">{</span><span class="s2">&quot;$service_name&quot;</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasstatus</span>  <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasrestart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">enable</span>      <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="nb">require</span>    <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span>    
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase config.pp</li>
Configuramos los valores del archivo sshd_config. El nombre del archivo viene heredado de la de la clase principal bajo la variable <code>$config_file</code>, y el contenido <code>content</code> que tendrá el archivo es creado mediante un template <code>.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="c1"># cat config.pp </span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">file</span> <span class="p">{</span> <span class="vg">$config_file</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="vg">$ensure</span><span class="p">,</span>
</span><span class='line'>          <span class="n">owner</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">group</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">mode</span>    <span class="o">=&gt;</span> <span class="s1">&#39;600&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="vg">$config_template</span><span class="p">),</span>
</span><span class='line'>      <span class="n">notify</span>  <span class="o">=&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="s2">&quot;$service_name&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo sshd_config.conf.erb</li>
Este es el arhivo .erb que se crea con el contenido dinámico con el valor de las variables que fueron ingresadas desde <code>Hiera</code>. Para el caso de la clase, los valores que modificamos son <code>port</code> <code>usedns</code> y <code>permit_root_login</code> y para importalos al template tenemos que utilizar el formato <code>&lt;%= @NOMBRE_DE_VARIABLE %></code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">erb</span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="o">&lt;</span><span class="sx">%= @port %&gt;</span>
</span><span class='line'><span class="sx">Protocol 2</span>
</span><span class='line'><span class="sx">SyslogFacility AUTHPRIV</span>
</span><span class='line'><span class="sx">PasswordAuthentication yes</span>
</span><span class='line'><span class="sx">ChallengeResponseAuthentication no</span>
</span><span class='line'><span class="sx">GSSAPIAuthentication yes</span>
</span><span class='line'><span class="sx">GSSAPICleanupCredentials yes</span>
</span><span class='line'><span class="sx">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="sx">PermitRootLogin &lt;%=</span> <span class="vi">@permit_root_login</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">UsePAM yes</span>
</span><span class='line'><span class="sx">#UseDNS Puppet</span>
</span><span class='line'><span class="sx">UseDNS &lt;%= @usedns %&gt;</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo Hiera.yaml</li>
Dentro de nuestro <code>common.yaml</code> configuramos los valores que tendrán las variables del servicio ssh.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">hieradata</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">common</span><span class="o">.</span><span class="n">yaml</span>
</span><span class='line'><span class="o">---</span>
</span><span class='line'><span class="ss">classes</span><span class="p">:</span>
</span><span class='line'>     <span class="o">-</span> <span class="n">sshmcoa</span>
</span><span class='line'>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:port</span><span class="p">:</span> <span class="s1">&#39;2222&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente cuando conectemos el nodo veremos como se ejecuta la clase con los valores que le hemos pasado</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># !puppet</span>
</span><span class='line'><span class="n">puppet</span> <span class="n">agent</span> <span class="o">--</span><span class="nb">test</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Retrieving</span> <span class="n">plugin</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">root_home</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">puppet_vardir</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">pe_version</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">hosts_managed</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">facter_dot_d</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Caching</span> <span class="n">catalog</span> <span class="k">for</span> <span class="n">node1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Applying</span> <span class="n">configuration</span> <span class="n">version</span> <span class="s1">&#39;1401042981&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Install</span><span class="o">/</span><span class="no">Package</span><span class="o">[</span><span class="n">openssh</span><span class="o">-</span><span class="n">server</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="n">created</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span>
</span><span class='line'><span class="o">---</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mo">03</span><span class="o">.</span><span class="mo">000000000</span> <span class="o">-</span><span class="mo">0300</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">FileBucket</span> <span class="n">adding</span> <span class="p">{</span><span class="n">md5</span><span class="p">}</span><span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Filebucketed</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span> <span class="n">to</span> <span class="n">puppet</span> <span class="n">with</span> <span class="n">sum</span> <span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span> <span class="n">content</span> <span class="n">changed</span> <span class="s1">&#39;{md5}53ad75eb1f2269d23f6e4228353cbca3&#39;</span> <span class="n">to</span> <span class="s1">&#39;{md5}22a041c1bbfd208de0259a2403bf3cbb&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Scheduling</span> <span class="n">refresh</span> <span class="n">of</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="k">ensure</span> <span class="n">changed</span> <span class="s1">&#39;stopped&#39;</span> <span class="n">to</span> <span class="s1">&#39;running&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span><span class="p">:</span> <span class="no">Unscheduling</span> <span class="n">refresh</span> <span class="n">on</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="no">Sshmcoa</span><span class="o">/</span><span class="no">Notify</span><span class="o">[</span><span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span><span class="o">]/</span><span class="ss">message</span><span class="p">:</span> <span class="n">defined</span> <span class="s1">&#39;message&#39;</span> <span class="n">as</span> <span class="s1">&#39;EL PUERTO ES: 2222&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">Finished</span> <span class="n">catalog</span> <span class="n">run</span> <span class="k">in</span> <span class="mi">16</span><span class="o">.</span><span class="mi">27</span> <span class="n">seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si vemos el contenido observaremos que se creó tal cual esta definido en nuestro template erb.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat /etc/ssh/sshd_config </span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="mi">2222</span>
</span><span class='line'><span class="no">Protocol</span> <span class="mi">2</span>
</span><span class='line'><span class="no">SyslogFacility</span> <span class="no">AUTHPRIV</span>
</span><span class='line'><span class="no">PasswordAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">ChallengeResponseAuthentication</span> <span class="n">no</span>
</span><span class='line'><span class="no">GSSAPIAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">GSSAPICleanupCredentials</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="no">PermitRootLogin</span> <span class="n">no</span>
</span><span class='line'><span class="no">UsePAM</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">#UseDNS Puppet</span>
</span><span class='line'><span class="no">UseDNS</span> <span class="n">no</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Desactivar nodo PuppetDB]]></title>
    <link href="http://mcoam.github.io/blog/2014/06/03/desactivar-nodo-puppetdb/"/>
    <updated>2014-06-03T18:44:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/06/03/desactivar-nodo-puppetdb</id>
    <content type="html"><![CDATA[<p>En el caso de querer <i>desactivar</i> un nodo de PuppetDB lo podemos realizar con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">puppet</span> <span class="n">node</span> <span class="n">deactivate</span> <span class="n">node1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con lo anterior, el nodo &ldquo;desaparecerá&rdquo; de nuestro Dashboard .</p>

<p>Referencia <a href="http://docs.puppetlabs.com/puppetdb/1/maintain_and_tune.html#deactivate-decommissioned-nodes">acá</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Configurar PuppetBoard]]></title>
    <link href="http://mcoam.github.io/blog/2014/06/01/configurar-puppetboard/"/>
    <updated>2014-06-01T22:39:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/06/01/configurar-puppetboard</id>
    <content type="html"><![CDATA[<p>Para facilitar la administración de Puppet (opensource) tenemos una nueva herramienta que se llama PuppetBoard su objetivo es dar accesos a la data que nosotros tenemos almacenada en nuestro PuppetDB de forma gráfica vía web, además de permitirnos ver el funcionamiento y reportes de los nodos al momentos de conectarse al nuestro Master.
PuppetBoard difiere de Pupet Dansboard en:
<li>Esta escrito en Python no en Ruby </li>
<li>No almacena ningún tipo de data, toda información es requerida del PuppetDB</li>
<li>No es posible funcionar sin PuppetDB</li></p>

<p>La instalación del servicio no es compleja, puedes ver con lujo y detalle todos los pasos <a href="https://github.com/nedap/puppetboard">acá</a>. Para nuestro caso el proceso de instalación es el siguiente:</p>

<h4>Instalación</h4>

<p><img src="http://mcoam.github.io/images/puppetboard.png"></p>

<p>Nota: Nuestra instalación será en base a Apache + mod-wsi</p>

<p>Creamos nuestro directorio web de PuppetBoard</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span>
</span></code></pre></td></tr></table></div></figure>


<p>Clonamos el fuente</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">git</span> <span class="nb">clone</span> <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">nedap</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">.</span><span class="n">git</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span>
</span></code></pre></td></tr></table></div></figure>


<p>O lo instalamos de forma manual</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">pip</span> <span class="n">install</span> <span class="n">puppetboard</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instalamos paquetería necesaria</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">yum</span> <span class="n">install</span> <span class="n">mod_wsgi</span> <span class="n">python</span><span class="o">-</span><span class="n">pip</span>
</span></code></pre></td></tr></table></div></figure>


<p>Copiamos el archivo de ejemplo <i>/usr/lib/python2.6/site-packages/puppetboard/default_settings.py</i> a la ruta <i>/var/www/puppetboard</i>, la nombramos <i>settings.py</i></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">cp</span> <span class="sr">/usr/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span><span class="n">default_settings</span><span class="o">.</span><span class="n">py</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span>
</span><span class='line'><span class="err">$</span> <span class="n">mv</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span><span class="n">default_settings</span><span class="o">.</span><span class="n">py</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span><span class="n">settings</span><span class="o">.</span><span class="n">py</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y colocamos el siguiente contenido</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">PUPPETDB_HOST</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span class='line'><span class="no">PUPPETDB_PORT</span> <span class="o">=</span> <span class="mi">8080</span>
</span><span class='line'><span class="c1">#PUPPETDB_SSL_VERIFY = True</span>
</span><span class='line'><span class="no">PUPPETDB_KEY</span> <span class="o">=</span> <span class="no">None</span>
</span><span class='line'><span class="no">PUPPETDB_CERT</span> <span class="o">=</span> <span class="no">None</span>
</span><span class='line'><span class="no">PUPPETDB_TIMEOUT</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'><span class="no">DEV_LISTEN_HOST</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span>
</span><span class='line'><span class="no">DEV_LISTEN_PORT</span> <span class="o">=</span> <span class="mi">5000</span>
</span><span class='line'><span class="no">UNRESPONSIVE_HOURS</span> <span class="o">=</span> <span class="mi">2</span>
</span><span class='line'><span class="no">ENABLE_QUERY</span> <span class="o">=</span> <span class="no">True</span>
</span><span class='line'><span class="no">LOGLEVEL</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>En el mismo directorio del PuppetBoard, creamos el archivo <i>wsgi.py</i> con el siguiente contenido</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">from</span> <span class="n">__future__</span> <span class="n">import</span> <span class="n">absolute_import</span>
</span><span class='line'><span class="n">import</span> <span class="n">os</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Needed if a settings.py file exists</span>
</span><span class='line'><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">[</span><span class="s1">&#39;PUPPETBOARD_SETTINGS&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/var/www/puppetboard/settings.py&#39;</span>
</span><span class='line'><span class="n">from</span> <span class="n">puppetboard</span><span class="o">.</span><span class="n">app</span> <span class="n">import</span> <span class="n">app</span> <span class="n">as</span> <span class="n">application</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora, creamos el archivo <i>/etc/httpd/conf.d/wdgi.conf</i> para cargar el módulo en Apache con el siguiente contenido</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">LoadModule</span> <span class="n">wsgi_module</span> <span class="n">modules</span><span class="o">/</span><span class="n">mod_wsgi</span><span class="o">.</span><span class="n">so</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, creamos el archivo de configuración para el virtualhosts que nos permita el acceso al PuppetBoard vía web</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">touch</span> <span class="sr">/etc/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">.</span><span class="n">conf</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y colocamos la siguiente configuración</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="no">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">80</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="no">ServerName</span> <span class="n">puppet</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'>    <span class="no">WSGIDaemonProcess</span> <span class="n">puppetboard</span> <span class="n">user</span><span class="o">=</span><span class="n">apache</span> <span class="n">group</span><span class="o">=</span><span class="n">apache</span> <span class="n">threads</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'>    <span class="no">WSGIScriptAlias</span> <span class="o">/</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span><span class="n">wsgi</span><span class="o">.</span><span class="n">py</span>
</span><span class='line'>    <span class="no">ErrorLog</span> <span class="sr">/var/</span><span class="n">log</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">log</span>
</span><span class='line'>    <span class="no">CustomLog</span> <span class="sr">/var/</span><span class="n">log</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">log</span> <span class="n">combined</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">Alias</span> <span class="sr">/static /us</span><span class="n">r</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span><span class="n">static</span><span class="o">/</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">&lt;</span><span class="no">Directory</span> <span class="sr">/usr/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="no">AuthType</span> <span class="no">Basic</span>
</span><span class='line'>        <span class="no">AuthName</span> <span class="s2">&quot;Authentication Required&quot;</span>
</span><span class='line'>        <span class="no">AuthUserFile</span> <span class="s2">&quot;/var/www/puppetboard/.htpasswd&quot;</span>
</span><span class='line'>        <span class="no">Require</span> <span class="n">valid</span><span class="o">-</span><span class="n">user</span>
</span><span class='line'>        <span class="no">Order</span> <span class="n">allow</span><span class="p">,</span><span class="n">deny</span>
</span><span class='line'>        <span class="no">Allow</span> <span class="n">from</span> <span class="n">all</span>
</span><span class='line'>       <span class="no">WSGIProcessGroup</span> <span class="n">puppetboard</span>
</span><span class='line'>        <span class="no">WSGIApplicationGroup</span> <span class="sx">%{GLOBAL}</span>
</span><span class='line'>      <span class="c1">#  Require all granted</span>
</span><span class='line'><span class="c1">#      Order deny,allow</span>
</span><span class='line'><span class="c1">#        Allow from all</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="sr">/Directory&gt;</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="no">VirtualHost</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Creando el usuario para el acceso web</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">puppetboard</span><span class="o">]</span><span class="err">$</span> <span class="n">cd</span> <span class="sr">/var/</span><span class="n">www</span><span class="o">/</span><span class="n">puppetboard</span><span class="o">/</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">puppetboard</span><span class="o">]</span><span class="err">$</span> <span class="n">htpasswd</span> <span class="o">-</span><span class="n">c</span> <span class="o">.</span><span class="n">htpasswd</span> <span class="n">admin</span> <span class="c1">#colocamos el Password para el acceso web</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente podemos acceder luego de ingresar el usuario y password.</p>

<p><img src="http://mcoam.github.io/images/puppetboardnodes.png"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reenviar un correo en zimbra basado en el Subject]]></title>
    <link href="http://mcoam.github.io/blog/2014/03/21/reenviar-un-correo-en-zimbra-basado-en-el-subject/"/>
    <updated>2014-03-21T14:10:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2014/03/21/reenviar-un-correo-en-zimbra-basado-en-el-subject</id>
    <content type="html"><![CDATA[<p>Para reenviar un que contenga un <i>Subject</i> en particular hacia otra casilla en Zimbra podemos realizar los siguiente</p>

<p>En el archivo de configuración de postfix <i>/opt/zimbra/postfix/conf/main.cf.default</i> colocamos la referencia al hash para header_checks</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">header_checks</span> <span class="o">=</span> <span class="nl">regexp:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">header_checks</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dependiendo de la versión de Zimbra, la anterior configuración funcionará sin problemas, de lo contrario la configuración referente al header_checks tenemos que hacerla en el archivo <i>/opt/zimbra/postfix/conf/zmmta.cf</i> donde adicionaremos la siguiente línea (antes del parámetro RESTART mta)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">POSTCONF</span> <span class="n">header_checks</span>  <span class="nl">regexp:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">header_checks</span>
</span></code></pre></td></tr></table></div></figure>


<p>
En el archivo  <i>/opt/zimbra/postfix/conf/header_checks</i> adicionamos la expresión regular que tendrá el subject</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">/^</span><span class="nl">Subject:</span> <span class="n">MIGUELCOA</span><span class="o">/</span> <span class="n">REDIRECT</span> <span class="n">mcoa</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>Recargarmos el servicio MTA</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">zmmtactl</span> <span class="n">reload</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y desde ahora, cada vez que desde el servidor zimbra salga un correo que en su asunto contenga &ldquo;MIGUELCOA&rdquo; será enviada una copia hacia la casilla mcoa\@example.com</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Migrando usuarios/password Postfix to Zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2014/01/15/migrando-usuarios-slash-password-postfix-to-zimbra/"/>
    <updated>2014-01-15T09:58:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2014/01/15/migrando-usuarios-slash-password-postfix-to-zimbra</id>
    <content type="html"><![CDATA[<p>La idea del siguiente script es; primero crear la cuenta con una password temporal y luego configurar la password original del usuario, ambos valores son sacados del <i>/etc/shadow</i></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c">##Miguel Coa M.</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">csv</span>
</span><span class='line'><span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s">&#39;shadow&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;:&#39;</span> <span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">user</span>     <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                <span class="n">passwd</span>   <span class="o">=</span> <span class="s">&quot;&#39;crypt{&quot;</span> <span class="o">+</span> <span class="n">row</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="s">&quot;}&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">print</span> <span class="s">&quot;ca {}@domain.com tmpPSW&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>                <span class="k">print</span> <span class="s">&quot;ma {}@domain.com userPassword  {}  &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">passwd</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y como resultado nos arrojará por pantalla</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">ca</span> <span class="n">varaya</span><span class="nd">@domain.com</span> <span class="n">tmpPSW</span>
</span><span class='line'><span class="n">ma</span> <span class="n">varaya</span><span class="nd">@domain.com</span> <span class="n">userPassword</span>  <span class="s">&#39;crypt{$1$6RT62jZZ$sFlv.MIII4PuKISBaap030}&#39;</span>
</span><span class='line'><span class="n">ca</span> <span class="n">cgalaz</span><span class="nd">@domain.com</span> <span class="n">tmpPSW</span>
</span><span class='line'><span class="n">ma</span> <span class="n">cgalaz</span><span class="nd">@domain.com</span> <span class="n">userPassword</span>  <span class="s">&#39;crypt{$1$bAEOlC0N$4t.3zCGDb.RFc0vmxd2UB0}&#39;</span>
</span><span class='line'><span class="n">ca</span> <span class="n">ctagle</span><span class="nd">@domain.com</span> <span class="n">tmpPSW</span>
</span><span class='line'><span class="n">ma</span> <span class="n">ctagle</span><span class="nd">@domain.com</span> <span class="n">userPassword</span>  <span class="s">&#39;crypt{$1$L7vlV7Me$orB2TCnqn.JeoVQpKsr6P0}&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Valor que los podemos almacenar en un archivo y los ejecutamos pasandolo como parámetro al comando <i>zmprov</i>. Si ya tenemos creadas las cuentas podemos comentar el primer print, para que solo las modifique.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creando cuentas Zimbra desde un CSV]]></title>
    <link href="http://mcoam.github.io/blog/2014/01/14/creando-cuentas-zimbra-desde-un-csv/"/>
    <updated>2014-01-14T17:38:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2014/01/14/creando-cuentas-zimbra-desde-un-csv</id>
    <content type="html"><![CDATA[<p>El siguiente script nos permite crear las cuentas en Zimbra desde un CSV y automatizar el proceso. El CSV en donde tenemos las cuentas, tiene el siguiente formato:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">cponce</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="n">Claudia</span><span class="p">;</span><span class="n">Ponce</span><span class="p">;</span><span class="n">TMPpasswd</span>
</span><span class='line'><span class="n">cquintana</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="n">Cristofer</span><span class="p">;</span><span class="n">Quintana</span><span class="p">;</span><span class="n">TMPpasswd</span>
</span><span class='line'><span class="n">ctello</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="n">Cristian</span><span class="p">;</span><span class="n">Tello</span><span class="p">;</span><span class="n">TMPpasswd</span>
</span><span class='line'><span class="n">eperalta</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="p">;</span><span class="n">Edgar</span><span class="p">;</span><span class="n">Peralta</span><span class="p">;</span><span class="n">TMPpasswd</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y el script</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="n">import</span> <span class="n">csv</span>
</span><span class='line'><span class="n">with</span> <span class="n">open</span> <span class="p">(</span><span class="err">&#39;</span><span class="n">Europarts</span><span class="p">.</span><span class="n">csv</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">rb</span><span class="err">&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="nl">f:</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="p">.</span><span class="n">reader</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="sc">&#39;;&#39;</span> <span class="p">)</span> <span class="err">#</span><span class="n">delimiter</span> <span class="n">tabulador</span> <span class="err">\</span><span class="n">t</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="nl">reader:</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">mail</span>     <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>                <span class="n">name</span>     <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>                <span class="n">lastname</span> <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span class='line'>                <span class="n">name2</span>    <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sc">&#39; &#39;</span> <span class="o">+</span> <span class="n">row</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span class='line'>      <span class="n">passwd</span>    <span class="o">=</span> <span class="n">row</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">print</span> <span class="s">&quot;ca {0} &#39;{1}&#39; displayName &#39;{2}&#39; sn &#39;{3}&#39; cn &#39;{4}&#39;&quot;</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">mail</span><span class="p">,</span><span class="n">passwd</span><span class="p">,</span><span class="n">name2</span><span class="p">.</span><span class="n">title</span><span class="p">(),</span><span class="n">lastname</span><span class="p">.</span><span class="n">title</span><span class="p">(),</span><span class="n">name2</span><span class="p">.</span><span class="n">title</span><span class="p">())</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior, imprimerá por pantalla lo siguiente:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">ca</span> <span class="n">cponce</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="err">&#39;</span><span class="n">TMPpasswd</span><span class="err">&#39;</span> <span class="n">displayName</span> <span class="err">&#39;</span><span class="n">Claudia</span> <span class="n">Ponce</span><span class="err">&#39;</span> <span class="n">sn</span> <span class="err">&#39;</span><span class="n">Ponce</span><span class="err">&#39;</span> <span class="n">cn</span> <span class="err">&#39;</span><span class="n">Claudia</span> <span class="n">Ponce</span><span class="err">&#39;</span>
</span><span class='line'><span class="n">ca</span> <span class="n">cquintana</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="err">&#39;</span><span class="n">TMPpasswd</span><span class="err">&#39;</span> <span class="n">displayName</span> <span class="err">&#39;</span><span class="n">Cristofer</span> <span class="n">Quintana</span><span class="err">&#39;</span> <span class="n">sn</span> <span class="err">&#39;</span><span class="n">Quintana</span><span class="err">&#39;</span> <span class="n">cn</span> <span class="err">&#39;</span><span class="n">Cristofer</span> <span class="n">Quintana</span><span class="err">&#39;</span>
</span><span class='line'><span class="n">ca</span> <span class="n">ctello</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="err">&#39;</span><span class="n">TMPpasswd</span><span class="err">&#39;</span> <span class="n">displayName</span> <span class="err">&#39;</span><span class="n">Cristian</span> <span class="n">Tello</span><span class="err">&#39;</span> <span class="n">sn</span> <span class="err">&#39;</span><span class="n">Tello</span><span class="err">&#39;</span> <span class="n">cn</span> <span class="err">&#39;</span><span class="n">Cristian</span> <span class="n">Tello</span><span class="err">&#39;</span>
</span><span class='line'><span class="n">ca</span> <span class="n">eperalta</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="err">&#39;</span><span class="n">TMPpasswd</span><span class="err">&#39;</span> <span class="n">displayName</span> <span class="err">&#39;</span><span class="n">Edgar</span> <span class="n">Peralta</span><span class="err">&#39;</span> <span class="n">sn</span> <span class="err">&#39;</span><span class="n">Peralta</span><span class="err">&#39;</span> <span class="n">cn</span> <span class="err">&#39;</span><span class="n">Edgar</span> <span class="n">Peralta</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>La salida se puede mandar de forma directa dentro del script hacia un archivo y luego pasarlo por parametro al comando zmprov</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">zmprov</span> <span class="o">&lt;</span> <span class="n">zmCreateAccounts</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Configurar Nagios server y Pnp4nagios]]></title>
    <link href="http://mcoam.github.io/blog/2013/11/29/configurar-nagios-server-y-pnp4nagios/"/>
    <updated>2013-11-29T10:46:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/11/29/configurar-nagios-server-y-pnp4nagios</id>
    <content type="html"><![CDATA[<p>Si tienes un servidor Nagios como plataforma de monitoreo de servidores, es posible que en alguna ocasión puedas necesitar generar reportes de la estadística (mensual, díaria, semanal, etc) para lo cual la versión open de Nagios Server no lo tiene integrado de forma nativa pero podemos solucionar con <a href="http://www.pnp4nagios.org/">pnp4nagios</a> y para realizarlo tenemos que hacer lo siguiente (asumiremos que ya tenemos nuestro Nagios Server funcionando)</p>

<p>Tenemos que tener instalado en el servidor rrdtool, perl-rrdtool y una serie de paquetería</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">yum</span> <span class="n">install</span> <span class="n">libdbi</span> <span class="n">rrdtool</span> <span class="n">perl</span><span class="o">-</span><span class="n">rrdtool</span> <span class="n">ruby</span> <span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">fonts</span><span class="o">-</span><span class="n">Type1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instalación php4nagios</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">wget</span> <span class="nl">http:</span><span class="c1">//downloads.sourceforge.net/project/pnp4nagios/PNP-0.6/pnp4nagios-0.6.21.tar.gz?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fpnp4nagios%2F&amp;ts=1372937581&amp;use_mirror=jaist</span>
</span><span class='line'><span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">pnp4nagios</span><span class="o">-</span><span class="mf">0.6.21</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
</span><span class='line'><span class="n">cd</span> <span class="n">pnp4nagios</span><span class="o">-</span><span class="mf">0.6.21</span>
</span><span class='line'><span class="p">.</span><span class="o">/</span><span class="n">configure</span> <span class="o">-</span><span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span> <span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">rrdtool</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rrdtool</span> <span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">nagios</span><span class="o">-</span><span class="n">user</span><span class="o">=</span><span class="n">nagios</span> <span class="o">-</span><span class="n">with</span><span class="o">-</span><span class="n">nagios</span><span class="o">-</span><span class="n">group</span><span class="o">=</span><span class="n">nagios</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior generará todo el proceso de compilación lo que finalmente arrojará algo similar a lo siguiente:
<img src="http://mcoam.github.io/assets/images/pnp4nagios.png"></p>

<p>Y luego lo compilamos e instalamos</p>

<!-- more -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">make</span> <span class="n">all</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span><span class="o">-</span><span class="n">webconf</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span><span class="o">-</span><span class="n">config</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span><span class="o">-</span><span class="n">init</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nos aseguramos que no tengamos ningún tipo de error en el proceso de compilación</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">Copiamos</span> <span class="n">los</span> <span class="n">archivos</span> <span class="n">de</span> <span class="n">configuraci</span><span class="err">ó</span><span class="n">n</span>
</span><span class='line'><span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span><span class="o">/</span><span class="n">etc</span>
</span><span class='line'><span class="n">cp</span> <span class="n">misccommands</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">misccommands</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cp</span> <span class="n">nagios</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">nagios</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cp</span> <span class="n">rra</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">rra</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cp</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pages</span><span class="o">/</span>
</span><span class='line'><span class="n">cp</span> <span class="n">web_traffic</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">web_traffic</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cd</span> <span class="p">..</span><span class="o">/</span><span class="n">check_commands</span>
</span><span class='line'><span class="n">cp</span> <span class="n">check_all_local_disks</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span>
</span><span class='line'><span class="n">check_all_local_disks</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cp</span> <span class="n">check_nrpe</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">check_nrpe</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">cp</span> <span class="n">check_nwstat</span><span class="p">.</span><span class="n">cfg</span><span class="o">-</span><span class="n">sample</span> <span class="n">check_nwstat</span><span class="p">.</span><span class="n">cf</span>
</span></code></pre></td></tr></table></div></figure>


<p>Configuración de servicio npcd</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">chkconfig</span> <span class="o">--</span><span class="n">add</span> <span class="n">npcd</span>
</span><span class='line'><span class="n">chkconfig</span> <span class="n">npcd</span> <span class="n">on</span>
</span><span class='line'><span class="n">service</span> <span class="n">npcd</span> <span class="n">start</span>
</span></code></pre></td></tr></table></div></figure>


<p>Test pnp4nagios</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="nl">http:</span><span class="c1">//server-ip/pnp4nagios</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Deberemos ver lo siguiente</p>

<p><img src="http://mcoam.github.io/assets/images/pnp4nagios-environment.png"></p>

<p>Como dice al final de la página, podemos eliminar el página de test</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">install</span><span class="p">.</span><span class="n">php</span>
</span></code></pre></td></tr></table></div></figure>


<p>Configuración de apache de pnp4nagios, donde tenemos instanciar nuestro archivo de password de acceso nagios modificando el valor</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">AuthUserFile</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nagios</span><span class="o">/</span><span class="n">passwd</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Reiniciamos apache</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">service</span> <span class="n">httpd</span> <span class="n">restart</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora tenemos que configurar nagios y que pueda interactuar y permitir la visualización de la gráfica. Para esto utilizaremos el modo <i>Bulk Mode with npcdmod</i> de pnp4nagios, para lo cual editamos el archivo de configuración nagios <i>/etc/nagios/nagios.cfg</i> , adicionando/moficiando los siguientes valores</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">broker_module</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">npcdmod</span><span class="p">.</span><span class="n">o</span> <span class="n">config_file</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">pnp4nagios</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">npcd</span><span class="p">.</span><span class="n">cfg</span>
</span><span class='line'><span class="n">process_performance_data</span><span class="o">=</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente, reiniciamos los servicios y empezará a ser reflejada la data de forma gráfica</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">service</span> <span class="n">npcd</span> <span class="n">restart</span> <span class="o">&amp;&amp;</span> <span class="n">service</span> <span class="n">nagios</span> <span class="n">restart</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://mcoam.github.io/assets/images/webpnp4.png"></p>

<p>Referencias</p>

<p><a href="http://www.productionmonkeys.net/guides/nagios/addons/pnp4nagios">http://www.productionmonkeys.net/guides/nagios/addons/pnp4nagios</a>
<a href="http://www.academia.edu/4142933/Install_pnp4nagios_on_Cent_OS">http://www.academia.edu/4142933/Install_pnp4nagios_on_Cent_OS</a>
<a href="http://eldespistado.com/instalacion-nagios-pnp4nagios-check_mk-nagvis-debian-7-wheezy/">http://eldespistado.com/instalacion-nagios-pnp4nagios-check_mk-nagvis-debian-7-wheezy/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tabulación con editor VIM]]></title>
    <link href="http://mcoam.github.io/blog/2013/11/27/tabulacion-con-editor-vim/"/>
    <updated>2013-11-27T08:32:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/11/27/tabulacion-con-editor-vim</id>
    <content type="html"><![CDATA[<p>En ocasiones al copiar y pegar texto hacia una archivo que está siendo accedido por medio del editor VIM, este queda con una mala tabulación (excesivamente corrida a la derecha) al momento de pegarla. La solución para eso es que antes de pegar el texto tenemos realizar lo siguiente en la misma ventana del editor</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="nl">type:</span> <span class="n">set</span> <span class="n">paste</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo otro, es agregar la línea <i>set paste</i> dentro de <i>/etc/vim/vimrc</i> .</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Automatizando instalaciones RedHat/Centos con KickStart]]></title>
    <link href="http://mcoam.github.io/blog/2013/11/11/automatizando-instalaciones-redhat-slash-centos-con-quickstart/"/>
    <updated>2013-11-11T20:04:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/11/11/automatizando-instalaciones-redhat-slash-centos-con-quickstart</id>
    <content type="html"><![CDATA[<p>En ocasiones y ante la repetitividad de la operación en algunas instalaciones y estar aburrido de realizar la misma operación por &ldquo;x&rdquo; veces, lo mejor en este escenario es automatizar la instalación mediante el método &ldquo;kickstart&rdquo;. Cuando uno hace una instalación mediante insterfaz gráfica en Redhat/Centos/Fedora (instalador RedHat) al final del proceso se crea un archivo de la instalación bajo <i>/root/anaconda-ks.cfg</i>. Este archivo lo podemos tomar y complementar la instalación que igura en el.
Bueno, si queremos utilizarlo como &ldquo;plantilla&rdquo; para otra instalación solo tenemos que tomar ese archivo y lo copiamos en un medio extraible (Ej. Usb).
Por ejemplo, y en el siguiente escenario, vamos a realizar una instalación tomando un archivo kickstart que sacamos de otra instalación y lo alojamos en un Usb el que será instanciado una vez que instalemos el SO.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp"># Kickstart file automatically generated by anaconda.</span>
</span><span class='line'>
</span><span class='line'><span class="n">install</span>
</span><span class='line'><span class="n">text</span>
</span><span class='line'><span class="n">cdrom</span>
</span><span class='line'><span class="n">key</span> <span class="o">--</span><span class="n">skip</span>
</span><span class='line'><span class="n">lang</span> <span class="n">en_US</span><span class="p">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'><span class="n">keyboard</span> <span class="n">la</span><span class="o">-</span><span class="n">latin1</span>
</span><span class='line'><span class="n">xconfig</span> <span class="o">--</span><span class="n">startxonboot</span>
</span><span class='line'><span class="cp">#network --device eth0 --onboot no --bootproto dhcp --hostname hosts.example.com</span>
</span><span class='line'><span class="cp">#network --device eth2 --bootproto static --ip 10.0.0.190 --netmask 255.255.255.0 --gateway 10.0.0.1 --hostname hosts.example.com</span>
</span><span class='line'><span class="n">rootpw</span> <span class="n">MyPassword</span>
</span><span class='line'><span class="n">firewall</span> <span class="o">--</span><span class="n">disabled</span>
</span><span class='line'><span class="n">authconfig</span> <span class="o">--</span><span class="n">enableshadow</span> <span class="o">--</span><span class="n">enablemd5</span>
</span><span class='line'><span class="n">selinux</span> <span class="o">--</span><span class="n">disabled</span>
</span><span class='line'><span class="n">timezone</span> <span class="n">America</span><span class="o">/</span><span class="n">Santiago</span>
</span><span class='line'><span class="n">firstboot</span> <span class="o">--</span><span class="n">disable</span>
</span><span class='line'><span class="n">services</span> <span class="o">--</span><span class="n">disabled</span> <span class="n">pcscd</span><span class="p">,</span><span class="n">hidd</span><span class="p">,</span><span class="n">bluetooth</span><span class="p">,</span><span class="n">pand</span><span class="p">,</span><span class="n">isdn</span><span class="p">,</span><span class="n">cups</span><span class="p">,</span><span class="n">avahi</span><span class="o">-</span><span class="n">daemon</span><span class="p">,</span><span class="n">cups</span><span class="p">,</span><span class="n">cups</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">daemon</span><span class="p">,</span><span class="n">pcscd</span><span class="p">,</span><span class="n">hplip</span><span class="p">,</span><span class="n">hidd</span><span class="p">,</span><span class="n">portmap</span><span class="p">,</span><span class="n">rpcidmapd</span><span class="p">,</span><span class="n">rpcsvcgssd</span><span class="p">,</span><span class="n">rpcgssd</span><span class="p">,</span><span class="n">sendmail</span><span class="p">,</span><span class="n">nfslock</span><span class="p">,</span><span class="n">mdmonitor</span><span class="p">,</span><span class="n">setroubleshoot</span><span class="p">,</span><span class="n">restorecond</span><span class="p">,</span><span class="n">rawdevices</span><span class="p">,</span><span class="n">smartd</span><span class="p">,</span><span class="n">qpidd</span><span class="p">,</span><span class="n">postfix</span>
</span><span class='line'><span class="n">reboot</span>
</span><span class='line'>
</span><span class='line'><span class="n">bootloader</span> <span class="o">--</span><span class="n">location</span><span class="o">=</span><span class="n">mbr</span> <span class="o">--</span><span class="n">driveorder</span><span class="o">=</span><span class="n">sda</span><span class="p">,</span><span class="n">sdb</span> <span class="o">--</span><span class="n">append</span><span class="o">=</span><span class="s">&quot;rhgb quiet&quot;</span>
</span><span class='line'><span class="cp"># The following is the partition information you requested</span>
</span><span class='line'><span class="cp"># Note that any partitions you deleted are not expressed</span>
</span><span class='line'><span class="cp"># here so unless you clear all partitions first, this is</span>
</span><span class='line'><span class="cp"># not guaranteed to work</span>
</span><span class='line'><span class="cp"># VALORES DE DISCOS EN MB</span>
</span><span class='line'><span class="n">clearpart</span> <span class="o">--</span><span class="n">linux</span> <span class="o">--</span><span class="n">drives</span><span class="o">=</span><span class="n">sda</span><span class="p">,</span><span class="n">sdb</span>
</span><span class='line'><span class="n">part</span> <span class="o">/</span><span class="n">boot</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span> <span class="o">--</span><span class="n">ondisk</span><span class="o">=</span><span class="n">sda</span>
</span><span class='line'><span class="n">part</span> <span class="n">pv</span><span class="mf">.8</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span> <span class="o">--</span><span class="n">grow</span> <span class="o">--</span><span class="n">ondisk</span><span class="o">=</span><span class="n">sda</span>
</span><span class='line'><span class="n">volgroup</span> <span class="n">vg00</span> <span class="o">--</span><span class="n">pesize</span><span class="o">=</span><span class="mi">32768</span> <span class="n">pv</span><span class="mf">.8</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">tmp</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">tmp</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">usr</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">usr</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">var</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">var</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">stage</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">stage</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">admin</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">admin</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span><span class="n">home</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">home</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'><span class="n">logvol</span> <span class="o">/</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">ext3</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">raiz</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">2000</span>
</span><span class='line'><span class="n">logvol</span> <span class="n">swap</span> <span class="o">--</span><span class="n">fstype</span> <span class="n">swap</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">swap</span> <span class="o">--</span><span class="n">vgname</span><span class="o">=</span><span class="n">vg00</span> <span class="o">--</span><span class="n">size</span><span class="o">=</span><span class="mi">1000</span>
</span><span class='line'>
</span><span class='line'><span class="o">%</span><span class="n">packages</span>
</span><span class='line'><span class="err">@</span><span class="n">admin</span><span class="o">-</span><span class="n">tools</span>
</span><span class='line'><span class="err">@</span><span class="n">base</span>
</span><span class='line'><span class="err">@</span><span class="n">core</span>
</span><span class='line'><span class="err">@</span><span class="n">development</span><span class="o">-</span><span class="n">libs</span>
</span><span class='line'><span class="err">@</span><span class="n">development</span><span class="o">-</span><span class="n">tools</span>
</span><span class='line'><span class="err">@</span><span class="n">dialup</span>
</span><span class='line'><span class="err">@</span><span class="n">editors</span>
</span><span class='line'><span class="err">@</span><span class="n">gnome</span><span class="o">-</span><span class="n">desktop</span>
</span><span class='line'><span class="err">@</span><span class="n">graphical</span><span class="o">-</span><span class="n">internet</span>
</span><span class='line'><span class="err">@</span><span class="n">java</span>
</span><span class='line'><span class="err">@</span><span class="n">legacy</span><span class="o">-</span><span class="n">software</span><span class="o">-</span><span class="n">development</span>
</span><span class='line'><span class="err">@</span><span class="n">legacy</span><span class="o">-</span><span class="n">software</span><span class="o">-</span><span class="n">support</span>
</span><span class='line'><span class="err">@</span><span class="n">printing</span>
</span><span class='line'><span class="err">@</span><span class="n">sound</span><span class="o">-</span><span class="n">and</span><span class="o">-</span><span class="n">video</span>
</span><span class='line'><span class="err">@</span><span class="n">text</span><span class="o">-</span><span class="n">internet</span>
</span><span class='line'><span class="err">@</span><span class="n">base</span><span class="o">-</span><span class="n">x</span>
</span><span class='line'><span class="n">kexec</span><span class="o">-</span><span class="n">tools</span>
</span><span class='line'><span class="n">iscsi</span><span class="o">-</span><span class="n">initiator</span><span class="o">-</span><span class="n">utils</span>
</span><span class='line'><span class="n">fipscheck</span>
</span><span class='line'><span class="n">device</span><span class="o">-</span><span class="n">mapper</span><span class="o">-</span><span class="n">multipath</span>
</span><span class='line'><span class="n">sgpio</span>
</span><span class='line'><span class="n">python</span><span class="o">-</span><span class="n">dmidecode</span>
</span><span class='line'><span class="n">imake</span>
</span><span class='line'><span class="n">emacs</span>
</span><span class='line'><span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">utils</span>
</span><span class='line'><span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">Xnest</span>
</span><span class='line'><span class="n">xorg</span><span class="o">-</span><span class="n">x11</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">Xvfb</span>
</span><span class='line'>
</span><span class='line'><span class="o">%</span><span class="n">post</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;################################&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;# Running Post Configuration   #&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;################################&quot;</span>
</span><span class='line'><span class="cp">#Adding a user &quot;oracle&quot;</span>
</span><span class='line'><span class="n">useradd</span> <span class="o">-</span><span class="n">m</span> <span class="n">oracle</span>
</span><span class='line'><span class="cp">#Password  &quot;oracle&quot;</span>
</span><span class='line'><span class="n">echo</span> <span class="n">oraclepass</span> <span class="o">|</span> <span class="n">passwd</span> <span class="o">--</span><span class="n">stdin</span> <span class="n">oracle</span>
</span><span class='line'>
</span><span class='line'><span class="n">echo</span> <span class="s">&quot;Syslog.conf&quot;</span>
</span><span class='line'><span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">syslog</span><span class="p">.</span><span class="n">conf</span>
</span><span class='line'><span class="cp">#texto de prueba dentro de syslog.conf</span>
</span><span class='line'><span class="n">EOF</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior, es una archivo típico de instalación en donde yo adiconé lo referente a que la instalación se haga en modo texto  lo que está bajo de la variable <i>%post</i>.
En este caso el archivo esta alojado en un USB (/dev/sdb1) , por lo cual al momento de carga el instalador tenemos que ejecutar la siguiente instrucción: <i>linux ks=hd:sdb1/ks.cfg</i></p>

<p><img src="http://s22.postimg.org/wft8hy2ip/Captura_de_pantalla_2013_11_08_a_la_s_21_08_58.png"></p>

<p>Luego el archivo será accedido y leido para realizar la instalación según lo que se detalló dentro de el.</p>

<p><img src="http://s23.postimg.org/468oi4u97/Captura_de_pantalla_2013_11_08_a_la_s_21_13_01.png">
</p></p>

<p>Este tipo de instalación se puede complementar con PXE y el que el kickstart pueda ser accedido mediante ftp, nfs, etc.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Script para ver quota de casilla Zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2013/11/06/script-para-ver-quota-de-casilla-zimbra/"/>
    <updated>2013-11-06T17:14:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/11/06/script-para-ver-quota-de-casilla-zimbra</id>
    <content type="html"><![CDATA[<p>A continuación un script que lista la quota que está utilizando una casilla de usuario y cuanto es la quota asignada (esto en el caso de tener) en Zimbra.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">all_account</span><span class="o">=</span><span class="err">`</span><span class="n">zmprov</span> <span class="o">-</span><span class="n">l</span> <span class="n">gaa</span><span class="err">`</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span> <span class="n">account</span> <span class="k">in</span> <span class="n">$</span><span class="p">{</span><span class="n">all_account</span><span class="p">}</span>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>    <span class="n">mb_size</span><span class="o">=</span><span class="err">`</span><span class="n">zmmailbox</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">m</span> <span class="n">$</span><span class="p">{</span><span class="n">account</span><span class="p">}</span> <span class="n">gms</span><span class="err">`</span><span class="p">;</span>
</span><span class='line'>    <span class="n">mb_quota</span><span class="o">=</span><span class="err">`</span><span class="n">zmprov</span> <span class="n">ga</span> <span class="n">$</span><span class="p">{</span><span class="n">account</span><span class="p">}</span> <span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">zimbraMailQuota</span> <span class="o">|</span><span class="n">cut</span> <span class="o">-</span><span class="n">d</span><span class="s">&quot;:&quot;</span> <span class="o">-</span><span class="n">f2</span><span class="err">`</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">[</span> <span class="n">$mb_quota</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">];</span> <span class="n">then</span>
</span><span class='line'>            <span class="n">echo</span> <span class="s">&quot;Mailbox size of ${account} = ${mb_size}&quot;</span>
</span><span class='line'>            <span class="n">count</span><span class="o">=</span><span class="err">`</span><span class="n">expr</span> <span class="n">length</span> <span class="n">$mb_quota</span><span class="err">`</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">[</span> <span class="n">$count</span> <span class="o">==</span> <span class="mi">8</span> <span class="p">];</span> <span class="n">then</span>
</span><span class='line'>                <span class="n">echo</span> <span class="s">&quot;Mailbox Quota is = `echo ${mb_quota}/1024/1024 | bc` MB &quot;</span>
</span><span class='line'>            <span class="k">else</span>
</span><span class='line'>                <span class="n">echo</span> <span class="s">&quot;Mailbox Quota is = `echo ${mb_quota}/1024/1024/1024 | bc` GB &quot;</span>
</span><span class='line'>            <span class="n">fi</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>            <span class="n">echo</span> <span class="s">&quot;Mailbox size of ${account}  = ${mb_size}&quot;</span>
</span><span class='line'>            <span class="n">echo</span> <span class="s">&quot;The Mailbox isn&#39;t Setting Quota&quot;</span>
</span><span class='line'>    <span class="n">fi</span>
</span><span class='line'>    <span class="n">echo</span> <span class="s">&quot;______________________&quot;</span>
</span><span class='line'><span class="n">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior, arrojará por pantalla valores como los siguientes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">______________________</span>
</span><span class='line'><span class="n">Mailbox</span> <span class="n">size</span> <span class="n">of</span> <span class="n">user</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>  <span class="o">=</span> <span class="mf">281.51</span> <span class="n">MB</span>
</span><span class='line'><span class="n">The</span> <span class="n">Mailbox</span> <span class="n">isn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">Setting</span> <span class="n">Quota</span>
</span><span class='line'><span class="n">______________________</span>
</span><span class='line'><span class="n">Mailbox</span> <span class="n">size</span> <span class="n">of</span> <span class="n">user2</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>  <span class="o">=</span> <span class="mf">1.30</span> <span class="n">GB</span>
</span><span class='line'><span class="n">The</span> <span class="n">Mailbox</span> <span class="n">isn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">Setting</span> <span class="n">Quota</span>
</span><span class='line'><span class="n">______________________</span>
</span><span class='line'><span class="n">Mailbox</span> <span class="n">size</span> <span class="n">of</span> <span class="n">user3</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="o">=</span> <span class="mf">718.00</span> <span class="n">KB</span>
</span><span class='line'><span class="n">Mailbox</span> <span class="n">Quota</span> <span class="n">is</span> <span class="o">=</span> <span class="mi">10</span> <span class="n">MB</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Filtro de correos salientes Zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2013/11/04/filtro-de-correos-salientes-zimbra/"/>
    <updated>2013-11-04T17:38:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/11/04/filtro-de-correos-salientes-zimbra</id>
    <content type="html"><![CDATA[<p>Aveces es necesario en Zimbra &ldquo;copiar&rdquo; los correos salientes desde una casilla hacia otra cuenta (algo así como un forward). Esto en zimbra se puede realizar mediante la configuración del servicio postfix de la siguiente forma:</p>

<p>Editamos el archivo</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">cf</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y al principio del archivo agregamos la siguiente definición</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">sender_bcc_maps</span> <span class="o">=</span> <span class="nl">hash:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">sender_bcc</span>
</span></code></pre></td></tr></table></div></figure>


<p>Creamos el archivo y colocamos los permisos respectivo</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">sender_bcc</span>
</span><span class='line'><span class="n">chown</span> <span class="n">zimbra</span><span class="p">.</span><span class="n">zimbra</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">sender_bcc</span>
</span></code></pre></td></tr></table></div></figure>


<p>Dentro del archivo tenemos que definir en la primera columna la cuenta de correo &ldquo;origen&rdquo; y en la segunda la cuenta de correo &ldquo;destino&rdquo; a la cual le llegará una copia de los correos salientes desde la primera.</p>

<p> <!-- more --></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">originAccount</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span> <span class="n">destinationAccount</span><span class="err">@</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora, ejecutamos postmap sobre el archivo para generar el binario que leerá postfix y reiniciamos el servicio mta de zimbra</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">postmap</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">postfix</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">sender_bcc</span>
</span><span class='line'><span class="n">zmcontrol</span> <span class="n">restart</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Expresiones regulares con Puppet]]></title>
    <link href="http://mcoam.github.io/blog/2013/10/30/expresiones-regulares-con-puppet/"/>
    <updated>2013-10-30T15:06:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2013/10/30/expresiones-regulares-con-puppet</id>
    <content type="html"><![CDATA[<p>Puppet permite la declarición de nodos mediante expresiones regulares, esto permite definir dentro de una sola declaraciones &ldquo;n&rdquo; nodos, lo que nos ayudará a manejar de mejor forma nuestra administración de nodos. Por ejemplo:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">node</span> <span class="o">/</span><span class="p">.</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="n">example</span><span class="err">\</span><span class="p">.</span><span class="n">com</span><span class="o">/</span> <span class="n">inherits</span> <span class="n">basenode</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">class</span> <span class="n">ntp</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior dice que, todo nodo del tipo *.example.com <i>(www.example.com, ftp.example.com, mail.example.com)</i> aplicará la <i>clase ntp</i> y heredará la <i>clase basenode</i>. Para más infomación puedes ver la doc de puppet <a href="http://docs.puppetlabs.com/puppet/2.7/reference/lang_node_definitions.html">Puppet Docs</a></p>
]]></content>
  </entry>
  
</feed>
