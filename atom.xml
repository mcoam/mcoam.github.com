<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Bitácora]]></title>
  <link href="http://mcoam.github.io/atom.xml" rel="self"/>
  <link href="http://mcoam.github.io/"/>
  <updated>2015-12-17T17:16:13-03:00</updated>
  <id>http://mcoam.github.io/</id>
  <author>
    <name><![CDATA[Miguel Angel Coa Morales]]></name>
    
  </author>

  
  <entry>
    <title type="html"><![CDATA[Ansible: chequeando la existencia de un directorio]]></title>
    <link href="http://mcoam.github.io/blog/2015/12/17/ansible-chequeando-la-existencia-de-un-directorio/"/>
    <updated>2015-12-17T16:55:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/12/17/ansible-chequeando-la-existencia-de-un-directorio</id>
    <content type="html"><![CDATA[<p>Si necesitamos chequear la existencia de un directorio antes de realizar cualquier tipo de operación (copiear, instalar, etc) se puede utilizar el valor que nos trae el comando <code>stat</code>. Por ejemplo, el el siguiente ejemplo, se realiza lo siguiente:</p>

<ol>
<li>Se instala apache</li>
<li>Se chequea que el directorio <code>conf.d</code> exista</li>
<li>Se copia el archivo <code>site.conf</code></li>
<li>Reiniciar apache</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="nf">name:</span> <span class="n">Install</span> <span class="n">apache</span>
</span><span class='line'>  <span class="nl">yum:</span> <span class="n">name</span><span class="o">=</span><span class="n">httpd</span> <span class="n">state</span><span class="o">=</span><span class="n">latest</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Check apache path&quot;</span>
</span><span class='line'>  <span class="nl">stat:</span> <span class="n">path</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span>
</span><span class='line'>  <span class="k">register</span><span class="o">:</span> <span class="n">apache_path</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Copy configuration file&quot;</span>
</span><span class='line'>  <span class="nl">copy:</span> <span class="n">src</span><span class="o">=</span><span class="n">site</span><span class="p">.</span><span class="n">conf</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span>
</span><span class='line'>  <span class="nl">when:</span> <span class="n">apache_path</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">exists</span> <span class="o">==</span> <span class="n">True</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Restart apache&quot;</span>
</span><span class='line'>  <span class="nl">service:</span> <span class="n">name</span><span class="o">=</span><span class="n">httpd</span> <span class="n">state</span><span class="o">=</span><span class="n">restarted</span>
</span><span class='line'>  <span class="nl">when:</span> <span class="n">apache_path</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">exists</span> <span class="o">==</span> <span class="n">True</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ansible: Configurando volúmen de datos HSM en Zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2015/11/12/ansible-configurando-volumen-de-datos-hsm-en-zimbra/"/>
    <updated>2015-11-12T18:34:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/11/12/ansible-configurando-volumen-de-datos-hsm-en-zimbra</id>
    <content type="html"><![CDATA[<p>El siguiente <code>Playbook</code> permite configurar un nuevo volúmen para datos (store) en un servidor Zimbra NE.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">---</span>
</span><span class='line'><span class="o">-</span> <span class="nl">hosts:</span> <span class="n">ne_mailbox</span>
</span><span class='line'>  <span class="nl">remote_user:</span> <span class="n">root</span>
</span><span class='line'>  <span class="nl">vars:</span>
</span><span class='line'>        <span class="nl">zmvolume:</span> <span class="s">&quot;/opt/zimbra/bin/zmvolume&quot;</span>
</span><span class='line'>        <span class="nl">zmhsm:</span> <span class="s">&quot;/opt/zimbra/bin/zmhsm&quot;</span>
</span><span class='line'>        <span class="nl">zmprov:</span> <span class="s">&quot;/opt/zimbra/bin/zmprov&quot;</span>
</span><span class='line'>        <span class="nl">hsm_name:</span> <span class="s">&quot;hsm02&quot;</span>
</span><span class='line'>        <span class="nl">hsm_id:</span> <span class="s">&quot;4&quot;</span> <span class="err">#</span> <span class="n">check</span> <span class="kt">id</span> <span class="n">zmvolume</span> <span class="o">-</span><span class="n">l</span> <span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">B1</span> <span class="n">hsm02</span>
</span><span class='line'>        <span class="nl">path:</span> <span class="s">&quot;/opt/zimbra/store_hsm_02/&quot;</span>
</span><span class='line'>        <span class="nl">policy_option:</span> <span class="s">&quot; &#39;message,document,task,appointment,contact:before:-1month is:anywhere&#39; &quot;</span>
</span><span class='line'>  <span class="nl">tasks:</span>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Configura volumen HSM como volumen secundario&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmvolume } } -a -name  -c true -t secondaryMessage -p { { path } }&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Activamos nuevo volumen para manejar data&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmvolume } } -sc -id { { hsm_id } } &quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Configuramos politica HSM: Todo por sobre 1 mes se mueve al nuevo volumen&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmprov } } ms { { ansible_fqdn } } zimbraHsmPolicy { { policy_option } }&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Arrancamos el proceso para mover correos al nuevo HSM&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmhsm } } -t&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><b>Donde:<br></b>
<code>path: "/opt/zimbra/store_hsm_02/"</code>: Corresponde al punto de montaje del nuevo recurso HSM.<br>
<code>hsm_id: 4"</code>: Corresponde al ID que le asigna Zimbra al nuevo volúmen (disco).<br>
<code>hsm_name: hsm02</code>: Corresponde al nombre que le colocamos al recurso HSM.<br></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Montar, leer y escribir en USB con formato NTFS en OSX Capitan]]></title>
    <link href="http://mcoam.github.io/blog/2015/11/12/montar-leer-y-escribir-en-usb-con-formato-ntfs/"/>
    <updated>2015-11-12T18:17:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/11/12/montar-leer-y-escribir-en-usb-con-formato-ntfs</id>
    <content type="html"><![CDATA[<p>Con una terminal, ejecutar:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y dentro colocar</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">LABEL</span><span class="o">=</span><span class="n">DRIVE_NAME</span> <span class="n">none</span> <span class="n">ntfs</span> <span class="n">rw</span><span class="p">,</span><span class="k">auto</span><span class="p">,</span><span class="n">nobrowse</span>
</span></code></pre></td></tr></table></div></figure>


<p>Donde:
El <code>DRIVE_NAME</code> corresponde el nombre del dispositivo que conectamos al equipo. En el caso de que el nombre contenga espacios, tenemos que anteponer el backslash <i>&ldquo;\&rdquo;</i> antes del mismo Ej:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">LABEL</span><span class="o">=</span><span class="s">&quot;NO\ NAME&quot;</span> <span class="n">none</span> <span class="n">ntfs</span> <span class="n">rw</span><span class="p">,</span><span class="k">auto</span><span class="p">,</span><span class="n">nobrowse</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ansible: Trabajando con volumenes lógicos PV/VG/LV en Linux]]></title>
    <link href="http://mcoam.github.io/blog/2015/10/28/ansible-trabajando-con-volumenes-pv-slash-vg-slash-lv/"/>
    <updated>2015-10-28T23:52:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/10/28/ansible-trabajando-con-volumenes-pv-slash-vg-slash-lv</id>
    <content type="html"><![CDATA[<p>Ansible cuenta con un módulos para la gestión de discos en Linux los cuales no permiten administrar nuestros volúmenes.
En el siguiente ejemplo, se crea un volumen sobre un disco <code>/dev/sdf1</code> y que será configurado como volumen lógico y finalmente montado para los backup que realiza un servidor de correos Zimbra.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">---</span>
</span><span class='line'><span class="o">-</span> <span class="nl">hosts:</span> <span class="n">ne_mailbox</span>
</span><span class='line'>  <span class="nl">vars:</span>
</span><span class='line'>        <span class="nl">disk_name:</span> <span class="s">&quot;/dev/sdf1&quot;</span>
</span><span class='line'>        <span class="nl">filesystem:</span> <span class="s">&quot;ext4&quot;</span>
</span><span class='line'>        <span class="nl">vg_name:</span> <span class="s">&quot;zimbra_data&quot;</span>
</span><span class='line'>        <span class="nl">lv_size:</span> <span class="s">&quot;100%FREE&quot;</span> <span class="err">#</span><span class="n">ocupar</span> <span class="n">todo</span> <span class="n">el</span> <span class="n">espacio</span> <span class="n">libre</span> <span class="n">del</span> <span class="n">VG</span> <span class="n">zimbra_data</span>
</span><span class='line'>        <span class="nl">lv_name:</span> <span class="s">&quot;backup&quot;</span>
</span><span class='line'>        <span class="nl">path:</span> <span class="s">&quot;/opt/zimbra/backup&quot;</span>
</span><span class='line'>        <span class="nl">user:</span> <span class="s">&quot;zimbra&quot;</span>
</span><span class='line'>  <span class="nl">tasks:</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear el PV sobre el disco nuevo&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="n">pvcreate</span> <span class="p">{</span> <span class="p">{</span> <span class="n">disk_name</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear nuevo VG&quot;</span>
</span><span class='line'>          <span class="nl">lvg:</span> <span class="n">vg</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">pvs</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">disk_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear nuevo volumen LVM&quot;</span>
</span><span class='line'>          <span class="nl">lvol:</span> <span class="n">vg</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">lv</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">size</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_size</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">crea_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Formateo de unidad LVM&quot;</span>
</span><span class='line'>          <span class="nl">filesystem:</span> <span class="n">fstype</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">filesystem</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">dev</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">formatea_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Montar disco&quot;</span>
</span><span class='line'>          <span class="nl">mount:</span> <span class="n">name</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">path</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">src</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">fstype</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">filesystem</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">state</span><span class="o">=</span><span class="n">mounted</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">monta_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Permisos directorio backup&quot;</span>
</span><span class='line'>          <span class="nl">file:</span> <span class="n">path</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">path</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">state</span><span class="o">=</span><span class="n">directory</span> <span class="n">mode</span><span class="o">=</span><span class="mo">0755</span> <span class="n">owner</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">user</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">group</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">user</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">permisos_directorio</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Notas sobre imapsync]]></title>
    <link href="http://mcoam.github.io/blog/2015/10/15/notas-sobre-imapsync/"/>
    <updated>2015-10-15T23:00:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/10/15/notas-sobre-imapsync</id>
    <content type="html"><![CDATA[<p>En el caso de migrar la data de correos vía <code>imapsync</code> es importante tener en consideración (si se va a tener corriendo varios días el comando) utilizar la opción <code>--delete2</code> para que todo correo copiado al <i>(hosts2)</i> y que no tenga copia en el origen <i>(host1)</i> sea borrado, de lo contrario el usuario cuando se conecte al nuevo servidor tendrá correos que ya había eliminado y el buzón pesará mas de lo normal.
De todas formas, lo anterior se puede corregir configrando el <code>imapsyn</code> con el valor <code>&mdash;minage</code> que sincroniza el buzón desde <i>X</i> días para atrás.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">imapsync</span> <span class="o">--</span><span class="n">buffersize</span> <span class="mi">8192000</span> <span class="o">--</span><span class="n">nosyncacls</span> <span class="o">--</span><span class="n">subscribe</span> <span class="o">--</span><span class="n">syncinternaldates</span> <span class="o">--</span><span class="n">authmech1</span> <span class="no">PLAIN</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">host1</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span> <span class="o">--</span><span class="n">user1</span> <span class="n">foo</span><span class="vi">@origen</span><span class="o">.</span><span class="n">dev</span> <span class="o">--</span><span class="n">password1</span> <span class="s1">&#39;foo&#39;</span> <span class="o">--</span><span class="n">host2</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">user2</span> <span class="n">foo</span><span class="vi">@destino</span><span class="o">.</span><span class="n">dev</span> <span class="o">--</span><span class="n">password2</span> <span class="s1">&#39;foo&#39;</span> <span class="o">--</span><span class="n">authmech2</span> <span class="no">PLAIN</span> <span class="o">--</span><span class="n">nofoldersizes</span> <span class="o">--</span><span class="n">skipsize</span> <span class="o">--</span><span class="n">fast</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;(?i)\b(Junk|Spam|Trash|IMIP|Drafts)\b&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;INBOX_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Trash_(.*)&#39;</span><span class="o">/</span>
</span><span class='line'> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Drafts_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Spam_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Sent Items_(.*)&#39;</span> <span class="o">--</span><span class="n">regextrans2</span> <span class="o">/</span>
</span><span class='line'><span class="s1">&#39;s#^Sent Items#Sent#&#39;</span> <span class="o">--</span><span class="n">delete2duplicates</span> <span class="o">--</span><span class="n">delete2</span> <span class="o">--</span><span class="n">minage</span> <span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Por ejemplo, hoy estamos a 10 y tiramos el imapsync en el destino empezará a sincronizar (borrando la data que no este en el host1) desde el día 5, con ello evitamos borrar los correos nuevos en el host2.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Seleccionar y comentar texto con VIM]]></title>
    <link href="http://mcoam.github.io/blog/2015/06/24/seleccionar-y-comentar-texto-con-vim/"/>
    <updated>2015-06-24T16:03:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/06/24/seleccionar-y-comentar-texto-con-vim</id>
    <content type="html"><![CDATA[<p>En el caso de necesitar seleccionar texto (muchas líneas) con <code>vim</code> podemos hacer lo siguiente:</p>

<ul>
<li> Seleccionar texto en modo <b>visual</b> </li>
<li> Apretar la combinación: <b>:norm i#</b> para agregar los comentarios </li>
</ul>


<p>Para quitar los comentatrios</p>

<ul>
<li> Seleccionar texto en modo <b>visual</b> </li>
<li> Apretar la combinación: <b>:norm x</b> para agregar los comentarios </li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Instalado/Actualizando paquetes Endian Firewall]]></title>
    <link href="http://mcoam.github.io/blog/2015/03/26/instalado-slash-actualizando-paquetes-endian-firewall/"/>
    <updated>2015-03-26T18:35:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/03/26/instalado-slash-actualizando-paquetes-endian-firewall</id>
    <content type="html"><![CDATA[<p>Para instalar paquetes en Endian Firewall podemos utilizar el comando <code>smart</code> que es un administrador de paquetes que viene incorporado en la distro. Lo primero que hay que realizar es instalar el repositorio:</p>

<p><li>Para Endian 2.4.x</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">channel</span> <span class="o">--</span><span class="n">add</span> <span class="no">CentOS_4</span><span class="o">.</span><span class="mi">9</span> <span class="n">type</span><span class="o">=</span><span class="n">rpm</span><span class="o">-</span><span class="n">md</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;CentOS_4.9&quot;</span> <span class="p">\</span><span class="n">baseurl</span><span class="o">=</span><span class="s2">&quot;http://vault.centos.org/4.9/os/i386/&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>En el caso de Endian 2.5.x</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">channel</span> <span class="o">--</span><span class="n">add</span> <span class="no">CentOS_5</span><span class="o">.</span><span class="mi">9</span> <span class="n">type</span><span class="o">=</span><span class="n">rpm</span><span class="o">-</span><span class="n">md</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;CentOS_5.9&quot;</span> <span class="p">\</span><span class="n">baseurl</span><span class="o">=</span><span class="s2">&quot;http://vault.centos.org/5.9/os/i386/&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instalando paquetes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">update</span>
</span><span class='line'><span class="n">smart</span> <span class="n">install</span> <span class="n">wget</span> <span class="n">nmap</span> <span class="n">vim</span><span class="o">-</span><span class="n">enhanced</span> <span class="o">-</span><span class="n">y</span>
</span></code></pre></td></tr></table></div></figure>


<p>En el caso de ver el error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">warning</span><span class="p">:</span> <span class="n">rpmts_HdrFromFdno</span><span class="p">:</span> <span class="no">Header</span> <span class="no">V3</span> <span class="no">DSA</span> <span class="ss">signature</span><span class="p">:</span> <span class="no">NOKEY</span><span class="p">,</span> <span class="n">key</span> <span class="no">ID</span> <span class="mi">443</span><span class="n">e1821</span>
</span><span class='line'><span class="ss">error</span><span class="p">:</span> <span class="n">vim</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mo">046</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="n">el4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">i386</span><span class="o">.</span><span class="n">rpm</span><span class="p">:</span> <span class="kp">public</span> <span class="n">key</span> <span class="ow">not</span> <span class="n">available</span>
</span><span class='line'><span class="no">Saving</span> <span class="n">cache</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ejecutar</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">config</span> <span class="o">--</span><span class="n">set</span>  <span class="n">rpm</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">signatures</span><span class="o">=</span><span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Script para buscar y borrar un correo en zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2015/01/15/script-para-buscar-y-borrar-un-correo-en-zimbra/"/>
    <updated>2015-01-15T12:49:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/01/15/script-para-buscar-y-borrar-un-correo-en-zimbra</id>
    <content type="html"><![CDATA[<p>El siguiente script permite buscar y borrar un correo mediante consola desde los mailbox de los usuarios.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="n">zimbraAccounts</span><span class="o">=</span><span class="s1">&#39;/var/tmp/cuentas&#39;</span>
</span><span class='line'><span class="n">zimbraCMD</span><span class="o">=</span><span class="s1">&#39;/opt/zimbra/bin/zmmailbox&#39;</span>
</span><span class='line'> <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="sb">`cat $zimbraAccounts`</span>
</span><span class='line'>    <span class="k">do</span>
</span><span class='line'>        <span class="c1">#user=`$a`</span>
</span><span class='line'>        <span class="n">emailID</span><span class="o">=</span><span class="p">(</span> <span class="err">$</span><span class="p">(</span><span class="vg">$zimbraCMD</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">m</span> <span class="vg">$a</span> <span class="n">search</span> <span class="s2">&quot;de haber superado debido a la alta tasa de correos spam&quot;</span> <span class="o">|</span><span class="n">grep</span> <span class="n">conv</span> <span class="o">|</span><span class="n">awk</span> <span class="p">{</span><span class="s1">&#39;print $2&#39;</span><span class="p">}</span> <span class="o">|</span><span class="n">sed</span> <span class="s1">&#39;s/-//g&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>        <span class="n">echo</span> <span class="vg">$user</span>
</span><span class='line'>        <span class="c1">#echo ${emailID[1]}</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="s2">&quot;${emailID[@]}&quot;</span>
</span><span class='line'>                <span class="k">do</span>
</span><span class='line'>                    <span class="vg">$zimbraCMD</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">m</span> <span class="vg">$a</span> <span class="n">dm</span> <span class="vg">$i</span>
</span><span class='line'>          <span class="n">echo</span> <span class="s2">&quot;cuenta: $a&quot;</span> <span class="o">&gt;&gt;</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">casillasConEmail</span>
</span><span class='line'>                <span class="n">done</span>
</span><span class='line'>    <span class="n">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>En la línea nº8 tenemos que cambiar el texto a buscar, y que corresponde a lo que esta dentro de comillas.
Para el caso, tenemos que tener las cuentas de correos en el archivo <code>/var/tmp/cuentas</code> que las podemos obtener con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">zmprov</span> <span class="o">-</span><span class="n">l</span> <span class="n">gaa</span> <span class="o">|</span><span class="n">egrep</span> <span class="o">-</span><span class="n">vi</span> <span class="s1">&#39;spam|virus|galsyn|archiv&#39;</span><span class="o">|</span> <span class="n">sort</span> <span class="o">&gt;</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cuentas</span>
</span></code></pre></td></tr></table></div></figure>


<p>Demás esta decir que lo realizado en el comando anterior se puede hacer dentro del mismo script sin tener que hacer esto de forma separada.  Una vez ejecutado el script, podremos ver la información de las cuentas en donde fue borrado el correo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">zimbra</span><span class="vi">@mail1</span> <span class="n">tmp</span><span class="o">]</span><span class="err">$</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">casillasConEmail</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">ahidalgo</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">alinay</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">chernandez</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">currutia</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">cvaldes</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">evalencia</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Error screen: There is no screen to be resumed matching ]]></title>
    <link href="http://mcoam.github.io/blog/2014/11/28/atachando-sesion-screen-dropeada/"/>
    <updated>2014-11-28T13:14:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2014/11/28/atachando-sesion-screen-dropeada</id>
    <content type="html"><![CDATA[<p>Si al momento de querer recuperar una sesión <code>screen</code> donde tenemos un proceso corriendo y utilizamos el comando <code>scren -r</code>, como resultado de la operación obtenemos el siguiente mensaje:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@mail</span><span class="o">-</span><span class="n">old</span> <span class="o">~]</span><span class="err">$</span> <span class="n">screen</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;1866.zimbra-mta&#39;</span>
</span><span class='line'><span class="no">There</span> <span class="n">is</span> <span class="n">a</span> <span class="n">screen</span> <span class="ss">on</span><span class="p">:</span>
</span><span class='line'><span class="mi">1866</span><span class="o">.</span><span class="n">zimbra</span><span class="o">-</span><span class="n">mta</span> <span class="p">(</span><span class="no">Attached</span><span class="p">)</span>
</span><span class='line'><span class="no">There</span> <span class="n">is</span> <span class="n">no</span> <span class="n">screen</span> <span class="n">to</span> <span class="n">be</span> <span class="n">resumed</span> <span class="n">matching</span> <span class="mi">1866</span><span class="o">.</span><span class="n">zimbra</span><span class="o">-</span><span class="n">mta</span>
</span></code></pre></td></tr></table></div></figure>


<p>La solución es pasar el comando con la opción <i>&lsquo;-D&rsquo;</i> que nos permite desatachar la sessión remota y atacharla en nuestra tty.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@mail</span><span class="o">-</span><span class="n">old</span> <span class="o">~]</span><span class="err">$</span> <span class="n">screen</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">D</span> <span class="s1">&#39;1866.zimbra-mta&#39;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Eliminar VM Vagrant]]></title>
    <link href="http://mcoam.github.io/blog/2014/10/13/eliminar-vm-vagrant/"/>
    <updated>2014-10-13T16:44:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2014/10/13/eliminar-vm-vagrant</id>
    <content type="html"><![CDATA[<p>En <code>Vagrant</code> nuestra máquinas virtuales son borradas con el comando <code>vm destroy</code> pero sucede que aveces hemos borrado el directorio de la VM o el Vagrantfile y esta ya no puede ser referenciada mediante Vagrant para ser eliminada. Como Vagrant trabaja con <code>VirtualBox</code> podemos utilizar el comando <code>VBoxManage</code> para que la podamos eliminar.</p>

<p>Listamos todas la VM</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">zimbra</span><span class="err">$</span> <span class="no">VBoxManage</span> <span class="n">list</span> <span class="n">vms</span>
</span><span class='line'><span class="s2">&quot;puppetserver&quot;</span> <span class="p">{</span><span class="mi">3830</span><span class="n">b010</span><span class="o">-</span><span class="mi">4</span><span class="n">fca</span><span class="o">-</span><span class="mi">4</span><span class="n">c29</span><span class="o">-</span><span class="mi">9225</span><span class="o">-</span><span class="mi">6647</span><span class="n">b1edcd7f</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosserver&quot;</span> <span class="p">{</span><span class="mi">3178</span><span class="n">a761</span><span class="o">-</span><span class="mi">0</span><span class="n">c61</span><span class="o">-</span><span class="mi">4</span><span class="n">ffb</span><span class="o">-</span><span class="mi">8</span><span class="n">fc8</span><span class="o">-</span><span class="n">d4bd4853be22</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosnode1&quot;</span> <span class="p">{</span><span class="mi">90</span><span class="n">da5db9</span><span class="o">-</span><span class="mi">2538</span><span class="o">-</span><span class="mi">4</span><span class="n">fe5</span><span class="o">-</span><span class="n">b76f</span><span class="o">-</span><span class="n">af68f83a8397</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosnode2&quot;</span> <span class="p">{</span><span class="n">e32fb9be</span><span class="o">-</span><span class="n">fb34</span><span class="o">-</span><span class="mi">4663</span><span class="o">-</span><span class="n">befb</span><span class="o">-</span><span class="mi">900</span><span class="n">f43b60cfb</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;samba4&quot;</span> <span class="p">{</span><span class="n">f5c753c3</span><span class="o">-</span><span class="n">c8e0</span><span class="o">-</span><span class="mi">4117</span><span class="o">-</span><span class="n">b05c</span><span class="o">-</span><span class="n">f635ebcae06d</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;docker.example.com&quot;</span> <span class="p">{</span><span class="mi">0</span><span class="n">c5213d4</span><span class="o">-</span><span class="mi">6</span><span class="n">d1a</span><span class="o">-</span><span class="mi">40</span><span class="n">b9</span><span class="o">-</span><span class="mi">9</span><span class="n">e44</span><span class="o">-</span><span class="n">cff9c3829d73</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;zimbra_default_1413222975386_53519&quot;</span> <span class="p">{</span><span class="mi">969175</span><span class="n">c2</span><span class="o">-</span><span class="mi">451</span><span class="n">c</span><span class="o">-</span><span class="mi">42</span><span class="n">fc</span><span class="o">-</span><span class="mi">98</span><span class="n">fd</span><span class="o">-</span><span class="mi">7946</span><span class="n">d6796bcc</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;zimbra&quot;</span> <span class="p">{</span><span class="mi">35</span><span class="n">ed5012</span><span class="o">-</span><span class="mi">4</span><span class="n">b33</span><span class="o">-</span><span class="mi">4</span><span class="n">b30</span><span class="o">-</span><span class="mi">869</span><span class="n">b</span><span class="o">-</span><span class="mi">35654</span><span class="n">b3e88b8</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vamos a eliminar la máquina de la línea nº8 UID <code>969175c2-451c-42fc-98fd-7946d6796bcc</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">zimbra</span><span class="err">$</span> <span class="no">VBoxManage</span> <span class="n">unregistervm</span> <span class="mi">969175</span><span class="n">c2</span><span class="o">-</span><span class="mi">451</span><span class="n">c</span><span class="o">-</span><span class="mi">42</span><span class="n">fc</span><span class="o">-</span><span class="mi">98</span><span class="n">fd</span><span class="o">-</span><span class="mi">7946</span><span class="n">d6796bcc</span> <span class="o">-</span><span class="n">delete</span>
</span><span class='line'><span class="mi">0</span><span class="sx">%..</span><span class="o">.</span><span class="mi">10</span><span class="sx">%..</span><span class="o">.</span><span class="mi">20</span><span class="sx">%..</span><span class="o">.</span><span class="mi">30</span><span class="sx">%..</span><span class="o">.</span><span class="mi">40</span><span class="sx">%..</span><span class="o">.</span><span class="mi">50</span><span class="sx">%..</span><span class="o">.</span><span class="mi">60</span><span class="sx">%..</span><span class="o">.</span><span class="mi">70</span><span class="sx">%..</span><span class="o">.</span><span class="mi">80</span><span class="sx">%..</span><span class="o">.</span><span class="mi">90</span><span class="sx">%..</span><span class="o">.</span><span class="mi">100</span><span class="o">%</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y ahora vemos que ya no esta</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">zimbra</span><span class="err">$</span> <span class="no">VBoxManage</span> <span class="n">list</span> <span class="n">vms</span>
</span><span class='line'><span class="s2">&quot;puppetserver&quot;</span> <span class="p">{</span><span class="mi">3830</span><span class="n">b010</span><span class="o">-</span><span class="mi">4</span><span class="n">fca</span><span class="o">-</span><span class="mi">4</span><span class="n">c29</span><span class="o">-</span><span class="mi">9225</span><span class="o">-</span><span class="mi">6647</span><span class="n">b1edcd7f</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;CentOS-6.4-x86_64_1407080394847_1407&quot;</span> <span class="p">{</span><span class="n">bd5b11c8</span><span class="o">-</span><span class="n">a7e4</span><span class="o">-</span><span class="mi">4</span><span class="n">c6e</span><span class="o">-</span><span class="n">b6f2</span><span class="o">-</span><span class="mi">1646775</span><span class="n">e7f9a</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosServer_default_1407266455588_52667&quot;</span> <span class="p">{</span><span class="mi">2</span><span class="n">f3d8ae9</span><span class="o">-</span><span class="n">c8e5</span><span class="o">-</span><span class="mi">4557</span><span class="o">-</span><span class="n">a79e</span><span class="o">-</span><span class="mi">503</span><span class="n">a1af4646a</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosserver&quot;</span> <span class="p">{</span><span class="mi">3178</span><span class="n">a761</span><span class="o">-</span><span class="mi">0</span><span class="n">c61</span><span class="o">-</span><span class="mi">4</span><span class="n">ffb</span><span class="o">-</span><span class="mi">8</span><span class="n">fc8</span><span class="o">-</span><span class="n">d4bd4853be22</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosnode1&quot;</span> <span class="p">{</span><span class="mi">90</span><span class="n">da5db9</span><span class="o">-</span><span class="mi">2538</span><span class="o">-</span><span class="mi">4</span><span class="n">fe5</span><span class="o">-</span><span class="n">b76f</span><span class="o">-</span><span class="n">af68f83a8397</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;nagiosnode2&quot;</span> <span class="p">{</span><span class="n">e32fb9be</span><span class="o">-</span><span class="n">fb34</span><span class="o">-</span><span class="mi">4663</span><span class="o">-</span><span class="n">befb</span><span class="o">-</span><span class="mi">900</span><span class="n">f43b60cfb</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;samba4&quot;</span> <span class="p">{</span><span class="n">f5c753c3</span><span class="o">-</span><span class="n">c8e0</span><span class="o">-</span><span class="mi">4117</span><span class="o">-</span><span class="n">b05c</span><span class="o">-</span><span class="n">f635ebcae06d</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;docker.example.com&quot;</span> <span class="p">{</span><span class="mi">0</span><span class="n">c5213d4</span><span class="o">-</span><span class="mi">6</span><span class="n">d1a</span><span class="o">-</span><span class="mi">40</span><span class="n">b9</span><span class="o">-</span><span class="mi">9</span><span class="n">e44</span><span class="o">-</span><span class="n">cff9c3829d73</span><span class="p">}</span>
</span><span class='line'><span class="s2">&quot;zimbra&quot;</span> <span class="p">{</span><span class="mi">35</span><span class="n">ed5012</span><span class="o">-</span><span class="mi">4</span><span class="n">b33</span><span class="o">-</span><span class="mi">4</span><span class="n">b30</span><span class="o">-</span><span class="mi">869</span><span class="n">b</span><span class="o">-</span><span class="mi">35654</span><span class="n">b3e88b8</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Eliminar y purgar nodo de PuppetDB (storeconfig)]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/26/eliminar-y-purgar-nodo-de-puppetdb-storeconfig/"/>
    <updated>2014-08-26T11:43:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/26/eliminar-y-purgar-nodo-de-puppetdb-storeconfig</id>
    <content type="html"><![CDATA[<p>Error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Error</span><span class="p">:</span> <span class="no">Could</span> <span class="ow">not</span> <span class="n">retrieve</span> <span class="n">catalog</span> <span class="n">from</span> <span class="n">remote</span> <span class="ss">server</span><span class="p">:</span> <span class="no">Error</span> <span class="mi">400</span> <span class="n">on</span> <span class="ss">SERVER</span><span class="p">:</span> <span class="n">A</span> <span class="n">duplicate</span> <span class="n">resource</span> <span class="n">was</span> <span class="n">found</span> <span class="k">while</span> <span class="n">collecting</span> <span class="n">exported</span> <span class="n">resources</span><span class="p">,</span> <span class="n">with</span> <span class="n">the</span> <span class="n">type</span> <span class="ow">and</span> <span class="n">title</span> <span class="no">Nagios_host</span><span class="o">[</span><span class="k">next</span><span class="o">-</span><span class="n">haproxy</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">org</span><span class="o">]</span> <span class="n">on</span> <span class="n">node</span> <span class="n">nagios</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">org</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Not</span> <span class="n">using</span> <span class="n">cache</span> <span class="n">on</span> <span class="n">failed</span> <span class="n">catalog</span>
</span><span class='line'><span class="ss">Error</span><span class="p">:</span> <span class="no">Could</span> <span class="ow">not</span> <span class="n">retrieve</span> <span class="n">catalog</span><span class="p">;</span> <span class="n">skipping</span> <span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior era por que el node estaba registrado dos veces en PuppetDB una con el fqdn completo <i>next-haproxy-1.domain.org</i> y otra sin el dominio <i>next-haproxy-1</i> lo que generaba error al exportar los recursos. La solución fue eliminar uno y luego purgar el contenido de la base de datos:</p>

<p><li>Remover el nodo de PuppetDB</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@nagios</span> <span class="n">servers</span><span class="o">]</span><span class="err">$</span> <span class="n">puppet</span> <span class="n">node</span> <span class="n">deactivate</span> <span class="k">next</span><span class="o">-</span><span class="n">haproxy</span><span class="o">-</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Remover el nodo de la DB</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@puppet</span> <span class="o">~]</span><span class="err">$</span> <span class="n">psql</span> <span class="o">-</span><span class="n">h</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">puppetdb</span> <span class="n">puppetdb</span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">user</span> <span class="ss">puppetdb</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">colocar</span> <span class="n">password</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">#EJECUTAR</span>
</span><span class='line'><span class="n">puppetdb</span><span class="o">=&gt;</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">catalogs</span> <span class="n">where</span> <span class="n">certname</span> <span class="k">in</span> <span class="p">(</span><span class="nb">select</span> <span class="nb">name</span> <span class="n">from</span> <span class="n">certnames</span> <span class="n">where</span> <span class="n">deactivated</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">null</span><span class="p">);</span>
</span><span class='line'><span class="no">DELETE</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Error Kerberos y Bind con Samba4]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/20/error-samba4-y-bind/"/>
    <updated>2014-08-20T18:17:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/20/error-samba4-y-bind</id>
    <content type="html"><![CDATA[<p>Al momento de validar la configuración de kerberos del usuario admin arrojaba lo siguiente:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">kinit</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span>
</span><span class='line'><span class="ss">kinit</span><span class="p">:</span> <span class="no">Cannot</span> <span class="n">resolve</span> <span class="n">servers</span> <span class="k">for</span> <span class="no">KDC</span> <span class="k">in</span> <span class="n">realm</span> <span class="s2">&quot;EXAMPLE.LOCAL&quot;</span> <span class="k">while</span> <span class="n">getting</span> <span class="n">initial</span> <span class="n">credentials</span>
</span></code></pre></td></tr></table></div></figure>


<p>Al chequear las configuraciones DNS de de Samba arrojaba</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">samba_dnsupdate</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">all</span><span class="o">-</span><span class="n">names</span>
</span><span class='line'><span class="ss">IPs</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;10.0.2.15&#39;</span><span class="p">,</span> <span class="s1">&#39;10.10.0.200&#39;</span><span class="o">]</span>
</span><span class='line'><span class="no">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
</span><span class='line'>  <span class="no">File</span> <span class="s2">&quot;/usr/local/samba/sbin/samba_dnsupdate&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">511</span><span class="p">,</span> <span class="k">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="n">get_credentials</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>
</span><span class='line'>  <span class="no">File</span> <span class="s2">&quot;/usr/local/samba/sbin/samba_dnsupdate&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">124</span><span class="p">,</span> <span class="k">in</span> <span class="n">get_credentials</span>
</span><span class='line'>    <span class="k">raise</span> <span class="n">e</span>
</span><span class='line'><span class="ss">RuntimeError</span><span class="p">:</span> <span class="n">kinit</span> <span class="k">for</span> <span class="no">SAMBA</span><span class="vg">$@</span><span class="no">EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span> <span class="n">failed</span> <span class="p">(</span><span class="no">Cannot</span> <span class="n">contact</span> <span class="n">any</span> <span class="no">KDC</span> <span class="k">for</span> <span class="n">requested</span> <span class="n">realm</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Solución ELIMINAR Bind</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">yum</span> <span class="n">remove</span> <span class="n">bind</span> <span class="o">-</span><span class="n">y</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Comprobamos</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># kinit administrator@EXAMPLE.LOCAL</span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">:</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Your</span> <span class="n">password</span> <span class="n">will</span> <span class="n">expire</span> <span class="k">in</span> <span class="mi">41</span> <span class="n">days</span> <span class="n">on</span> <span class="no">Wed</span> <span class="no">Oct</span>  <span class="mi">1</span> <span class="mi">17</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mo">00</span> <span class="mi">2014</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y chequeamos la configuracion de DNS de Samba</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># samba_dnsupdate --verbose --all-names</span>
</span><span class='line'><span class="ss">IPs</span><span class="p">:</span> <span class="o">[</span><span class="s1">&#39;10.0.2.15&#39;</span><span class="p">,</span> <span class="s1">&#39;10.10.0.200&#39;</span><span class="o">]</span>
</span><span class='line'><span class="no">Calling</span> <span class="n">nsupdate</span> <span class="k">for</span> <span class="n">A</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'><span class="no">Outgoing</span> <span class="n">update</span> <span class="ss">query</span><span class="p">:</span>
</span><span class='line'><span class="p">;;</span> <span class="o">-&gt;&gt;</span><span class="no">HEADER</span><span class="o">&lt;&lt;-</span> <span class="ss">opcode</span><span class="p">:</span> <span class="no">UPDATE</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="no">NOERROR</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span>      <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="ss">flags</span><span class="p">:;</span> <span class="ss">ZONE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">PREREQ</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">UPDATE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">ADDITIONAL</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="no">UPDATE</span> <span class="ss">SECTION</span><span class="p">:</span>
</span><span class='line'><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>        <span class="mi">900</span> <span class="no">IN</span>  <span class="n">A</span>    <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'>
</span><span class='line'><span class="p">;</span> <span class="no">TSIG</span> <span class="n">error</span> <span class="n">with</span> <span class="ss">server</span><span class="p">:</span> <span class="n">tsig</span> <span class="n">verify</span> <span class="n">failure</span>
</span><span class='line'><span class="no">Failed</span> <span class="ss">nsupdate</span><span class="p">:</span> <span class="mi">2</span>
</span><span class='line'><span class="no">Calling</span> <span class="n">nsupdate</span> <span class="k">for</span> <span class="n">A</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span><span class='line'><span class="no">Outgoing</span> <span class="n">update</span> <span class="ss">query</span><span class="p">:</span>
</span><span class='line'><span class="p">;;</span> <span class="o">-&gt;&gt;</span><span class="no">HEADER</span><span class="o">&lt;&lt;-</span> <span class="ss">opcode</span><span class="p">:</span> <span class="no">UPDATE</span><span class="p">,</span> <span class="ss">status</span><span class="p">:</span> <span class="no">NOERROR</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span>      <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="ss">flags</span><span class="p">:;</span> <span class="ss">ZONE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">PREREQ</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">UPDATE</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">ADDITIONAL</span><span class="p">:</span> <span class="mi">0</span>
</span><span class='line'><span class="p">;;</span> <span class="no">UPDATE</span> <span class="ss">SECTION</span><span class="p">:</span>
</span><span class='line'><span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>    <span class="mi">900</span> <span class="no">IN</span>  <span class="n">A</span>    <span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">15</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SAMBA4.localo controlador de dominio A/D]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/20/samba4-como-controlador-de-dominio-a-slash-d/"/>
    <updated>2014-08-20T10:57:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/20/samba4-como-controlador-de-dominio-a-slash-d</id>
    <content type="html"><![CDATA[<p>Para Centos 6 tenemos que complilar las fuentes para instalar Samba4:</p>

<p>Instalar paqueteria necesaria</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">gcc</span> <span class="n">make</span> <span class="n">wget</span> <span class="n">python</span><span class="o">-</span><span class="n">devel</span> <span class="n">gnutls</span><span class="o">-</span><span class="n">devel</span> <span class="n">openssl</span><span class="o">-</span><span class="n">devel</span> <span class="n">libacl</span><span class="o">-</span><span class="n">devel</span> <span class="n">krb5</span><span class="o">-</span><span class="n">server</span> <span class="n">krb5</span><span class="o">-</span><span class="n">libs</span> <span class="n">krb5</span><span class="o">-</span><span class="n">workstation</span> <span class="n">bind</span> <span class="n">bind</span><span class="o">-</span><span class="n">libs</span> <span class="n">bind</span><span class="o">-</span><span class="n">utils</span>
</span></code></pre></td></tr></table></div></figure>


<p>Descargamos y lo compilamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">git</span> <span class="nb">clone</span> <span class="ss">git</span><span class="p">:</span><span class="sr">//</span><span class="n">git</span><span class="o">.</span><span class="n">samba</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">samba</span><span class="o">.</span><span class="n">git</span> <span class="n">samba4</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cd</span> <span class="n">samba4</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="o">.</span><span class="n">/configure</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">selftest</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span> <span class="c1">#Esto demora bastante</span>
</span></code></pre></td></tr></table></div></figure>


<p>Terminado lo anterior y si no arroja ningún error, tendremos instalado Samba4. Ahora necesitamos configurar el controlador de dominio, lo primiero que tenemos que hacer es el <i>Provisioning</i> para el nuevo dominio.</p>

<p>Unas cosas antes a considerar:
Configuramos el hostname en la tabla hosts <code>/etc/hosts</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/</span><span class="n">hosts</span>
</span><span class='line'><span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>   <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost4</span> <span class="n">localhost4</span><span class="o">.</span><span class="n">localdomain4</span>
</span><span class='line'><span class="o">::</span><span class="mi">1</span>         <span class="n">localhost</span> <span class="n">localhost</span><span class="o">.</span><span class="n">localdomain</span> <span class="n">localhost6</span> <span class="n">localhost6</span><span class="o">.</span><span class="n">localdomain6</span>
</span><span class='line'>
</span><span class='line'><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">200</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="n">samba</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y el servidor de nombres en el <code>/etc/resolv.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/</span><span class="n">resolv</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'><span class="n">search</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="n">domain</span> <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="n">nameserver</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Esto es necesario para los servicios Samba y Kerberos, además, tenemos que configurar el parámetro <code>dns forwarder</code> dentro del archivo de configuración del servicio (esto si no lo hacemos dentro del proceso del provisionamiento).</p>

<p>NOTA: El servidor tiene que tener correctamente sincronizada la hora (utilizar NTP)</p>

<h4>Provisionando el nuevo dominio</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">samba</span><span class="o">-</span><span class="n">tool</span> <span class="n">domain</span> <span class="n">provision</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y completamos con los datos solicitados</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Realm</span> <span class="o">[</span><span class="no">EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">Domain</span> <span class="o">[</span><span class="no">EXAMPLE</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span> <span class="c1">#CON MAYUSCULAS</span>
</span><span class='line'><span class="no">Server</span> <span class="no">Role</span> <span class="p">(</span><span class="n">dc</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="n">standalone</span><span class="p">)</span> <span class="o">[</span><span class="n">dc</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">DNS</span> <span class="n">backend</span> <span class="p">(</span><span class="no">SAMBA_INTERNAL</span><span class="p">,</span> <span class="no">BIND9_FLATFILE</span><span class="p">,</span> <span class="no">BIND9_DLZ</span><span class="p">,</span> <span class="no">NONE</span><span class="p">)</span> <span class="o">[</span><span class="no">SAMBA_INTERNAL</span><span class="o">]</span><span class="p">:</span> <span class="p">(</span><span class="n">press</span> <span class="no">Enter</span><span class="p">)</span>
</span><span class='line'><span class="no">DNS</span> <span class="n">forwarder</span> <span class="no">IP</span> <span class="n">address</span> <span class="p">(</span><span class="n">write</span> <span class="s1">&#39;none&#39;</span> <span class="n">to</span> <span class="n">disable</span> <span class="n">forwarding</span><span class="p">)</span> <span class="o">[</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
</span><span class='line'><span class="no">Administrator</span> <span class="ss">password</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">set_password</span><span class="o">&gt;</span>
</span><span class='line'><span class="no">Retype</span> <span class="ss">password</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con todo el proceso anterior realizado, al final de todo veremos algo como lo siguiente</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Fixing</span> <span class="n">provision</span> <span class="no">GUIDs</span>
</span><span class='line'><span class="n">A</span> <span class="no">Kerberos</span> <span class="n">configuration</span> <span class="n">suitable</span> <span class="k">for</span> <span class="no">Samba</span> <span class="mi">4</span> <span class="n">has</span> <span class="n">been</span> <span class="n">generated</span> <span class="n">at</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span>
</span><span class='line'><span class="no">Once</span> <span class="n">the</span> <span class="n">above</span> <span class="n">files</span> <span class="n">are</span> <span class="n">installed</span><span class="p">,</span> <span class="n">your</span> <span class="no">Samba4</span> <span class="n">server</span> <span class="n">will</span> <span class="n">be</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">use</span>
</span><span class='line'><span class="no">Server</span> <span class="ss">Role</span><span class="p">:</span>           <span class="n">active</span> <span class="n">directory</span> <span class="n">domain</span> <span class="n">controller</span>
</span><span class='line'><span class="ss">Hostname</span><span class="p">:</span>              <span class="n">samba</span>
</span><span class='line'><span class="no">NetBIOS</span> <span class="ss">Domain</span><span class="p">:</span>        <span class="no">EXAMPLE</span>
</span><span class='line'><span class="no">DNS</span> <span class="ss">Domain</span><span class="p">:</span>            <span class="n">example</span><span class="o">.</span><span class="n">local</span>
</span><span class='line'><span class="no">DOMAIN</span> <span class="ss">SID</span><span class="p">:</span>            <span class="n">S</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">3438009546</span><span class="o">-</span><span class="mi">7273</span><span class="no">XXXX</span><span class="o">-</span><span class="no">XXXXXXXXX</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y luego reiniciamos el servidor</p>

<p>El path de instalación de Samaba4 queda bajo <code>/usr/local/samba/</code> los mismo sucede con los binarios <code>/usr/local/samba/bin/</code> y <code>/usr/local/samba/sbin/</code> para lo cual vamos a configurar la variable <code>$PATH</code> en nuestro bash.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># vim ~/.bashrc</span>
</span><span class='line'><span class="c1">#Dentro colocamos</span>
</span><span class='line'><span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="s2">&quot;/usr/local/samba/sbin:/usr/local/samba/bin:$PATH&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Para ver que quedó todo en orden ejecutamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># samba -V</span>
</span><span class='line'><span class="no">Version</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># smbclient -V</span>
</span><span class='line'><span class="no">Version</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span>
</span></code></pre></td></tr></table></div></figure>


<p>Chequeamos la configuración local al Samba y los procesos corriendo</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1">#  ps -ef | grep samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23010</span>     <span class="mi">1</span>  <span class="mi">1</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23011</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23012</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23013</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23014</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23015</span> <span class="mi">23011</span>  <span class="mi">1</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">smbd</span> <span class="o">-</span><span class="n">D</span> <span class="o">--</span><span class="n">option</span><span class="o">=</span><span class="n">server</span> <span class="n">role</span> <span class="ss">check</span><span class="p">:</span><span class="n">inhibit</span><span class="o">=</span><span class="n">yes</span> <span class="o">--</span><span class="n">foreground</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23016</span> <span class="mi">23010</span>  <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span><span class='line'><span class="n">root</span>     <span class="mi">23017</span> <span class="mi">23010</span>  <span class="mi">0</span> <span class="mi">12</span><span class="p">:</span><span class="mi">32</span> <span class="o">?</span>        <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="n">samba</span>
</span></code></pre></td></tr></table></div></figure>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># /usr/local/samba/bin/smbclient -L localhost -U%</span>
</span><span class='line'><span class="no">Domain</span><span class="o">=[</span><span class="no">EXAMPLE</span><span class="o">]</span> <span class="no">OS</span><span class="o">=[</span><span class="no">Unix</span><span class="o">]</span> <span class="no">Server</span><span class="o">=[</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Sharename</span>       <span class="no">Type</span>      <span class="no">Comment</span>
</span><span class='line'>        <span class="o">---------</span>       <span class="o">----</span>      <span class="o">-------</span>
</span><span class='line'>        <span class="n">netlogon</span>        <span class="no">Disk</span>
</span><span class='line'>        <span class="n">sysvol</span>          <span class="no">Disk</span>
</span><span class='line'>        <span class="no">IPC</span><span class="err">$</span>            <span class="no">IPC</span>       <span class="no">IPC</span> <span class="no">Service</span> <span class="p">(</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="p">)</span>
</span><span class='line'><span class="no">Domain</span><span class="o">=[</span><span class="no">EXAMPLE</span><span class="o">]</span> <span class="no">OS</span><span class="o">=[</span><span class="no">Unix</span><span class="o">]</span> <span class="no">Server</span><span class="o">=[</span><span class="no">Samba</span> <span class="mi">4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">11</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Server</span>               <span class="no">Comment</span>
</span><span class='line'>        <span class="o">---------</span>            <span class="o">-------</span>
</span><span class='line'>
</span><span class='line'>        <span class="no">Workgroup</span>            <span class="no">Master</span>
</span><span class='line'>        <span class="o">---------</span>            <span class="o">-------</span>
</span></code></pre></td></tr></table></div></figure>


<p>El proceso de configuración del Samba va a crear un archivo kerberos de la configuración relaizada, tenemos que enlazarlo al directorio <code>/etc</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">mv</span> <span class="sr">/etc/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span> <span class="sr">/etc/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">ORG</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/usr/</span><span class="n">local</span><span class="o">/</span><span class="n">samba</span><span class="o">/</span><span class="kp">private</span><span class="o">/</span><span class="n">krb5</span><span class="o">.</span><span class="n">conf</span>  <span class="sr">/etc/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Comprobamos el funcionamiento en kerberos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># host -t SRV _ldap._tcp.example.local.</span>
</span><span class='line'><span class="n">_ldap</span><span class="o">.</span><span class="n">_tcp</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span> <span class="n">has</span> <span class="no">SRV</span> <span class="n">record</span> <span class="mi">0</span> <span class="mi">100</span> <span class="mi">389</span> <span class="n">samba</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">local</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Comprobamos la autentificación contra kerberos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="c1"># kinit administrator@EXAMPLE.LOCAL </span>
</span><span class='line'><span class="no">Password</span> <span class="k">for</span> <span class="n">administrator</span><span class="vi">@EXAMPLE</span><span class="o">.</span><span class="n">LOCAL</span><span class="p">:</span>
</span><span class='line'><span class="ss">Warning</span><span class="p">:</span> <span class="no">Your</span> <span class="n">password</span> <span class="n">will</span> <span class="n">expire</span> <span class="k">in</span> <span class="mi">41</span> <span class="n">days</span> <span class="n">on</span> <span class="no">Wed</span> <span class="no">Oct</span>  <span class="mi">1</span> <span class="mi">16</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">11</span> <span class="mi">2014</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si por el contrario nos arroja algún error, tenemos que ver las configuraciones realizadas o reconfigurar el servicio samba</p>

<h4>Script de arranque</h4>

<p>Para el control del servicio creamos el siguiente script</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">cat</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">samba4</span>
</span><span class='line'><span class="c1">#! /bin/bash</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># samba4 Bring up/down samba4 service</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># chkconfig: - 90 10</span>
</span><span class='line'><span class="c1"># description: Activates/Deactivates all samba4 interfaces configured to#</span>
</span><span class='line'><span class="c1"># chkconfig: - 90 10</span>
</span><span class='line'><span class="c1"># description: Activates/Deactivates all samba4 interfaces configured to</span>
</span><span class='line'><span class="c1"># start at boot time.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1">### BEGIN INIT INFO</span>
</span><span class='line'><span class="c1"># Provides:</span>
</span><span class='line'><span class="c1"># Should-Start:</span>
</span><span class='line'><span class="c1"># Short-Description: Bring up/down samba4</span>
</span><span class='line'><span class="c1"># Description: Bring up/down samba4</span>
</span><span class='line'><span class="c1">### END INIT INFO</span>
</span><span class='line'><span class="c1"># Source function library.</span>
</span><span class='line'><span class="o">.</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">functions</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/etc/s</span><span class="n">ysconfig</span><span class="o">/</span><span class="n">samba4</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'><span class="o">.</span> <span class="sr">/etc/s</span><span class="n">ysconfig</span><span class="o">/</span><span class="n">samba4</span>
</span><span class='line'><span class="n">fi</span>
</span><span class='line'>
</span><span class='line'><span class="no">CWD</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
</span><span class='line'><span class="n">prog</span><span class="o">=</span><span class="s2">&quot;samba4&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">start</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="c1"># Attach irda device</span>
</span><span class='line'><span class="n">echo</span> <span class="o">-</span><span class="n">n</span> <span class="vg">$&quot;</span><span class="no">Starting</span> <span class="vg">$prog</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">/usr/local/samba/sbin/samba</span>
</span><span class='line'><span class="s2">sleep 2</span>
</span><span class='line'><span class="s2">if ps ax | grep -v &quot;</span><span class="n">grep</span><span class="s2">&quot; | grep -q /samba/sbin/samba ; then success $&quot;</span><span class="n">samba4</span> <span class="n">startup</span><span class="s2">&quot;; else failure $&quot;</span><span class="n">samba4</span> <span class="n">startup</span><span class="s2">&quot;; fi</span>
</span><span class='line'><span class="s2">echo</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">stop() {</span>
</span><span class='line'><span class="s2"># Stop service.</span>
</span><span class='line'><span class="s2">echo -n $&quot;</span><span class="no">Shutting</span> <span class="n">down</span> <span class="vg">$prog</span><span class="p">:</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">killall samba</span>
</span><span class='line'><span class="s2">sleep 2</span>
</span><span class='line'><span class="s2">if ps ax | grep -v &quot;</span><span class="n">grep</span><span class="s2">&quot; | grep -q /samba/sbin/samba ; then failure $&quot;</span><span class="n">samba4</span> <span class="n">shutdown</span><span class="s2">&quot;; else success $&quot;</span><span class="n">samba4</span> <span class="n">shutdown</span><span class="s2">&quot;; fi</span>
</span><span class='line'><span class="s2">echo</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">status() {</span>
</span><span class='line'><span class="s2">/usr/local/samba/sbin/samba --show-build</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2"> </span>
</span><span class='line'><span class="s2"># See how we were called.</span>
</span><span class='line'><span class="s2">case &quot;</span><span class="vg">$1</span><span class="s2">&quot; in</span>
</span><span class='line'><span class="s2">start)</span>
</span><span class='line'><span class="s2">start</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">stop)</span>
</span><span class='line'><span class="s2">stop</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">status)</span>
</span><span class='line'><span class="s2">status irattach</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">restart|reload)</span>
</span><span class='line'><span class="s2">stop</span>
</span><span class='line'><span class="s2">start</span>
</span><span class='line'><span class="s2">;;</span>
</span><span class='line'><span class="s2">*)</span>
</span><span class='line'><span class="s2">echo $&quot;</span><span class="ss">Usage</span><span class="p">:</span> <span class="vg">$0</span> <span class="p">{</span><span class="n">start</span><span class="o">|</span><span class="n">stop</span><span class="o">|</span><span class="n">restart</span><span class="o">|</span><span class="n">status</span><span class="p">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">exit 1</span>
</span><span class='line'><span class="s2">esac</span>
</span><span class='line'><span class="s2"> </span>
</span><span class='line'><span class="s2">exit 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>Configuramos los permisos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="sr">/etc/ini</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">samba4</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente dejamos los servicios para correr por defecto</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">samba4</span> <span class="n">on</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">ntp</span> <span class="n">on</span>
</span><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@samba</span> <span class="o">~]</span><span class="err">$</span> <span class="n">chkconfig</span> <span class="o">--</span><span class="n">levels</span> <span class="mi">235</span> <span class="n">named</span> <span class="n">on</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora ya tenemos configurado el Samba, desde ahora podemos empezar a conectar a los usuarios.</p>

<h4>Uniendo una máquina al dominio</h4>

<h4>Getión remota del controlado de dominio (Remote Server Administration Tool)</h4>

<p>Para la gestión remota del controlador de dominio descargamos <i>Remote Server Administration Tool</i> desde <a href="http://www.microsoft.com/es-es/download/details.aspx?id=7887">acá</a>:
 Instalación</p>

<ol>
<li>Lo instalamos como cualquier exe</li>
<li>Panel de control </li>
<li>Programas y caracteristicas</li>
<li>Activar o desactivar caracteristicas</li>
<li>Seleccionamos las caracteristicas asociadas al A/D</li>
<li>Reinciamos la máquina Windows</li>
<li>Inicio -> Ejecutar -> &#8220;Usuarios y Equipos de Active Directory&#8221; y veremos el arbol de nuestro Samba4</li>
</ol>


<p>Para mas detalles del RSTA <a href="https://wiki.samba.org/index.php/Installing_RSAT_on_Windows_for_AD_Management">acá</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Creando un Box para Vagrant]]></title>
    <link href="http://mcoam.github.io/blog/2014/08/02/creando-un-box-para-vagrant/"/>
    <updated>2014-08-02T23:50:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/08/02/creando-un-box-para-vagrant</id>
    <content type="html"><![CDATA[<p>En mi caso la máquina virtual no fue creada desde cero, ya que bajé un Box de Vagrant y lo customicé por lo que me salté los pasos previos de la creación del box <a href="https://docs.vagrantup.com/v2/boxes/base.html.">https://docs.vagrantup.com/v2/boxes/base.html.</a> Lo realizado para la creación del box fue lo siguiente:</p>

<p><li> Optimización de tamaño de la VM </li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">sudo</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=</span><span class="sr">/dev/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="sr">/EMPTY bs=1M</span>
</span><span class='line'><span class="sr">$ sudo rm -f /</span><span class="no">EMPTY</span>
</span><span class='line'><span class="err">$</span> <span class="n">sudo</span> <span class="n">shutdown</span> <span class="o">-</span><span class="n">h</span> <span class="n">now</span>
</span></code></pre></td></tr></table></div></figure>


<p><li> Creación del Box </li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">cd</span> <span class="o">~</span><span class="sr">/VirtualBox\ VMs/</span> <span class="c1"># directorio donde quedan alojadas las vms</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VirtualBox</span> <span class="no">VMs</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">package</span> <span class="o">--</span><span class="n">base</span> <span class="n">puppetserver</span> <span class="c1">##puppetserver es el nombre de la vm en virtualbox</span>
</span></code></pre></td></tr></table></div></figure>


<p><li> Testing del Box</li>
Agreagamos nuestro Box a nuestro Vagrant</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">box</span> <span class="n">add</span> <span class="no">Centos6PuppetServer</span> <span class="o">~</span><span class="sr">/VirtualBox\ VMs/</span><span class="n">package</span><span class="o">.</span><span class="n">box</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">box</span><span class="p">:</span> <span class="no">Adding</span> <span class="n">box</span> <span class="s1">&#39;Centos6PuppetServer&#39;</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="k">for</span> <span class="ss">provider</span><span class="p">:</span>
</span><span class='line'>    <span class="ss">box</span><span class="p">:</span> <span class="ss">Downloading</span><span class="p">:</span> <span class="ss">file</span><span class="p">:</span><span class="sr">//</span><span class="o">/</span><span class="no">Users</span><span class="o">/</span><span class="no">Miguel</span><span class="o">/</span><span class="no">VirtualBox</span><span class="o">%</span><span class="mi">20</span><span class="no">VMs</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">box</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">box</span><span class="p">:</span> <span class="no">Successfully</span> <span class="n">added</span> <span class="n">box</span> <span class="s1">&#39;Centos6PuppetServer&#39;</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="k">for</span> <span class="s1">&#39;virtualbox&#39;</span><span class="o">!</span>
</span></code></pre></td></tr></table></div></figure>


<p>Verificamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">PuppetMaster</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">box</span> <span class="n">list</span>
</span><span class='line'><span class="no">Centos6PuppetServer</span> <span class="p">(</span><span class="n">virtualbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># nuestro box</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nos dirigimos a nuestro directorio de trabajo de Vagrant y crearemos un nuevo proyecto <i>testing</i></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VagrantVM</span><span class="err">$</span> <span class="n">mkdir</span> <span class="n">testing</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">VagrantVM</span><span class="err">$</span> <span class="n">cd</span> <span class="n">testing</span><span class="o">/</span>
</span></code></pre></td></tr></table></div></figure>


<p>Iniciamos una nueva VM</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">init</span> <span class="no">Centos6PuppetServer</span> <span class="c1">##la iniciamos</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">up</span> <span class="c1">#la arrancamos</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="n">testing</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span> <span class="c1">#nos conectamos</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Red pública para máquinas virtuales en Vagrant ]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/30/red-publica-para-maquinas-virtuales-en-vagrant/"/>
    <updated>2014-07-30T15:05:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/30/red-publica-para-maquinas-virtuales-en-vagrant</id>
    <content type="html"><![CDATA[<p>Por defecto las máquinas virtuales creadas en Vagrant quedan configuradas con una ip &ldquo;privada&rdquo; y el acceso a la VM es por medio de NAT. Si deseamos configurar una ip &ldquo;publica&rdquo; en nuestra máquina virtual tenemos que editar nuestro <code>Vagranfile</code> y adicionar el parámetro <code>vm.network</code> dentro de nuestro apartado <code>config.vm.define</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="ss">:puppet</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppet_config</span><span class="o">|</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;Centos&quot;</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span>  <span class="o">=</span> <span class="s2">&quot;puppetmaster.example.com&quot;</span>
</span><span class='line'>     <span class="n">puppet_config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="ss">:public_network</span><span class="p">,</span>  <span class="ss">bridge</span><span class="p">:</span> <span class="s1">&#39;en1: Wi-Fi (AirPort)&#39;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.1.36&quot;</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vboxpuppet</span><span class="o">|</span>
</span><span class='line'>        <span class="n">vboxpuppet</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;puppetmaster&quot;</span>
</span><span class='line'>    <span class="k">end</span> <span class="c1">##cierra config.vm.provider</span>
</span><span class='line'>  <span class="k">end</span> <span class="c1">##cierra config.vm.define</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span> <span class="c1">##cierra file</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y si nos conectamos</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span>
</span><span class='line'><span class="o">[</span><span class="n">vagrant</span><span class="vi">@puppetmaster</span> <span class="o">~]</span><span class="err">$</span> <span class="n">ifconfig</span>
</span><span class='line'><span class="n">eth0</span>      <span class="no">Link</span> <span class="ss">encap</span><span class="p">:</span><span class="no">Ethernet</span>  <span class="no">HWaddr</span> <span class="mi">08</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="mi">35</span><span class="ss">:D8</span>
</span><span class='line'>          <span class="n">inet</span> <span class="ss">addr</span><span class="p">:</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">36</span>  <span class="ss">Bcast</span><span class="p">:</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">255</span>  <span class="ss">Mask</span><span class="p">:</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">255</span><span class="o">.</span><span class="mi">0</span>
</span><span class='line'>          <span class="n">inet6</span> <span class="ss">addr</span><span class="p">:</span> <span class="ss">fe80</span><span class="p">:</span><span class="ss">:a00</span><span class="p">:</span><span class="mi">27</span><span class="ss">ff</span><span class="p">:</span><span class="ss">fe97</span><span class="p">:</span><span class="mi">35</span><span class="n">d8</span><span class="o">/</span><span class="mi">64</span> <span class="ss">Scope</span><span class="p">:</span><span class="no">Link</span>
</span><span class='line'>          <span class="no">UP</span> <span class="no">BROADCAST</span> <span class="no">RUNNING</span> <span class="no">MULTICAST</span>  <span class="ss">MTU</span><span class="p">:</span><span class="mi">1500</span>  <span class="ss">Metric</span><span class="p">:</span><span class="mi">1</span>
</span><span class='line'>          <span class="no">RX</span> <span class="ss">packets</span><span class="p">:</span><span class="mi">36</span> <span class="ss">errors</span><span class="p">:</span><span class="mi">0</span> <span class="ss">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="ss">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="ss">frame</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>          <span class="no">TX</span> <span class="ss">packets</span><span class="p">:</span><span class="mi">15</span> <span class="ss">errors</span><span class="p">:</span><span class="mi">0</span> <span class="ss">dropped</span><span class="p">:</span><span class="mi">0</span> <span class="ss">overruns</span><span class="p">:</span><span class="mi">0</span> <span class="ss">carrier</span><span class="p">:</span><span class="mi">0</span>
</span><span class='line'>          <span class="ss">collisions</span><span class="p">:</span><span class="mi">0</span> <span class="ss">txqueuelen</span><span class="p">:</span><span class="mi">1000</span>
</span><span class='line'>          <span class="no">RX</span> <span class="ss">bytes</span><span class="p">:</span><span class="mi">5256</span> <span class="p">(</span><span class="mi">5</span><span class="o">.</span><span class="mi">1</span> <span class="no">KiB</span><span class="p">)</span>  <span class="no">TX</span> <span class="ss">bytes</span><span class="p">:</span><span class="mi">998</span> <span class="p">(</span><span class="mi">998</span><span class="o">.</span><span class="mi">0</span> <span class="n">b</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ref: <a href="https://docs.vagrantup.com/v2/networking/public_network.html">https://docs.vagrantup.com/v2/networking/public_network.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Path Global para todos los Execs en Puppet]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/24/path-global-para-todos-los-execs-en-puppet/"/>
    <updated>2014-07-24T14:37:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/24/path-global-para-todos-los-execs-en-puppet</id>
    <content type="html"><![CDATA[<p>En Puppet si tenemos varios <code>Exec</code> para ejecutar comandos del sistema operativo podemos configurar el atributo <code>path</code> de forma global dentro del <code>site.pp</code> y con ello evitamos repetir código.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span> <span class="p">{</span> <span class="s2">&quot;restart-dns&quot;</span><span class="p">:</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s2">&quot;service named restart&quot;</span>
</span><span class='line'><span class="n">creates</span> <span class="o">=&gt;</span> <span class="s2">&quot;/var/named&quot;</span><span class="p">,</span>
</span><span class='line'><span class="n">refreshonly</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>site.pp</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Exec</span> <span class="p">{</span> <span class="n">path</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="s2">&quot;/bin/&quot;</span><span class="p">,</span> <span class="s2">&quot;/sbin/&quot;</span> <span class="p">,</span> <span class="s2">&quot;/usr/bin/&quot;</span><span class="p">,</span> <span class="s2">&quot;/usr/sbin/&quot;</span> <span class="o">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Controlando la ejecución de Exec en Puppet]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/23/controlando-la-ejecucion-de-exec-en-puppet/"/>
    <updated>2014-07-23T21:25:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/23/controlando-la-ejecucion-de-exec-en-puppet</id>
    <content type="html"><![CDATA[<p>En Puppet podemos ejecutar comando a nivel del sistema operativo por medio de <code>Exec</code>, en ocasiones sucede que tenemos declarada la sintaxis a ejecutar pero sucede que esta se aplica cada vez que corre el agente Puppet, Ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'>  <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>  <span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior instalará un rpm llamado <code>package.rpm</code> cada vez que corra el agente, lo que pisará las configuraciones ya realizadas en la instalación y post-instalación del rpm. Para evitar que esto suceda <code>Exec</code> maneja dos atributos <code>creates</code> y <code>onlyif</code> ambos como condicionantes para que se puede ejecutar el comando.
<li>creates</li>
Funciona del modo que para ejecutar el atributo <code>command</code> no tiene que existir &ldquo;algo&rdquo; que se define con el atributo <code>creates</code>, ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'><span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'><span class="n">creates</span> <span class="o">=&gt;</span> <span class="s1">&#39;/opt/rpm-directory/&#39;</span><span class="p">,</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior dice que; para que se ejecute el <code>exec</code> no tiene que estar creado el directorio <code>/opt/rpm-directory/</code>, si este ya esta creado, es por que ya tenemos instalado el rpm y no es necesario volver a instalarlo.</p>

<p><li>onlyif</li>
Funciona del modo que para ejecutar el atributo <code>command</code> el resultado del atributo <code>onlyif</code> debe retornar value 0 &ldquo;nada&rdquo; como respuesta a la condición, ejemplo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">exec</span><span class="p">{</span><span class="s2">&quot;install-rpm&quot;</span><span class="p">:</span>
</span><span class='line'><span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'><span class="n">onlyif</span> <span class="o">=&gt;</span> <span class="s2">&quot;ls /opt/ |grep rpm-directory&quot;</span>
</span><span class='line'><span class="n">command</span> <span class="o">=&gt;</span> <span class="s1">&#39;rpm -Uvh /root/package.rpm&#39;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior dice que; para que se ejecute el <code>exec</code> la salida del <code>onlyif</code> debe retornar 0. Si el rpm ya lo tenemos instalado, este va a crear el directorio por lo que para evitar que se siga instalando solo vemos si este ya fue creado. Si el rpm fue instalado, el <code>onlyif</code> retornará un <i>1</i> por lo que no se volverá a ejecutar nuevamente.</p>

<p>Link <a href="http://docs.puppetlabs.com/references/latest/type.html#exec-attribute">documentación</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Configurando Vagrant en OSX]]></title>
    <link href="http://mcoam.github.io/blog/2014/07/07/configurando-vagrant-en-osx/"/>
    <updated>2014-07-07T15:30:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/07/07/configurando-vagrant-en-osx</id>
    <content type="html"><![CDATA[<p>En la búsqueda de correr máquinas virtuales de forma mas simple me he decidido instalar <code>Vagrant</code>, que es un entorno para la gestión de máquinas virtuales bajo mbiente VirtualBox. La mágia de Vagrant viene de la mano de VirtualBox ya que este tiene soporte para correr máquinas virtuales del tipo <i>headless</i> (algo así como máquinas que corren en un servidor pero no sabes donde).</p>

<h4>Instalación de Vagrant en OSX 10.9.3</h4>

<p>Lo primero es bajar la versión correspondiente de <a href="http://www.vagrantup.com/downloads">Vagrant</a> y lo mismo para <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a>. Una vez descargado ambos paquetes (dmg) se instalan como cualquier otra programa para mac.
Es necesario tener instalado una librerias Ruby para el trabajo con Vagrant, proceso que se realiza con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="n">install</span> <span class="n">vagrant</span>
</span></code></pre></td></tr></table></div></figure>


<p>La gestión de las máquinas virtuales en Vagrant se realizan mediante el comando <code>vagrant</code> <i>(init, up, destroy, ssh, resume, suspend, halt y muchas más)</i>, todas las opciones que tiene este comando figuran en la <a href="http://docs.vagrantup.com/v2/cli/">documentación</a></p>

<h4>Instalando nuestro primer Box</h4>

<p>Lo primero que tenemos que hacer es bajar nuestro Box, que será la <i>imagen base</i> desde donde crearemos nuestras máquinas virtuales:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vagrant</span> <span class="n">box</span> <span class="n">add</span> <span class="no">CentOS</span>  <span class="ss">https</span><span class="p">:</span><span class="sr">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2</span><span class="n">creatives</span><span class="o">/</span><span class="n">vagrant</span><span class="o">-</span><span class="n">centos</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v6</span><span class="o">.</span><span class="mi">4</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">centos64</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mi">20140116</span><span class="o">.</span><span class="n">box</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bajamos y agregamos un nuevo Box de sistema que se llama &ldquo;Centos&rdquo; que se encuentra hosteado remotamente, puedes ver la infinidad de Box disponibles <a href="http://www.vagrantbox.es/">acá</a>
Podemos ver los Box instalados con el siguiente comando</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">vagrant</span> <span class="n">box</span> <span class="n">list</span>
</span><span class='line'><span class="no">CentOS</span> <span class="p">(</span><span class="n">virtualbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Corriendo nuesta máquina virtual</h4>

<p>Teniendo nuestro Box, podemos instanciar nuesta primera máquina virtual para lo cual tenemos que ejecutar el comando <code>vagrant init</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">init</span>
</span><span class='line'><span class="n">A</span> <span class="sb">`Vagrantfile`</span> <span class="n">has</span> <span class="n">been</span> <span class="n">placed</span> <span class="k">in</span> <span class="n">this</span> <span class="n">directory</span><span class="o">.</span> <span class="no">You</span> <span class="n">are</span> <span class="n">now</span>
</span><span class='line'><span class="n">ready</span> <span class="n">to</span> <span class="sb">`vagrant up`</span> <span class="n">your</span> <span class="n">first</span> <span class="n">virtual</span> <span class="n">environment!</span> <span class="no">Please</span> <span class="n">read</span>
</span><span class='line'><span class="n">the</span> <span class="n">comments</span> <span class="k">in</span> <span class="n">the</span> <span class="no">Vagrantfile</span> <span class="n">as</span> <span class="n">well</span> <span class="n">as</span> <span class="n">documentation</span> <span class="n">on</span>
</span><span class='line'><span class="sb">`vagrantup.com`</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span> <span class="n">on</span> <span class="n">using</span> <span class="no">Vagrant</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior creará un archivo de configuración base llamado Vagrantfile, donde se definieran una seríe de instrucción con las caracteristicas internas (ip, hostname, puertos, servicios) asociadas al SO, como las externas (memoria, cpu, etc) asociadas a VirtualBox, para el caso la dejaremos por defecto esta configurción.
Luego de tener creado nuestro <code>Vagrantfile</code> creado, podemos iniciar nuestra nueva instancia de máquina virtual:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">up</span>
</span><span class='line'><span class="no">Bringing</span> <span class="n">machine</span> <span class="s1">&#39;default&#39;</span> <span class="n">up</span> <span class="n">with</span> <span class="s1">&#39;virtualbox&#39;</span> <span class="n">provider</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Importing</span> <span class="n">base</span> <span class="n">box</span> <span class="s1">&#39;Centos&#39;</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Matching</span> <span class="no">MAC</span> <span class="n">address</span> <span class="k">for</span> <span class="no">NAT</span> <span class="n">networking</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Setting</span> <span class="n">the</span> <span class="nb">name</span> <span class="n">of</span> <span class="n">the</span> <span class="ss">VM</span><span class="p">:</span> <span class="no">Puppet_default_1404758552103_56627</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Clearing</span> <span class="n">any</span> <span class="n">previously</span> <span class="n">set</span> <span class="n">network</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Preparing</span> <span class="n">network</span> <span class="n">interfaces</span> <span class="n">based</span> <span class="n">on</span> <span class="n">configuration</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">Adapter</span> <span class="mi">1</span><span class="p">:</span> <span class="n">nat</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Forwarding</span> <span class="n">ports</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="mi">22</span> <span class="o">=&gt;</span> <span class="mi">2222</span> <span class="p">(</span><span class="n">adapter</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Booting</span> <span class="no">VM</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Waiting</span> <span class="k">for</span> <span class="n">machine</span> <span class="n">to</span> <span class="n">boot</span><span class="o">.</span> <span class="no">This</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="n">few</span> <span class="n">minutes</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="ss">address</span><span class="p">:</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span><span class="mi">2222</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="ss">username</span><span class="p">:</span> <span class="n">vagrant</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="no">SSH</span> <span class="n">auth</span> <span class="nb">method</span><span class="p">:</span> <span class="kp">private</span> <span class="n">key</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="ss">Warning</span><span class="p">:</span> <span class="no">Remote</span> <span class="n">connection</span> <span class="n">disconnect</span><span class="o">.</span> <span class="no">Retrying</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Machine</span> <span class="n">booted</span> <span class="ow">and</span> <span class="n">ready!</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Checking</span> <span class="k">for</span> <span class="n">guest</span> <span class="n">additions</span> <span class="k">in</span> <span class="no">VM</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o">==&gt;</span> <span class="ss">default</span><span class="p">:</span> <span class="no">Mounting</span> <span class="n">shared</span> <span class="n">folders</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="ss">default</span><span class="p">:</span> <span class="sr">/vagrant =&gt; /</span><span class="no">Users</span><span class="o">/</span><span class="no">Miguel</span><span class="o">/</span><span class="no">VagrantVM</span><span class="o">/</span><span class="no">Puppet</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ahora, la VM se encuentra corriendo en nuestro equipo. Podemos conectarnos con el comando <code>vagrant ssh</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">vagrant</span> <span class="n">ssh</span>
</span><span class='line'><span class="o">[</span><span class="n">vagrant</span><span class="vi">@vagrant</span><span class="o">-</span><span class="n">centos64</span> <span class="o">~]</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>Por defecto el nombre con que queda la VM y se puede ver mediante la GUI de VirtualBox no es para nada descriptivo, pero puede ser modificado editando el archivo <code>Vagranfile</code> adicionando la variable <code>name</code> de la sección <code>config.vm.provider</code> (líneas nº 9,10,11)  .</p>

<p><img class="center" src="http://mcoam.github.io/images/vagrantDefaultName.png"></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="n">cat</span> <span class="no">Vagrantfile</span>
</span><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;Centos&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">puppetmaster</span><span class="o">|</span>
</span><span class='line'>     <span class="n">puppetmaster</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;puppetmaster&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Podemos ver el nuevo nombre por línea de comando (Nombre que será también el de la GUI de VirtualBox)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span> <span class="no">VBoxManage</span> <span class="n">list</span> <span class="n">runningvms</span>
</span><span class='line'><span class="s2">&quot;puppetmaster&quot;</span> <span class="p">{</span><span class="n">c980cd9e</span><span class="o">-</span><span class="mi">3329</span><span class="o">-</span><span class="mi">4</span><span class="n">aa8</span><span class="o">-</span><span class="mi">8</span><span class="n">d58</span><span class="o">-</span><span class="n">b84e389fff68</span><span class="p">}</span>
</span><span class='line'><span class="ss">Miguel</span><span class="p">:</span><span class="no">Puppet</span><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>No esta demás el link de la <a href="https://docs.vagrantup.com">documentación</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Módulo SSH Puppet y Hiera]]></title>
    <link href="http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/"/>
    <updated>2014-06-26T21:28:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera</id>
    <content type="html"><![CDATA[<p>El siguiente es un módulo de Puppet para la administración del servicio ssh en Linux (Rhel/Debian). La idea, de módulo es tomar los valores de las variables <code>port</code> <code>usedns</code> y <code>permit_root_login</code>.</p>

<p><li>Clase init.pp</li>
Esta clase lo que hace es heredar las definición de variables que nosotros tenemos en nuestra clase <code>params.pp</code> e instancia el orden de la ejecución de las clases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">init</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="n">sshmcoa</span> <span class="p">(</span>
</span><span class='line'>    <span class="vg">$port</span>               <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$usedns</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:ensure</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$port</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$service_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:service_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_file</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_file</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$package_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:package_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_template</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'><span class="p">)</span> <span class="n">inherits</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::install&#39;</span><span class="p">:</span> <span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::config&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::service&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Class</span> <span class="o">[</span><span class="s1">&#39;sshmcoa&#39;</span><span class="o">]</span>
</span><span class='line'> <span class="c1">#notify {&quot;EL PUERTO ES: $port&quot;:}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase params.pp</li>
En esta clase se definen todos los parámetros a configurar por la clase dependiendo del sistema operativo (familia RedHat o familia Debian)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">params</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span><span class="p">{</span>
</span><span class='line'>    <span class="vg">$port</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$usedns</span>       <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="s1">&#39;present&#39;</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$listen_address</span>     <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="s1">&#39;sshmcoa/sshd_config.conf.erb&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>          <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;sshd&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;openssh-server&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<!-- more -->


<p><li>Clase install.pp</li>
Esta es la clase encargada de la instalación del paquete para el servicio ssh, dependiendo del <code>osfamily</code> se instalará el pauete <code>ssh</code> o <code>openssh-server</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">install</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:install</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase service.pp</li>
Se configurar las opciones propias del servicio ssh</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">service</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:service</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">service</span> <span class="p">{</span><span class="s2">&quot;$service_name&quot;</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasstatus</span>  <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasrestart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">enable</span>      <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="nb">require</span>    <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span>    
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase config.pp</li>
Configuramos los valores del archivo sshd_config. El nombre del archivo viene heredado de la de la clase principal bajo la variable <code>$config_file</code>, y el contenido <code>content</code> que tendrá el archivo es creado mediante un template <code>.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="c1"># cat config.pp </span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">file</span> <span class="p">{</span> <span class="vg">$config_file</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="vg">$ensure</span><span class="p">,</span>
</span><span class='line'>          <span class="n">owner</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">group</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">mode</span>    <span class="o">=&gt;</span> <span class="s1">&#39;600&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="vg">$config_template</span><span class="p">),</span>
</span><span class='line'>      <span class="n">notify</span>  <span class="o">=&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="s2">&quot;$service_name&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo sshd_config.conf.erb</li>
Este es el arhivo .erb que se crea con el contenido dinámico con el valor de las variables que fueron ingresadas desde <code>Hiera</code>. Para el caso de la clase, los valores que modificamos son <code>port</code> <code>usedns</code> y <code>permit_root_login</code> y para importalos al template tenemos que utilizar el formato <code>&lt;%= @NOMBRE_DE_VARIABLE %></code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">erb</span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="o">&lt;</span><span class="sx">%= @port %&gt;</span>
</span><span class='line'><span class="sx">Protocol 2</span>
</span><span class='line'><span class="sx">SyslogFacility AUTHPRIV</span>
</span><span class='line'><span class="sx">PasswordAuthentication yes</span>
</span><span class='line'><span class="sx">ChallengeResponseAuthentication no</span>
</span><span class='line'><span class="sx">GSSAPIAuthentication yes</span>
</span><span class='line'><span class="sx">GSSAPICleanupCredentials yes</span>
</span><span class='line'><span class="sx">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="sx">PermitRootLogin &lt;%=</span> <span class="vi">@permit_root_login</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">UsePAM yes</span>
</span><span class='line'><span class="sx">#UseDNS Puppet</span>
</span><span class='line'><span class="sx">UseDNS &lt;%= @usedns %&gt;</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo Hiera.yaml</li>
Dentro de nuestro <code>common.yaml</code> configuramos los valores que tendrán las variables del servicio ssh.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">hieradata</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">common</span><span class="o">.</span><span class="n">yaml</span>
</span><span class='line'><span class="o">---</span>
</span><span class='line'><span class="ss">classes</span><span class="p">:</span>
</span><span class='line'>     <span class="o">-</span> <span class="n">sshmcoa</span>
</span><span class='line'>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:port</span><span class="p">:</span> <span class="s1">&#39;2222&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente cuando conectemos el nodo veremos como se ejecuta la clase con los valores que le hemos pasado</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># !puppet</span>
</span><span class='line'><span class="n">puppet</span> <span class="n">agent</span> <span class="o">--</span><span class="nb">test</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Retrieving</span> <span class="n">plugin</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">root_home</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">puppet_vardir</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">pe_version</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">hosts_managed</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">facter_dot_d</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Caching</span> <span class="n">catalog</span> <span class="k">for</span> <span class="n">node1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Applying</span> <span class="n">configuration</span> <span class="n">version</span> <span class="s1">&#39;1401042981&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Install</span><span class="o">/</span><span class="no">Package</span><span class="o">[</span><span class="n">openssh</span><span class="o">-</span><span class="n">server</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="n">created</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span>
</span><span class='line'><span class="o">---</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mo">03</span><span class="o">.</span><span class="mo">000000000</span> <span class="o">-</span><span class="mo">0300</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">FileBucket</span> <span class="n">adding</span> <span class="p">{</span><span class="n">md5</span><span class="p">}</span><span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Filebucketed</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span> <span class="n">to</span> <span class="n">puppet</span> <span class="n">with</span> <span class="n">sum</span> <span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span> <span class="n">content</span> <span class="n">changed</span> <span class="s1">&#39;{md5}53ad75eb1f2269d23f6e4228353cbca3&#39;</span> <span class="n">to</span> <span class="s1">&#39;{md5}22a041c1bbfd208de0259a2403bf3cbb&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Scheduling</span> <span class="n">refresh</span> <span class="n">of</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="k">ensure</span> <span class="n">changed</span> <span class="s1">&#39;stopped&#39;</span> <span class="n">to</span> <span class="s1">&#39;running&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span><span class="p">:</span> <span class="no">Unscheduling</span> <span class="n">refresh</span> <span class="n">on</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="no">Sshmcoa</span><span class="o">/</span><span class="no">Notify</span><span class="o">[</span><span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span><span class="o">]/</span><span class="ss">message</span><span class="p">:</span> <span class="n">defined</span> <span class="s1">&#39;message&#39;</span> <span class="n">as</span> <span class="s1">&#39;EL PUERTO ES: 2222&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">Finished</span> <span class="n">catalog</span> <span class="n">run</span> <span class="k">in</span> <span class="mi">16</span><span class="o">.</span><span class="mi">27</span> <span class="n">seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si vemos el contenido observaremos que se creó tal cual esta definido en nuestro template erb.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat /etc/ssh/sshd_config </span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="mi">2222</span>
</span><span class='line'><span class="no">Protocol</span> <span class="mi">2</span>
</span><span class='line'><span class="no">SyslogFacility</span> <span class="no">AUTHPRIV</span>
</span><span class='line'><span class="no">PasswordAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">ChallengeResponseAuthentication</span> <span class="n">no</span>
</span><span class='line'><span class="no">GSSAPIAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">GSSAPICleanupCredentials</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="no">PermitRootLogin</span> <span class="n">no</span>
</span><span class='line'><span class="no">UsePAM</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">#UseDNS Puppet</span>
</span><span class='line'><span class="no">UseDNS</span> <span class="n">no</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Desactivar nodo PuppetDB]]></title>
    <link href="http://mcoam.github.io/blog/2014/06/03/desactivar-nodo-puppetdb/"/>
    <updated>2014-06-03T18:44:00-04:00</updated>
    <id>http://mcoam.github.io/blog/2014/06/03/desactivar-nodo-puppetdb</id>
    <content type="html"><![CDATA[<p>En el caso de querer <i>desactivar</i> un nodo de PuppetDB lo podemos realizar con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">puppet</span> <span class="n">node</span> <span class="n">deactivate</span> <span class="n">node1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>


<p>Con lo anterior, el nodo &ldquo;desaparecerá&rdquo; de nuestro Dashboard .</p>

<p>Referencia <a href="http://docs.puppetlabs.com/puppetdb/1/maintain_and_tune.html#deactivate-decommissioned-nodes">acá</a></p>
]]></content>
  </entry>
  
</feed>
