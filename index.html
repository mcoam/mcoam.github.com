
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>Miguel Angel Coa Morales  | Bitácora</title>

	<meta name="author" content="Miguel Angel Coa Morales">

<meta name="description" content="Un blog personal"> <meta name="keywords" content="zimbra, linux, centos, devops, puppet, opensource, virtualizar, virtualización">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Bitácora" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Bitácora</a></h1>
<span class="tagline">Miguel Angel Coa Morales</span>
<nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2016/04/15/configurando-fail2ban-para-autentificaciones-smtp-fallidas-en-mailcleaner/">
			
				Configurando Fail2ban Para Autentificaciones SMTP Fallidas en Mailcleaner</a>
		</h2>
		<div class="meta date">








  


<time datetime="2016-04-15T13:30:00-03:00" pubdate data-updated="true">Apr 15<span>th</span>, 2016</time></div>
	</header>
	<div class="entry-content">
		<p>Para prevenir que estando nuestro servidor <code>SMTP</code> en internet tengamos bloqueos por ataques <code>DoS</code> al puerto 25 podemos implementar el servicio <code>fail2ban</code> para bloquear todo tipo de conexión que falle en la autentificación de forma reiterativa realizando lo siguiente:</p>

<ul>
<li>Instalar <code>fail2ban</code> en el servidor Mailcleaner</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">aptget</span> <span class="n">update</span><span class="p">;</span> <span class="n">aptget</span> <span class="n">install</span> <span class="n">fail2ban</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nos dirigimos al directorio <code>/etc/fail2ban</code>, donde creamos/editamos los siguientes archivos:</p>

<ol type="a">
<li>Archivo <code>filter.d/exim2.conf</code>: Contiene la reglas para el match del jail</li>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp"># Fail2Ban filter for exim</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="cp"># This includes the rejection messages of exim. For spam and filter</span>
</span><span class='line'><span class="cp"># related bans use the exim-spam.conf</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">INCLUDES</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Read common prefixes. If any customizations available -- read them from</span>
</span><span class='line'><span class="cp"># exim-common.local</span>
</span><span class='line'><span class="cp"># before = exim-common.conf</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">Definition</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">failregex</span> <span class="o">=</span> <span class="err">\</span><span class="p">[</span><span class="o">&lt;</span><span class="n">HOST</span><span class="o">&gt;</span><span class="err">\</span><span class="p">]</span><span class="o">:</span> <span class="mi">535</span> <span class="n">Incorrect</span> <span class="n">authentication</span> <span class="n">data</span>
</span><span class='line'>
</span><span class='line'><span class="n">ignoreregex</span> <span class="o">=</span>
</span></code></pre></td></tr></table></div></figure>

<li>Archivo <code>action.d/iptables-repeater.conf</code>: Configura toda la acción a realizar con las ip que fallan con la auth</li>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp"># Fail2ban configuration file</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="cp"># Author: Phil Hagen &lt;phil@identityvector.com&gt;</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">Definition</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Option:  actionstart</span>
</span><span class='line'><span class="cp"># Notes.:  command executed once at the start of Fail2Ban.</span>
</span><span class='line'><span class="cp"># Values:  CMD</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">actionstart</span> <span class="o">=</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">N</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">j</span> <span class="n">RETURN</span>
</span><span class='line'>              <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">j</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>              <span class="err">#</span> <span class="n">set</span> <span class="n">up</span> <span class="n">from</span> <span class="n">the</span> <span class="k">static</span> <span class="n">file</span>
</span><span class='line'>              <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fail2ban</span><span class="o">/</span><span class="n">ip</span><span class="p">.</span><span class="n">blocklist</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="o">^</span><span class="err">\</span><span class="n">s</span><span class="o">*</span><span class="err">#</span><span class="o">|</span><span class="n">awk</span> <span class="err">&#39;</span><span class="p">{</span><span class="n">print</span> <span class="n">$1</span><span class="p">}</span><span class="err">&#39;</span> <span class="o">|</span> <span class="k">while</span> <span class="n">read</span> <span class="n">IP</span><span class="p">;</span> <span class="k">do</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="n">$IP</span> <span class="o">-</span><span class="n">j</span> <span class="n">DROP</span><span class="p">;</span> <span class="n">done</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Option:  actionstop</span>
</span><span class='line'><span class="cp"># Notes.:  command executed once at the end of Fail2Ban</span>
</span><span class='line'><span class="cp"># Values:  CMD</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">actionstop</span> <span class="o">=</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">D</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">j</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>             <span class="n">iptables</span> <span class="o">-</span><span class="n">F</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>             <span class="n">iptables</span> <span class="o">-</span><span class="n">X</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Option:  actioncheck</span>
</span><span class='line'><span class="cp"># Notes.:  command executed once before each actionban command</span>
</span><span class='line'><span class="cp"># Values:  CMD</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">actioncheck</span> <span class="o">=</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">L</span> <span class="n">INPUT</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">q</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Option:  actionban</span>
</span><span class='line'><span class="cp"># Notes.:  command executed when banning an IP. Take care that the</span>
</span><span class='line'><span class="cp">#          command is executed with Fail2Ban user rights.</span>
</span><span class='line'><span class="cp"># Tags:    &lt;ip&gt;  IP address</span>
</span><span class='line'><span class="cp">#          &lt;failures&gt;  number of failures</span>
</span><span class='line'><span class="cp">#          &lt;time&gt;  unix timestamp of the ban time</span>
</span><span class='line'><span class="cp"># Values:  CMD</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">actionban</span> <span class="o">=</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">fail2ban</span><span class="o">-</span><span class="n">REPEAT</span><span class="o">-&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">j</span> <span class="n">DROP</span>
</span><span class='line'>            <span class="err">#</span> <span class="n">also</span> <span class="n">put</span> <span class="n">into</span> <span class="n">the</span> <span class="k">static</span> <span class="n">file</span> <span class="n">to</span> <span class="n">re</span><span class="o">-</span><span class="n">populate</span> <span class="n">after</span> <span class="n">a</span> <span class="n">restart</span>
</span><span class='line'>            <span class="o">!</span> <span class="n">grep</span> <span class="o">-</span><span class="n">Fq</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fail2ban</span><span class="o">/</span><span class="n">ip</span><span class="p">.</span><span class="n">blocklist</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="s">&quot;&lt;ip&gt; # fail2ban/$( date &#39;+%%Y-%%m-%%d %%T&#39; ): auto-add for repeat offender&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fail2ban</span><span class="o">/</span><span class="n">ip</span><span class="p">.</span><span class="n">blocklist</span><span class="p">.</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Option:  actionunban</span>
</span><span class='line'><span class="cp"># Notes.:  command executed when unbanning an IP. Take care that the</span>
</span><span class='line'><span class="cp">#          command is executed with Fail2Ban user rights.</span>
</span><span class='line'><span class="cp"># Tags:    &lt;ip&gt;  IP address</span>
</span><span class='line'><span class="cp">#          &lt;failures&gt;  number of failures</span>
</span><span class='line'><span class="cp">#          &lt;time&gt;  unix timestamp of the ban time</span>
</span><span class='line'><span class="cp"># Values:  CMD</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">actionunban</span> <span class="o">=</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">true</span>
</span><span class='line'>
</span><span class='line'><span class="p">[</span><span class="n">Init</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="cp"># Defaut name of the chain</span>
</span><span class='line'><span class="cp">#</span>
</span><span class='line'><span class="n">name</span> <span class="o">=</span> <span class="n">REPEAT</span>
</span></code></pre></td></tr></table></div></figure>

<li>Archivo <code>ip.blocklist.exim2</code>: Contiene las direcciones ip que se van bloqueando por intentos fallidos y que se va autocompletando con los bloqueos propios del <code>fail2ban</code> <li>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="mf">122.154.29.30</span> <span class="err">#</span> <span class="n">fail2ban</span><span class="o">/</span><span class="mi">2016</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">15</span> <span class="mo">00</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span> <span class="k">auto</span><span class="o">-</span><span class="n">add</span> <span class="k">for</span> <span class="n">repeat</span> <span class="n">offender</span>
</span><span class='line'><span class="mf">95.183.52.100</span> <span class="err">#</span> <span class="n">fail2ban</span><span class="o">/</span><span class="mi">2016</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">15</span> <span class="mo">00</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mi">51</span><span class="o">:</span> <span class="k">auto</span><span class="o">-</span><span class="n">add</span> <span class="k">for</span> <span class="n">repeat</span> <span class="n">offender</span>
</span><span class='line'><span class="mf">110.84.129.110</span> <span class="err">#</span> <span class="n">fail2ban</span><span class="o">/</span><span class="mi">2016</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mi">15</span> <span class="mo">02</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">53</span><span class="o">:</span> <span class="k">auto</span><span class="o">-</span><span class="n">add</span> <span class="k">for</span> <span class="n">repeat</span> <span class="n">offender</span>
</span></code></pre></td></tr></table></div></figure>
</ol>


<p>La configuración del <code>jail</code> la realizamos dentro del archivo <code>/etc/fail2ban/jail.conf</code> , quedando así:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">exim2</span><span class="o">-</span><span class="n">repeater</span><span class="p">]</span>
</span><span class='line'>      <span class="n">enabled</span>  <span class="o">=</span> <span class="n">true</span>
</span><span class='line'>      <span class="n">filter</span>   <span class="o">=</span> <span class="n">exim2</span>
</span><span class='line'>      <span class="n">action</span>   <span class="o">=</span> <span class="n">iptables</span><span class="o">-</span><span class="n">repeater</span><span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="n">exim2</span><span class="p">]</span>
</span><span class='line'>      <span class="n">logpath</span>  <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">mailcleaner</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">exim_stage1</span><span class="o">/</span><span class="n">mainlog</span>
</span><span class='line'>      <span class="n">maxretry</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'>      <span class="n">findtime</span> <span class="o">=</span> <span class="mi">31536000</span>
</span><span class='line'>      <span class="n">bantime</span>  <span class="o">=</span> <span class="mi">31536000</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lo anterior leerá del archivo <code>/var/mailcleaner/log/exim_stage1/mainlog</code> todos los errores del tipo <code>535 Incorrect authentication data</code> si la authenticación falla al intento 10 y además la ip será almacenada en el archivo <code>iptables-repeater.conf</code> .</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2016/03/09/proxmox-4-y-ansible/">
			
				Proxmox 4 Y Ansible, Automatizando La Creación De Contenedores</a>
		</h2>
		<div class="meta date">








  


<time datetime="2016-03-09T11:19:00-03:00" pubdate data-updated="true">Mar 9<span>th</span>, 2016</time></div>
	</header>
	<div class="entry-content">
		<p><code>Proxmox 4</code> soporta contenedores LXC para la virtualización, en el caso de querer automatizar dicha tarea con <code>Ansible</code> y se puede realizar mediante el repositorio <code>git@github.com:mcoam/proxmox4_container_lxc.git</code> donde se detallan los pasos y prerrequisitos a seguir.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/12/17/ansible-chequeando-la-existencia-de-un-directorio/">
			
				Ansible: Chequeando La Existencia De Un Directorio</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-12-17T16:55:00-03:00" pubdate data-updated="true">Dec 17<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>Si necesitamos chequear la existencia de un directorio antes de realizar cualquier tipo de operación (copiear, instalar, etc) se puede utilizar el valor que nos trae el comando <code>stat</code>. Por ejemplo, el el siguiente ejemplo, se realiza lo siguiente:</p>

<ol>
<li>Se instala apache</li>
<li>Se chequea que el directorio <code>conf.d</code> exista</li>
<li>Se copia el archivo <code>site.conf</code></li>
<li>Reiniciar apache</code></li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="k">-</span> <span class="nf">name:</span> <span class="n">Install</span> <span class="n">apache</span>
</span><span class='line'>  <span class="nl">yum:</span> <span class="n">name</span><span class="o">=</span><span class="n">httpd</span> <span class="n">state</span><span class="o">=</span><span class="n">latest</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Check apache path&quot;</span>
</span><span class='line'>  <span class="nl">stat:</span> <span class="n">path</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span>
</span><span class='line'>  <span class="k">register</span><span class="o">:</span> <span class="n">apache_path</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Copy configuration file&quot;</span>
</span><span class='line'>  <span class="nl">copy:</span> <span class="n">src</span><span class="o">=</span><span class="n">site</span><span class="p">.</span><span class="n">conf</span> <span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span>
</span><span class='line'>  <span class="nl">when:</span> <span class="n">apache_path</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">exists</span> <span class="o">==</span> <span class="n">True</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Restart apache&quot;</span>
</span><span class='line'>  <span class="nl">service:</span> <span class="n">name</span><span class="o">=</span><span class="n">httpd</span> <span class="n">state</span><span class="o">=</span><span class="n">restarted</span>
</span><span class='line'>  <span class="nl">when:</span> <span class="n">apache_path</span><span class="p">.</span><span class="n">stat</span><span class="p">.</span><span class="n">exists</span> <span class="o">==</span> <span class="n">True</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/11/12/ansible-configurando-volumen-de-datos-hsm-en-zimbra/">
			
				Ansible: Configurando Volúmen De Datos HSM en Zimbra</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-11-12T18:34:00-03:00" pubdate data-updated="true">Nov 12<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>El siguiente <code>Playbook</code> permite configurar un nuevo volúmen para datos (store) en un servidor Zimbra NE.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">---</span>
</span><span class='line'><span class="o">-</span> <span class="nl">hosts:</span> <span class="n">ne_mailbox</span>
</span><span class='line'>  <span class="nl">remote_user:</span> <span class="n">root</span>
</span><span class='line'>  <span class="nl">vars:</span>
</span><span class='line'>        <span class="nl">zmvolume:</span> <span class="s">&quot;/opt/zimbra/bin/zmvolume&quot;</span>
</span><span class='line'>        <span class="nl">zmhsm:</span> <span class="s">&quot;/opt/zimbra/bin/zmhsm&quot;</span>
</span><span class='line'>        <span class="nl">zmprov:</span> <span class="s">&quot;/opt/zimbra/bin/zmprov&quot;</span>
</span><span class='line'>        <span class="nl">hsm_name:</span> <span class="s">&quot;hsm02&quot;</span>
</span><span class='line'>        <span class="nl">hsm_id:</span> <span class="s">&quot;4&quot;</span> <span class="err">#</span> <span class="n">check</span> <span class="kt">id</span> <span class="n">zmvolume</span> <span class="o">-</span><span class="n">l</span> <span class="o">|</span><span class="n">grep</span> <span class="o">-</span><span class="n">B1</span> <span class="n">hsm02</span>
</span><span class='line'>        <span class="nl">path:</span> <span class="s">&quot;/opt/zimbra/store_hsm_02/&quot;</span>
</span><span class='line'>        <span class="nl">policy_option:</span> <span class="s">&quot; &#39;message,document,task,appointment,contact:before:-1month is:anywhere&#39; &quot;</span>
</span><span class='line'>  <span class="nl">tasks:</span>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Configura volumen HSM como volumen secundario&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmvolume } } -a -name  -c true -t secondaryMessage -p { { path } }&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Activamos nuevo volumen para manejar data&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmvolume } } -sc -id { { hsm_id } } &quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Configuramos politica HSM: Todo por sobre 1 mes se mueve al nuevo volumen&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmprov } } ms { { ansible_fqdn } } zimbraHsmPolicy { { policy_option } }&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Arrancamos el proceso para mover correos al nuevo HSM&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="s">&quot;{ { zmhsm } } -t&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><b>Donde:<br></b>
<code>path: "/opt/zimbra/store_hsm_02/"</code>: Corresponde al punto de montaje del nuevo recurso HSM.<br>
<code>hsm_id: 4"</code>: Corresponde al ID que le asigna Zimbra al nuevo volúmen (disco).<br>
<code>hsm_name: hsm02</code>: Corresponde al nombre que le colocamos al recurso HSM.<br></p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/11/12/montar-leer-y-escribir-en-usb-con-formato-ntfs/">
			
				Montar, Leer Y Escribir en USB Con Formato NTFS en OSX Capitan</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-11-12T18:17:00-03:00" pubdate data-updated="true">Nov 12<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>Con una terminal, ejecutar:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">sudo</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y dentro colocar</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">LABEL</span><span class="o">=</span><span class="n">DRIVE_NAME</span> <span class="n">none</span> <span class="n">ntfs</span> <span class="n">rw</span><span class="p">,</span><span class="k">auto</span><span class="p">,</span><span class="n">nobrowse</span>
</span></code></pre></td></tr></table></div></figure>


<p>Donde:
El <code>DRIVE_NAME</code> corresponde el nombre del dispositivo que conectamos al equipo. En el caso de que el nombre contenga espacios, tenemos que anteponer el backslash <i>&ldquo;\&rdquo;</i> antes del mismo Ej:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">LABEL</span><span class="o">=</span><span class="s">&quot;NO\ NAME&quot;</span> <span class="n">none</span> <span class="n">ntfs</span> <span class="n">rw</span><span class="p">,</span><span class="k">auto</span><span class="p">,</span><span class="n">nobrowse</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/10/28/ansible-trabajando-con-volumenes-pv-slash-vg-slash-lv/">
			
				Ansible: Trabajando Con Volumenes Lógicos PV/VG/LV en Linux</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-10-28T23:52:00-03:00" pubdate data-updated="true">Oct 28<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>Ansible cuenta con un módulos para la gestión de discos en Linux los cuales no permiten administrar nuestros volúmenes.
En el siguiente ejemplo, se crea un volumen sobre un disco <code>/dev/sdf1</code> y que será configurado como volumen lógico y finalmente montado para los backup que realiza un servidor de correos Zimbra.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="o">---</span>
</span><span class='line'><span class="o">-</span> <span class="nl">hosts:</span> <span class="n">ne_mailbox</span>
</span><span class='line'>  <span class="nl">vars:</span>
</span><span class='line'>        <span class="nl">disk_name:</span> <span class="s">&quot;/dev/sdf1&quot;</span>
</span><span class='line'>        <span class="nl">filesystem:</span> <span class="s">&quot;ext4&quot;</span>
</span><span class='line'>        <span class="nl">vg_name:</span> <span class="s">&quot;zimbra_data&quot;</span>
</span><span class='line'>        <span class="nl">lv_size:</span> <span class="s">&quot;100%FREE&quot;</span> <span class="err">#</span><span class="n">ocupar</span> <span class="n">todo</span> <span class="n">el</span> <span class="n">espacio</span> <span class="n">libre</span> <span class="n">del</span> <span class="n">VG</span> <span class="n">zimbra_data</span>
</span><span class='line'>        <span class="nl">lv_name:</span> <span class="s">&quot;backup&quot;</span>
</span><span class='line'>        <span class="nl">path:</span> <span class="s">&quot;/opt/zimbra/backup&quot;</span>
</span><span class='line'>        <span class="nl">user:</span> <span class="s">&quot;zimbra&quot;</span>
</span><span class='line'>  <span class="nl">tasks:</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear el PV sobre el disco nuevo&quot;</span>
</span><span class='line'>          <span class="nl">command:</span> <span class="n">pvcreate</span> <span class="p">{</span> <span class="p">{</span> <span class="n">disk_name</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear nuevo VG&quot;</span>
</span><span class='line'>          <span class="nl">lvg:</span> <span class="n">vg</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">pvs</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">disk_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Crear nuevo volumen LVM&quot;</span>
</span><span class='line'>          <span class="nl">lvol:</span> <span class="n">vg</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">lv</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">size</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_size</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">crea_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Formateo de unidad LVM&quot;</span>
</span><span class='line'>          <span class="nl">filesystem:</span> <span class="n">fstype</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">filesystem</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">dev</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">formatea_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Montar disco&quot;</span>
</span><span class='line'>          <span class="nl">mount:</span> <span class="n">name</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">path</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">src</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">vg_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span><span class="o">/</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">lv_name</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">fstype</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">filesystem</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">state</span><span class="o">=</span><span class="n">mounted</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">monta_lv</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">-</span> <span class="nl">name:</span> <span class="s">&quot;Permisos directorio backup&quot;</span>
</span><span class='line'>          <span class="nl">file:</span> <span class="n">path</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">path</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">state</span><span class="o">=</span><span class="n">directory</span> <span class="n">mode</span><span class="o">=</span><span class="mo">0755</span> <span class="n">owner</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">user</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span> <span class="n">group</span><span class="o">=</span><span class="err">\</span><span class="p">{</span><span class="err">\</span><span class="p">{</span> <span class="n">user</span> <span class="err">\</span><span class="p">}</span><span class="err">\</span><span class="p">}</span>
</span><span class='line'>          <span class="nl">tags:</span> <span class="n">permisos_directorio</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/10/15/notas-sobre-imapsync/">
			
				Notas Sobre Imapsync</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-10-15T23:00:00-03:00" pubdate data-updated="true">Oct 15<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>En el caso de migrar la data de correos vía <code>imapsync</code> es importante tener en consideración (si se va a tener corriendo varios días el comando) utilizar la opción <code>--delete2</code> para que todo correo copiado al <i>(hosts2)</i> y que no tenga copia en el origen <i>(host1)</i> sea borrado, de lo contrario el usuario cuando se conecte al nuevo servidor tendrá correos que ya había eliminado y el buzón pesará mas de lo normal.
De todas formas, lo anterior se puede corregir configrando el <code>imapsyn</code> con el valor <code>&mdash;minage</code> que sincroniza el buzón desde <i>X</i> días para atrás.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">imapsync</span> <span class="o">--</span><span class="n">buffersize</span> <span class="mi">8192000</span> <span class="o">--</span><span class="n">nosyncacls</span> <span class="o">--</span><span class="n">subscribe</span> <span class="o">--</span><span class="n">syncinternaldates</span> <span class="o">--</span><span class="n">authmech1</span> <span class="no">PLAIN</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">host1</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">10</span> <span class="o">--</span><span class="n">user1</span> <span class="n">foo</span><span class="vi">@origen</span><span class="o">.</span><span class="n">dev</span> <span class="o">--</span><span class="n">password1</span> <span class="s1">&#39;foo&#39;</span> <span class="o">--</span><span class="n">host2</span> <span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">11</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">user2</span> <span class="n">foo</span><span class="vi">@destino</span><span class="o">.</span><span class="n">dev</span> <span class="o">--</span><span class="n">password2</span> <span class="s1">&#39;foo&#39;</span> <span class="o">--</span><span class="n">authmech2</span> <span class="no">PLAIN</span> <span class="o">--</span><span class="n">nofoldersizes</span> <span class="o">--</span><span class="n">skipsize</span> <span class="o">--</span><span class="n">fast</span> <span class="o">/</span>
</span><span class='line'><span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;(?i)\b(Junk|Spam|Trash|IMIP|Drafts)\b&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;INBOX_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Trash_(.*)&#39;</span><span class="o">/</span>
</span><span class='line'> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Drafts_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Spam_(.*)&#39;</span> <span class="o">--</span><span class="n">exclude</span> <span class="s1">&#39;Sent Items_(.*)&#39;</span> <span class="o">--</span><span class="n">regextrans2</span> <span class="o">/</span>
</span><span class='line'><span class="s1">&#39;s#^Sent Items#Sent#&#39;</span> <span class="o">--</span><span class="n">delete2duplicates</span> <span class="o">--</span><span class="n">delete2</span> <span class="o">--</span><span class="n">minage</span> <span class="mi">5</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Por ejemplo, hoy estamos a 10 y tiramos el imapsync en el destino empezará a sincronizar (borrando la data que no este en el host1) desde el día 5, con ello evitamos borrar los correos nuevos en el host2.</p>

		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/06/24/seleccionar-y-comentar-texto-con-vim/">
			
				Seleccionar Y Comentar Texto Con VIM</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-06-24T16:03:00-03:00" pubdate data-updated="true">Jun 24<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>En el caso de necesitar seleccionar texto (muchas líneas) con <code>vim</code> podemos hacer lo siguiente:</p>

<ul>
<li> Seleccionar texto en modo <b>visual</b> </li>
<li> Apretar la combinación: <b>:norm i#</b> para agregar los comentarios </li>
</ul>


<p>Para quitar los comentatrios</p>

<ul>
<li> Seleccionar texto en modo <b>visual</b> </li>
<li> Apretar la combinación: <b>:norm x</b> para agregar los comentarios </li>
</ul>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/03/26/instalado-slash-actualizando-paquetes-endian-firewall/">
			
				Instalado/Actualizando Paquetes Endian Firewall</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-03-26T18:35:00-03:00" pubdate data-updated="true">Mar 26<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>Para instalar paquetes en Endian Firewall podemos utilizar el comando <code>smart</code> que es un administrador de paquetes que viene incorporado en la distro. Lo primero que hay que realizar es instalar el repositorio:</p>

<p><li>Para Endian 2.4.x</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">channel</span> <span class="o">--</span><span class="n">add</span> <span class="no">CentOS_4</span><span class="o">.</span><span class="mi">9</span> <span class="n">type</span><span class="o">=</span><span class="n">rpm</span><span class="o">-</span><span class="n">md</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;CentOS_4.9&quot;</span> <span class="p">\</span><span class="n">baseurl</span><span class="o">=</span><span class="s2">&quot;http://vault.centos.org/4.9/os/i386/&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>En el caso de Endian 2.5.x</li></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">channel</span> <span class="o">--</span><span class="n">add</span> <span class="no">CentOS_5</span><span class="o">.</span><span class="mi">9</span> <span class="n">type</span><span class="o">=</span><span class="n">rpm</span><span class="o">-</span><span class="n">md</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;CentOS_5.9&quot;</span> <span class="p">\</span><span class="n">baseurl</span><span class="o">=</span><span class="s2">&quot;http://vault.centos.org/5.9/os/i386/&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instalando paquetes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">update</span>
</span><span class='line'><span class="n">smart</span> <span class="n">install</span> <span class="n">wget</span> <span class="n">nmap</span> <span class="n">vim</span><span class="o">-</span><span class="n">enhanced</span> <span class="o">-</span><span class="n">y</span>
</span></code></pre></td></tr></table></div></figure>


<p>En el caso de ver el error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">warning</span><span class="p">:</span> <span class="n">rpmts_HdrFromFdno</span><span class="p">:</span> <span class="no">Header</span> <span class="no">V3</span> <span class="no">DSA</span> <span class="ss">signature</span><span class="p">:</span> <span class="no">NOKEY</span><span class="p">,</span> <span class="n">key</span> <span class="no">ID</span> <span class="mi">443</span><span class="n">e1821</span>
</span><span class='line'><span class="ss">error</span><span class="p">:</span> <span class="n">vim</span><span class="o">-</span><span class="n">common</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">3</span><span class="o">.</span><span class="mo">046</span><span class="o">-</span><span class="mi">2</span><span class="o">.</span><span class="n">el4</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="n">i386</span><span class="o">.</span><span class="n">rpm</span><span class="p">:</span> <span class="kp">public</span> <span class="n">key</span> <span class="ow">not</span> <span class="n">available</span>
</span><span class='line'><span class="no">Saving</span> <span class="n">cache</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ejecutar</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">smart</span> <span class="n">config</span> <span class="o">--</span><span class="n">set</span>  <span class="n">rpm</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">signatures</span><span class="o">=</span><span class="kp">false</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/blog/2015/01/15/script-para-buscar-y-borrar-un-correo-en-zimbra/">
			
				Script Para Buscar Y Borrar Un Correo en Zimbra</a>
		</h2>
		<div class="meta date">








  


<time datetime="2015-01-15T12:49:00-03:00" pubdate data-updated="true">Jan 15<span>th</span>, 2015</time></div>
	</header>
	<div class="entry-content">
		<p>El siguiente script permite buscar y borrar un correo mediante consola desde los mailbox de los usuarios.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="n">zimbraAccounts</span><span class="o">=</span><span class="s1">&#39;/var/tmp/cuentas&#39;</span>
</span><span class='line'><span class="n">zimbraCMD</span><span class="o">=</span><span class="s1">&#39;/opt/zimbra/bin/zmmailbox&#39;</span>
</span><span class='line'> <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="sb">`cat $zimbraAccounts`</span>
</span><span class='line'>    <span class="k">do</span>
</span><span class='line'>        <span class="c1">#user=`$a`</span>
</span><span class='line'>        <span class="n">emailID</span><span class="o">=</span><span class="p">(</span> <span class="err">$</span><span class="p">(</span><span class="vg">$zimbraCMD</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">m</span> <span class="vg">$a</span> <span class="n">search</span> <span class="s2">&quot;de haber superado debido a la alta tasa de correos spam&quot;</span> <span class="o">|</span><span class="n">grep</span> <span class="n">conv</span> <span class="o">|</span><span class="n">awk</span> <span class="p">{</span><span class="s1">&#39;print $2&#39;</span><span class="p">}</span> <span class="o">|</span><span class="n">sed</span> <span class="s1">&#39;s/-//g&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>        <span class="n">echo</span> <span class="vg">$user</span>
</span><span class='line'>        <span class="c1">#echo ${emailID[1]}</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="s2">&quot;${emailID[@]}&quot;</span>
</span><span class='line'>                <span class="k">do</span>
</span><span class='line'>                    <span class="vg">$zimbraCMD</span> <span class="o">-</span><span class="n">z</span> <span class="o">-</span><span class="n">m</span> <span class="vg">$a</span> <span class="n">dm</span> <span class="vg">$i</span>
</span><span class='line'>          <span class="n">echo</span> <span class="s2">&quot;cuenta: $a&quot;</span> <span class="o">&gt;&gt;</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">casillasConEmail</span>
</span><span class='line'>                <span class="n">done</span>
</span><span class='line'>    <span class="n">done</span>
</span></code></pre></td></tr></table></div></figure>


<p>En la línea nº8 tenemos que cambiar el texto a buscar, y que corresponde a lo que esta dentro de comillas.
Para el caso, tenemos que tener las cuentas de correos en el archivo <code>/var/tmp/cuentas</code> que las podemos obtener con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">zmprov</span> <span class="o">-</span><span class="n">l</span> <span class="n">gaa</span> <span class="o">|</span><span class="n">egrep</span> <span class="o">-</span><span class="n">vi</span> <span class="s1">&#39;spam|virus|galsyn|archiv&#39;</span><span class="o">|</span> <span class="n">sort</span> <span class="o">&gt;</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">cuentas</span>
</span></code></pre></td></tr></table></div></figure>


<p>Demás esta decir que lo realizado en el comando anterior se puede hacer dentro del mismo script sin tener que hacer esto de forma separada.  Una vez ejecutado el script, podremos ver la información de las cuentas en donde fue borrado el correo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">zimbra</span><span class="vi">@mail1</span> <span class="n">tmp</span><span class="o">]</span><span class="err">$</span> <span class="n">tail</span> <span class="o">-</span><span class="n">f</span> <span class="sr">/var/</span><span class="n">tmp</span><span class="o">/</span><span class="n">casillasConEmail</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">ahidalgo</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">alinay</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">chernandez</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">currutia</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">cvaldes</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">cuenta</span><span class="p">:</span> <span class="n">evalencia</span><span class="vi">@example</span><span class="o">.</span><span class="n">com</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <nav id="pagenavi">
        
        
            <a href="/blog/page/2/" class="next">Next</a>
        
    </nav>

</div>
	<footer id="footer" class="inner">&copy; 2016

    Miguel Angel Coa Morales

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/hyphenator.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'miguelcoa';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-45157770-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
