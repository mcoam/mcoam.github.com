
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>Módulo SSH Puppet y Hiera  | Bitácora</title>

	<meta name="author" content="Miguel Angel Coa Morales">

<meta name="description" content="Un blog personal"> <meta name="keywords" content="zimbra, linux, centos, devops, puppet, opensource, virtualizar, virtualización">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Bitácora" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Bitácora</a></h1>
<span class="tagline">Miguel Angel Coa Morales</span>
<nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<header>
		<h2 class="title">Módulo SSH Puppet Y Hiera</h2>
		<div class="meta date">








  


<time datetime="2014-06-26T21:28:00-04:00" pubdate data-updated="true">Jun 26<span>th</span>, 2014</time></div>
	</header>
	<div class="entry-content"><p>El siguiente es un módulo de Puppet para la administración del servicio ssh en Linux (Rhel/Debian). La idea, de módulo es tomar los valores de las variables <code>port</code> <code>usedns</code> y <code>permit_root_login</code>.</p>

<p><li>Clase init.pp</li>
Esta clase lo que hace es heredar las definición de variables que nosotros tenemos en nuestra clase <code>params.pp</code> e instancia el orden de la ejecución de las clases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">init</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="n">sshmcoa</span> <span class="p">(</span>
</span><span class='line'>    <span class="vg">$port</span>               <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$usedns</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:ensure</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$port</span>             <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:port</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$service_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:service_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_file</span>  <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_file</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$package_name</span> <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:package_name</span><span class="p">,</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="vg">$sshmcoa</span><span class="o">::</span><span class="ss">params</span><span class="p">:</span><span class="ss">:config_template</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'><span class="p">)</span> <span class="n">inherits</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::install&#39;</span><span class="p">:</span> <span class="p">}</span> <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::config&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="k">class</span> <span class="p">{</span><span class="s1">&#39;::sshmcoa::service&#39;</span><span class="p">:}</span>  <span class="o">-&gt;</span>
</span><span class='line'>  <span class="no">Class</span> <span class="o">[</span><span class="s1">&#39;sshmcoa&#39;</span><span class="o">]</span>
</span><span class='line'> <span class="c1">#notify {&quot;EL PUERTO ES: $port&quot;:}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase params.pp</li>
En esta clase se definen todos los parámetros a configurar por la clase dependiendo del sistema operativo (familia RedHat o familia Debian)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">params</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:params</span><span class="p">{</span>
</span><span class='line'>    <span class="vg">$port</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$usedns</span>       <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$ensure</span>             <span class="o">=</span> <span class="s1">&#39;present&#39;</span>
</span><span class='line'>    <span class="vg">$permit_root_login</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span class='line'>    <span class="vg">$listen_address</span>     <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
</span><span class='line'>    <span class="vg">$config_template</span>    <span class="o">=</span> <span class="s1">&#39;sshmcoa/sshd_config.conf.erb&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>          <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;ssh&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>          <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>      <span class="vg">$config_file</span>  <span class="o">=</span> <span class="s1">&#39;/etc/ssh/sshd_config&#39;</span>
</span><span class='line'>      <span class="vg">$service_name</span> <span class="o">=</span> <span class="s1">&#39;sshd&#39;</span>
</span><span class='line'>      <span class="vg">$package_name</span> <span class="o">=</span> <span class="s1">&#39;openssh-server&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase install.pp</li>
Esta es la clase encargada de la instalación del paquete para el servicio ssh, dependiendo del <code>osfamily</code> se instalará el pauete <code>ssh</code> o <code>openssh-server</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">install</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:install</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="k">case</span> <span class="vg">$:</span><span class="ss">:osfamily</span> <span class="p">{</span>
</span><span class='line'>        <span class="s1">&#39;Debian&#39;</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="ss">default</span><span class="p">:{</span>
</span><span class='line'>                <span class="n">package</span> <span class="p">{</span><span class="s2">&quot;$package_name&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">ensure</span> <span class="o">=&gt;</span> <span class="s1">&#39;installed&#39;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase service.pp</li>
Se configurar las opciones propias del servicio ssh</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">service</span><span class="o">.</span><span class="n">pp</span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:service</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">service</span> <span class="p">{</span><span class="s2">&quot;$service_name&quot;</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>     <span class="o">=&gt;</span> <span class="n">running</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasstatus</span>  <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">hasrestart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="n">enable</span>      <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
</span><span class='line'>          <span class="nb">require</span>    <span class="o">=&gt;</span> <span class="no">Class</span><span class="o">[</span><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span><span class="o">]</span>
</span><span class='line'>  <span class="p">}</span>    
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Clase config.pp</li>
Configuramos los valores del archivo sshd_config. El nombre del archivo viene heredado de la de la clase principal bajo la variable <code>$config_file</code>, y el contenido <code>content</code> que tendrá el archivo es creado mediante un template <code>.erb</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="c1"># cat config.pp </span>
</span><span class='line'><span class="k">class</span> <span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:config</span> <span class="n">inherits</span> <span class="n">sshmcoa</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">file</span> <span class="p">{</span> <span class="vg">$config_file</span><span class="p">:</span>
</span><span class='line'>          <span class="k">ensure</span>  <span class="o">=&gt;</span> <span class="n">present</span><span class="p">,</span>
</span><span class='line'>          <span class="n">owner</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">group</span>   <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">mode</span>    <span class="o">=&gt;</span> <span class="s1">&#39;600&#39;</span><span class="p">,</span>
</span><span class='line'>          <span class="n">content</span> <span class="o">=&gt;</span> <span class="n">template</span><span class="p">(</span><span class="vg">$config_template</span><span class="p">),</span>
</span><span class='line'>      <span class="n">notify</span>  <span class="o">=&gt;</span> <span class="no">Service</span><span class="o">[</span><span class="s2">&quot;$service_name&quot;</span><span class="o">]</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo sshd_config.conf.erb</li>
Este es el arhivo .erb que se crea con el contenido dinámico con el valor de las variables que fueron ingresadas desde <code>Hiera</code>. Para el caso de la clase, los valores que modificamos son <code>port</code> <code>usedns</code> y <code>permit_root_login</code> y para importalos al template tenemos que utilizar el formato <code>&lt;%= @NOMBRE_DE_VARIABLE %></code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">manifests</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="o">.</span><span class="n">.</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">erb</span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="o">&lt;</span><span class="sx">%= @port %&gt;</span>
</span><span class='line'><span class="sx">Protocol 2</span>
</span><span class='line'><span class="sx">SyslogFacility AUTHPRIV</span>
</span><span class='line'><span class="sx">PasswordAuthentication yes</span>
</span><span class='line'><span class="sx">ChallengeResponseAuthentication no</span>
</span><span class='line'><span class="sx">GSSAPIAuthentication yes</span>
</span><span class='line'><span class="sx">GSSAPICleanupCredentials yes</span>
</span><span class='line'><span class="sx">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="sx">PermitRootLogin &lt;%=</span> <span class="vi">@permit_root_login</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">UsePAM yes</span>
</span><span class='line'><span class="sx">#UseDNS Puppet</span>
</span><span class='line'><span class="sx">UseDNS &lt;%= @usedns %&gt;</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>


<p><li>Archivo Hiera.yaml</li>
Dentro de nuestro <code>common.yaml</code> configuramos los valores que tendrán las variables del servicio ssh.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@master</span> <span class="n">hieradata</span><span class="o">]</span><span class="err">$</span> <span class="n">cat</span> <span class="n">common</span><span class="o">.</span><span class="n">yaml</span>
</span><span class='line'><span class="o">---</span>
</span><span class='line'><span class="ss">classes</span><span class="p">:</span>
</span><span class='line'>     <span class="o">-</span> <span class="n">sshmcoa</span>
</span><span class='line'>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:port</span><span class="p">:</span> <span class="s1">&#39;2222&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:usedns</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span><span class='line'><span class="ss">sshmcoa</span><span class="p">:</span><span class="ss">:permit_root_login</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finalmente cuando conectemos el nodo veremos como se ejecuta la clase con los valores que le hemos pasado</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># !puppet</span>
</span><span class='line'><span class="n">puppet</span> <span class="n">agent</span> <span class="o">--</span><span class="nb">test</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Retrieving</span> <span class="n">plugin</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">root_home</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">puppet_vardir</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">pe_version</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">hosts_managed</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Loading</span> <span class="n">facts</span> <span class="k">in</span> <span class="sr">/var/</span><span class="n">lib</span><span class="o">/</span><span class="n">puppet</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">facter</span><span class="o">/</span><span class="n">facter_dot_d</span><span class="o">.</span><span class="n">rb</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Caching</span> <span class="n">catalog</span> <span class="k">for</span> <span class="n">node1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">Applying</span> <span class="n">configuration</span> <span class="n">version</span> <span class="s1">&#39;1401042981&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Install</span><span class="o">/</span><span class="no">Package</span><span class="o">[</span><span class="n">openssh</span><span class="o">-</span><span class="n">server</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="n">created</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span>
</span><span class='line'><span class="o">---</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span>  <span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">22</span> <span class="mi">19</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mo">03</span><span class="o">.</span><span class="mo">000000000</span> <span class="o">-</span><span class="mo">0300</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">.</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="no">FileBucket</span> <span class="n">adding</span> <span class="p">{</span><span class="n">md5</span><span class="p">}</span><span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Filebucketed</span> <span class="sr">/etc/ss</span><span class="n">h</span><span class="o">/</span><span class="n">sshd_config</span> <span class="n">to</span> <span class="n">puppet</span> <span class="n">with</span> <span class="n">sum</span> <span class="mi">53</span><span class="n">ad75eb1f2269d23f6e4228353cbca3</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]/</span><span class="ss">content</span><span class="p">:</span> <span class="n">content</span> <span class="n">changed</span> <span class="s1">&#39;{md5}53ad75eb1f2269d23f6e4228353cbca3&#39;</span> <span class="n">to</span> <span class="s1">&#39;{md5}22a041c1bbfd208de0259a2403bf3cbb&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/File[/e</span><span class="n">tc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span><span class="o">]</span><span class="p">:</span> <span class="no">Scheduling</span> <span class="n">refresh</span> <span class="n">of</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]/</span><span class="k">ensure</span><span class="p">:</span> <span class="k">ensure</span> <span class="n">changed</span> <span class="s1">&#39;stopped&#39;</span> <span class="n">to</span> <span class="s1">&#39;running&#39;</span>
</span><span class='line'><span class="ss">Info</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="ss">Sshmcoa</span><span class="p">:</span><span class="ss">:Service</span><span class="o">/</span><span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span><span class="p">:</span> <span class="no">Unscheduling</span> <span class="n">refresh</span> <span class="n">on</span> <span class="no">Service</span><span class="o">[</span><span class="n">sshd</span><span class="o">]</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="sr">/Stage[main]/</span><span class="no">Sshmcoa</span><span class="o">/</span><span class="no">Notify</span><span class="o">[</span><span class="no">EL</span> <span class="no">PUERTO</span> <span class="ss">ES</span><span class="p">:</span> <span class="mi">2222</span><span class="o">]/</span><span class="ss">message</span><span class="p">:</span> <span class="n">defined</span> <span class="s1">&#39;message&#39;</span> <span class="n">as</span> <span class="s1">&#39;EL PUERTO ES: 2222&#39;</span>
</span><span class='line'><span class="ss">Notice</span><span class="p">:</span> <span class="no">Finished</span> <span class="n">catalog</span> <span class="n">run</span> <span class="k">in</span> <span class="mi">16</span><span class="o">.</span><span class="mi">27</span> <span class="n">seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>Si vemos el contenido observaremos que se creó tal cual esta definido en nuestro template erb.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="n">root</span><span class="vi">@node1</span> <span class="n">etc</span><span class="o">]</span><span class="c1"># cat /etc/ssh/sshd_config </span>
</span><span class='line'><span class="c1"># sshd.conf: Managed by Puppet.</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Port Puppet</span>
</span><span class='line'><span class="no">Port</span> <span class="mi">2222</span>
</span><span class='line'><span class="no">Protocol</span> <span class="mi">2</span>
</span><span class='line'><span class="no">SyslogFacility</span> <span class="no">AUTHPRIV</span>
</span><span class='line'><span class="no">PasswordAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">ChallengeResponseAuthentication</span> <span class="n">no</span>
</span><span class='line'><span class="no">GSSAPIAuthentication</span> <span class="n">yes</span>
</span><span class='line'><span class="no">GSSAPICleanupCredentials</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">##PermitRootLogin Puppet</span>
</span><span class='line'><span class="no">PermitRootLogin</span> <span class="n">no</span>
</span><span class='line'><span class="no">UsePAM</span> <span class="n">yes</span>
</span><span class='line'><span class="c1">#UseDNS Puppet</span>
</span><span class='line'><span class="no">UseDNS</span> <span class="n">no</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LANG</span> <span class="no">LC_CTYPE</span> <span class="no">LC_NUMERIC</span> <span class="no">LC_TIME</span> <span class="no">LC_COLLATE</span> <span class="no">LC_MONETARY</span> <span class="no">LC_MESSAGES</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_PAPER</span> <span class="no">LC_NAME</span> <span class="no">LC_ADDRESS</span> <span class="no">LC_TELEPHONE</span> <span class="no">LC_MEASUREMENT</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">LC_IDENTIFICATION</span> <span class="no">LC_ALL</span> <span class="no">LANGUAGE</span>
</span><span class='line'><span class="no">AcceptEnv</span> <span class="no">XMODIFIERS</span>
</span><span class='line'><span class="no">X11Forwarding</span> <span class="n">yes</span>
</span><span class='line'><span class="no">Subsystem</span> <span class="n">sftp</span> <span class="sr">/usr/</span><span class="n">libexec</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">sftp</span><span class="o">-</span><span class="n">server</span>
</span></code></pre></td></tr></table></div></figure>

</div>
	

</article>

	
	<div class="share">
		<ul>
			<li>
  <a href="https://twitter.com/intent/tweet?text=Módulo SSH Puppet y Hiera by @&url=http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/" title="Share Módulo SSH Puppet y Hiera on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>

			<li>
  <a href="https://www.facebook.com/sharer.php?u=http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/" title="Share Módulo SSH Puppet y Hiera on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>

			<li>
  <a href="https://plus.google.com/share?url=http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/" title="Share Módulo SSH Puppet y Hiera on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>

		</ul>
	</div>




<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">&copy; 2014

    Miguel Angel Coa Morales

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/hyphenator.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'miguelcoa';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/';
        var disqus_url = 'http://mcoam.github.io/blog/2014/06/26/modulo-ssh-puppet-y-hiera/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-45157770-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
