
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>Instalación desatentida de Zimbra  | Bitácora</title>

	<meta name="author" content="Miguel Angel Coa Morales">

<meta name="description" content="Un blog personal"> <meta name="keywords" content="zimbra, linux, centos, devops, puppet, opensource, virtualizar, virtualización">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Bitácora" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">Bitácora</a></h1>
<span class="tagline">Miguel Angel Coa Morales</span>
<nav id="main-nav"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">About</a></li>
	<li><a href="/archives">Archives</a></li>
	<li><a href="/contact">Contact</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<header>
		<h2 class="title">Instalación Desatentida De Zimbra</h2>
		<div class="meta date">








  


<time datetime="2014-11-27T17:20:00-03:00" pubdate data-updated="true">Nov 27<span>th</span>, 2014</time></div>
	</header>
	<div class="entry-content"><p>Muchas veces al momento de instalar nuestro servidor de correos hemos pensado como poder automatizar este proceso, ya que en muchos casos las instalaciones son siempre las mismas,  por lo cual optimizar este trabajo mediante Kickstart sería de gran utilidad.  Por suerte en el caso de Zimbra es posible realizar esto mediante un archivo de configuración <i>Kickstart</i> donde le pasamos todos los datos necesarios que permitan realizar esta tarea (dominio, password admin, hostname, etc).</p>

<p>En el presente caso, vamos a realizar una instalación multi-servidor en un ambiente virtual donde instalaremos 4 servidores con distintos roles:
<li>1 Zimbra Ldap Master</li>
<li>1 Zimbra Ldap Replica</li>
<li>1 Zimbra Mailbox</li>
<li>1 Zimbra MTA/Proxy</li></p>

<p>La gracia de esta instalación  es que nos permitirá ir creciendo de forma horizontal e ir adiconando servidores en la medida que necesitamos con solo ejecutar un par de comando y de forma totalmente desatendida.</p>

<h4>Explicando el escenario</h4>

<p>Como nuestro ambiente de instalación es virtual, todas los servidores serán clonados a partir de servidores que llamamos <i>templates</i> en donde previamente se realizó la instalación de los paquetes para cada tipo de rol. Por ejemplo para el servidor template Zimbra Ldap Master, realizamos una instalación con el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">.</span><span class="n">/install</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">s</span>
</span></code></pre></td></tr></table></div></figure>


<p>Donde al momento de la consulta de que paquetes instalar le damos <i>Y</i> solo a la opción <code>zimbra-ldap</code>, por defecto esto también instalará el paquete <code>zimbra-core</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">zimbra</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">1</span><span class="n">_GA_3056</span><span class="o">.</span><span class="n">RHEL6_64</span><span class="o">-</span><span class="mi">20141103151539</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
</span><span class='line'><span class="n">zimbra</span><span class="o">-</span><span class="n">ldap</span><span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">1</span><span class="n">_GA_3056</span><span class="o">.</span><span class="n">RHEL6_64</span><span class="o">-</span><span class="mi">20141103151539</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
</span></code></pre></td></tr></table></div></figure>


<p>Y así con los restantes servidores, lo anterior tiene por objetivo que cuando clonemos el servidor template, este ya tenga los paquetes instalados y solo con ejecutar un comando se haga todo de forma desatendida.</p>

<h4>Manos a la obra</h4>

<p><li>Nota nº1: Antes que todo, tenemos que tener claro que para realizar una instalación de este tipo, tenemos que realizar la instalación en el siguiente orden: Zimbra Ldap Master &ndash;> Zimbra Mailbox &ndash;> Zimbra MTA &ndash;> Zimbra Ldap Réplica </li>
<li>Nota nº2: Tenemos que tener la precaución de corregir el hostname y la tabla hosts de cada uno de los nuevos servidores a instalar </li></p>

<h5>Instalando Zimbra Ldap Master</h5>

<p>Para realizar la intalación del servidor Zimbra Ldap Master ejecutamos el comando:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sr">/opt/</span><span class="n">zimbra</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">zmsetup</span><span class="o">.</span><span class="n">pl</span>  <span class="o">-</span><span class="n">c</span> <span class="sr">/root/</span><span class="n">zimbra</span><span class="o">-</span><span class="n">conf</span><span class="o">/</span><span class="n">zcsOpenLdapMasterConfig</span>
</span></code></pre></td></tr></table></div></figure>


<p>El contenido del archivo <i>zcsOpenLdapMasterConfig</i> es el siguiente:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CREATEADMINPASS</span><span class="o">=</span><span class="s2">&quot;zimbra.passwd&quot;</span>
</span><span class='line'><span class="no">LDAPROOTPASS</span><span class="o">=</span><span class="s2">&quot;c1bumJP_&quot;</span>
</span><span class='line'><span class="no">LDAPADMINPASS</span><span class="o">=</span><span class="s2">&quot;c1bumJP_&quot;</span>
</span><span class='line'><span class="no">LDAPREPPASS</span><span class="o">=</span><span class="s2">&quot;c1bumJP_&quot;</span>
</span><span class='line'><span class="no">AVDOMAIN</span><span class="o">=</span><span class="s2">&quot;example-open.local&quot;</span>
</span><span class='line'><span class="no">AVUSER</span><span class="o">=</span><span class="s2">&quot;admin@example-open.local&quot;</span>
</span><span class='line'><span class="no">CREATEADMIN</span><span class="o">=</span><span class="s2">&quot;admin@example-open.local&quot;</span>
</span><span class='line'><span class="no">CREATEDOMAIN</span><span class="o">=</span><span class="s2">&quot;example-open.local&quot;</span>
</span><span class='line'><span class="no">DOCREATEADMIN</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span class='line'><span class="no">DOCREATEDOMAIN</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="no">EXPANDMENU</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span class='line'><span class="no">HOSTNAME</span><span class="o">=</span><span class="s2">&quot;zco-ldapmaster-1.example.com&quot;</span>
</span><span class='line'><span class="no">HTTPPORT</span><span class="o">=</span><span class="s2">&quot;80&quot;</span>
</span><span class='line'><span class="no">HTTPPROXY</span><span class="o">=</span><span class="s2">&quot;FALSE&quot;</span>
</span><span class='line'><span class="no">HTTPPROXYPORT</span><span class="o">=</span><span class="s2">&quot;8080&quot;</span>
</span><span class='line'><span class="no">HTTPSPORT</span><span class="o">=</span><span class="s2">&quot;443&quot;</span>
</span><span class='line'><span class="no">HTTPSPROXYPORT</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span>
</span><span class='line'><span class="no">IMAPPORT</span><span class="o">=</span><span class="s2">&quot;143&quot;</span>
</span><span class='line'><span class="no">IMAPPROXYPORT</span><span class="o">=</span><span class="s2">&quot;7143&quot;</span>
</span><span class='line'><span class="no">IMAPSSLPORT</span><span class="o">=</span><span class="s2">&quot;993&quot;</span>
</span><span class='line'><span class="no">IMAPSSLPROXYPORT</span><span class="o">=</span><span class="s2">&quot;7993&quot;</span>
</span><span class='line'><span class="no">INSTALL_WEBAPPS</span><span class="o">=</span><span class="s2">&quot;zimlet&quot;</span>
</span><span class='line'><span class="no">JAVAHOME</span><span class="o">=</span><span class="s2">&quot;/opt/zimbra/java&quot;</span>
</span><span class='line'><span class="no">LDAPBESSEARCHSET</span><span class="o">=</span><span class="s2">&quot;set&quot;</span>
</span><span class='line'><span class="no">LDAPHOST</span><span class="o">=</span><span class="s2">&quot;zco-ldapmaster-1.example.com&quot;</span>
</span><span class='line'><span class="no">LDAPPORT</span><span class="o">=</span><span class="s2">&quot;389&quot;</span>
</span><span class='line'><span class="no">LDAPREPLICATIONTYPE</span><span class="o">=</span><span class="s2">&quot;master&quot;</span>
</span><span class='line'><span class="no">LDAPSERVERID</span><span class="o">=</span><span class="s2">&quot;2&quot;</span>
</span><span class='line'><span class="no">MAILBOXDMEMORY</span><span class="o">=</span><span class="s2">&quot;1971&quot;</span>
</span><span class='line'><span class="no">MAILPROXY</span><span class="o">=</span><span class="s2">&quot;FALSE&quot;</span>
</span><span class='line'><span class="no">MODE</span><span class="o">=</span><span class="s2">&quot;https&quot;</span>
</span><span class='line'><span class="no">MYSQLMEMORYPERCENT</span><span class="o">=</span><span class="s2">&quot;30&quot;</span>
</span><span class='line'><span class="no">POPPORT</span><span class="o">=</span><span class="s2">&quot;110&quot;</span>
</span><span class='line'><span class="no">POPPROXYPORT</span><span class="o">=</span><span class="s2">&quot;7110&quot;</span>
</span><span class='line'><span class="no">POPSSLPORT</span><span class="o">=</span><span class="s2">&quot;995&quot;</span>
</span><span class='line'><span class="no">POPSSLPROXYPORT</span><span class="o">=</span><span class="s2">&quot;7995&quot;</span>
</span><span class='line'><span class="no">PROXYMODE</span><span class="o">=</span><span class="s2">&quot;https&quot;</span>
</span><span class='line'><span class="no">REMOVE</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span class='line'><span class="no">RUNVMHA</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span class='line'><span class="no">SMTPDEST</span><span class="o">=</span><span class="s2">&quot;admin@example-open.local&quot;</span>
</span><span class='line'><span class="no">SMTPHOST</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="no">SMTPNOTIFY</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="no">SMTPSOURCE</span><span class="o">=</span><span class="s2">&quot;admin@example-open.local&quot;</span>
</span><span class='line'><span class="no">SNMPNOTIFY</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="no">SNMPTRAPHOST</span><span class="o">=</span><span class="s2">&quot;zco-ldapmaster-1.example.com&quot;</span>
</span><span class='line'><span class="no">SPELLURL</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="no">STARTSERVERS</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="no">SYSTEMMEMORY</span><span class="o">=</span><span class="s2">&quot;7.7&quot;</span>
</span><span class='line'><span class="no">UPGRADE</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="no">USESPELL</span><span class="o">=</span><span class="s2">&quot;no&quot;</span>
</span><span class='line'><span class="no">ZIMBRA_REQ_SECURITY</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span>
</span><span class='line'><span class="n">ldap_bes_searcher_password</span><span class="o">=</span><span class="s2">&quot;ixXXkIh01&quot;</span>
</span><span class='line'><span class="n">ldap_dit_base_dn_config</span><span class="o">=</span><span class="s2">&quot;cn=zimbra&quot;</span>
</span><span class='line'><span class="n">ldap_nginx_password</span><span class="o">=</span><span class="s2">&quot;ixXXkIh01&quot;</span>
</span><span class='line'><span class="n">mailboxd_directory</span><span class="o">=</span><span class="s2">&quot;/opt/zimbra/mailboxd&quot;</span>
</span><span class='line'><span class="n">mailboxd_keystore</span><span class="o">=</span><span class="s2">&quot;/opt/zimbra/conf/keystore&quot;</span>
</span><span class='line'><span class="n">mailboxd_keystore_password</span><span class="o">=</span><span class="s2">&quot;U3m8S3yK&quot;</span>
</span><span class='line'><span class="n">mailboxd_truststore</span><span class="o">=</span><span class="s2">&quot;/opt/zimbra/java/jre/lib/security/cacerts&quot;</span>
</span><span class='line'><span class="n">mailboxd_truststore_password</span><span class="o">=</span><span class="s2">&quot;changeit&quot;</span>
</span><span class='line'><span class="n">ssl_default_digest</span><span class="o">=</span><span class="s2">&quot;sha256&quot;</span>
</span><span class='line'><span class="n">zimbraClusterType</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
</span><span class='line'><span class="n">zimbraIPMode</span><span class="o">=</span><span class="s2">&quot;ipv4&quot;</span>
</span><span class='line'><span class="n">zimbraPrefTimeZoneId</span><span class="o">=</span><span class="s2">&quot;America/Santiago&quot;</span>
</span><span class='line'><span class="n">zimbra_ldap_userdn</span><span class="o">=</span><span class="s2">&quot;uid=zimbra,cn=admins,cn=zimbra&quot;</span>
</span><span class='line'><span class="n">zimbra_require_interprocess_security</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
</span><span class='line'><span class="no">INSTALL_PACKAGES</span><span class="o">=</span><span class="s2">&quot;zimbra-core zimbra-ldap &quot;</span>
</span></code></pre></td></tr></table></div></figure>



</div>
	

</article>

	
	<div class="share">
		<ul>
			<li>
  <a href="https://twitter.com/intent/tweet?text=Instalación desatentida de Zimbra by @&url=http://mcoam.github.io/blog/2014/11/27/instalacion-desatentida-de-zimbra/" title="Share Instalación desatentida de Zimbra on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>

			<li>
  <a href="https://www.facebook.com/sharer.php?u=http://mcoam.github.io/blog/2014/11/27/instalacion-desatentida-de-zimbra/" title="Share Instalación desatentida de Zimbra on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>

			<li>
  <a href="https://plus.google.com/share?url=http://mcoam.github.io/blog/2014/11/27/instalacion-desatentida-de-zimbra/" title="Share Instalación desatentida de Zimbra on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>

		</ul>
	</div>




<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">&copy; 2015

    Miguel Angel Coa Morales

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/hyphenator.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'miguelcoa';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mcoam.github.io/blog/2014/11/27/instalacion-desatentida-de-zimbra/';
        var disqus_url = 'http://mcoam.github.io/blog/2014/11/27/instalacion-desatentida-de-zimbra/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-45157770-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
