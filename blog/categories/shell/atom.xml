<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: shell | Bitácora]]></title>
  <link href="http://mcoam.github.io/blog/categories/shell/atom.xml" rel="self"/>
  <link href="http://mcoam.github.io/"/>
  <updated>2015-01-15T12:56:42-03:00</updated>
  <id>http://mcoam.github.io/</id>
  <author>
    <name><![CDATA[Miguel Angel Coa Morales]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Script para buscar y borrar un correo en zimbra]]></title>
    <link href="http://mcoam.github.io/blog/2015/01/15/script-para-buscar-y-borrar-un-correo-en-zimbra/"/>
    <updated>2015-01-15T12:49:00-03:00</updated>
    <id>http://mcoam.github.io/blog/2015/01/15/script-para-buscar-y-borrar-un-correo-en-zimbra</id>
    <content type="html"><![CDATA[<p>El siguiente script permite buscar y borrar un correo mediante consola desde los mailbox de los usuarios.
```ruby</p>

<h1>!/bin/bash</h1>

<p>zimbraAccounts=&lsquo;/var/tmp/cuentas&rsquo;
zimbraCMD=&lsquo;/opt/zimbra/bin/zmmailbox&rsquo;
 for a in <code>cat $zimbraAccounts</code></p>

<pre><code>do
    #user=`$a`
    emailID=( $($zimbraCMD -z -m $a search "de haber superado debido a la alta tasa de correos spam" |grep conv |awk {'print $2'} |sed 's/-//g') )
    echo $user
    #echo ${emailID[1]}
        for i in "${emailID[@]}"
            do
                $zimbraCMD -z -m $a dm $i
        echo "cuenta: $a" &gt;&gt; /var/tmp/casillasConEmail
            done
done
</code></pre>

<p><code>
En la línea nº8 tenemos que cambiar el texto a buscar, y que corresponde a lo que esta dentro de comillas.
Para el caso, tenemos que tener las cuentas de correos en el archivo `/var/tmp/cuentas` que las podemos obtener con el comando:
</code>
zmprov -l gaa |egrep -vi &lsquo;spam|virus|galsyn|archiv&rsquo;| sort > /var/tmp/cuentas
```
Demás esta decir que lo realizado en el comando anterior se puede hacer dentro del mismo script sin tener que hacer esto de forma separada.</p>
]]></content>
  </entry>
  
</feed>
